(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function r(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(i){if(i.ep)return;i.ep=!0;const s=r(i);fetch(i.href,s)}})();function Xs(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Br,Kn;function Zs(){if(Kn)return Br;Kn=1;var t=Object.prototype.toString;Br=function(g){if(g===void 0)return"undefined";if(g===null)return"null";var y=typeof g;if(y==="boolean")return"boolean";if(y==="string")return"string";if(y==="number")return"number";if(y==="symbol")return"symbol";if(y==="function")return o(g)?"generatorfunction":"function";if(r(g))return"array";if(h(g))return"buffer";if(c(g))return"arguments";if(i(g))return"date";if(n(g))return"error";if(s(g))return"regexp";switch(e(g)){case"Symbol":return"symbol";case"Promise":return"promise";case"WeakMap":return"weakmap";case"WeakSet":return"weakset";case"Map":return"map";case"Set":return"set";case"Int8Array":return"int8array";case"Uint8Array":return"uint8array";case"Uint8ClampedArray":return"uint8clampedarray";case"Int16Array":return"int16array";case"Uint16Array":return"uint16array";case"Int32Array":return"int32array";case"Uint32Array":return"uint32array";case"Float32Array":return"float32array";case"Float64Array":return"float64array"}if(l(g))return"generator";switch(y=t.call(g),y){case"[object Object]":return"object";case"[object Map Iterator]":return"mapiterator";case"[object Set Iterator]":return"setiterator";case"[object String Iterator]":return"stringiterator";case"[object Array Iterator]":return"arrayiterator"}return y.slice(8,-1).toLowerCase().replace(/\s/g,"")};function e(f){return typeof f.constructor=="function"?f.constructor.name:null}function r(f){return Array.isArray?Array.isArray(f):f instanceof Array}function n(f){return f instanceof Error||typeof f.message=="string"&&f.constructor&&typeof f.constructor.stackTraceLimit=="number"}function i(f){return f instanceof Date?!0:typeof f.toDateString=="function"&&typeof f.getDate=="function"&&typeof f.setDate=="function"}function s(f){return f instanceof RegExp?!0:typeof f.flags=="string"&&typeof f.ignoreCase=="boolean"&&typeof f.multiline=="boolean"&&typeof f.global=="boolean"}function o(f,g){return e(f)==="GeneratorFunction"}function l(f){return typeof f.throw=="function"&&typeof f.return=="function"&&typeof f.next=="function"}function c(f){try{if(typeof f.length=="number"&&typeof f.callee=="function")return!0}catch(g){if(g.message.indexOf("callee")!==-1)return!0}return!1}function h(f){return f.constructor&&typeof f.constructor.isBuffer=="function"?f.constructor.isBuffer(f):!1}return Br}/*!
 * shallow-clone <https://github.com/jonschlinkert/shallow-clone>
 *
 * Copyright (c) 2015-present, Jon Schlinkert.
 * Released under the MIT License.
 */var Fr,Yn;function Ka(){if(Yn)return Fr;Yn=1;const t=Symbol.prototype.valueOf,e=Zs();function r(c,h){switch(e(c)){case"array":return c.slice();case"object":return Object.assign({},c);case"date":return new c.constructor(Number(c));case"map":return new Map(c);case"set":return new Set(c);case"buffer":return o(c);case"symbol":return l(c);case"arraybuffer":return i(c);case"float32array":case"float64array":case"int16array":case"int32array":case"int8array":case"uint16array":case"uint32array":case"uint8clampedarray":case"uint8array":return s(c);case"regexp":return n(c);case"error":return Object.create(c);default:return c}}function n(c){const h=c.flags!==void 0?c.flags:/\w+$/.exec(c)||void 0,f=new c.constructor(c.source,h);return f.lastIndex=c.lastIndex,f}function i(c){const h=new c.constructor(c.byteLength);return new Uint8Array(h).set(new Uint8Array(c)),h}function s(c,h){return new c.constructor(c.buffer,c.byteOffset,c.length)}function o(c){const h=c.length,f=Buffer.allocUnsafe?Buffer.allocUnsafe(h):Buffer.from(h);return c.copy(f),f}function l(c){return t?Object(t.call(c)):{}}return Fr=r,Fr}/*!
 * isobject <https://github.com/jonschlinkert/isobject>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */var Ur,Xn;function Ya(){return Xn||(Xn=1,Ur=function(e){return e!=null&&typeof e=="object"&&Array.isArray(e)===!1}),Ur}/*!
 * is-plain-object <https://github.com/jonschlinkert/is-plain-object>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */var $r,Zn;function Xa(){if(Zn)return $r;Zn=1;var t=Ya();function e(r){return t(r)===!0&&Object.prototype.toString.call(r)==="[object Object]"}return $r=function(n){var i,s;return!(e(n)===!1||(i=n.constructor,typeof i!="function")||(s=i.prototype,e(s)===!1)||s.hasOwnProperty("isPrototypeOf")===!1)},$r}var qr,ei;function Za(){if(ei)return qr;ei=1;const t=Ka(),e=Zs(),r=Xa();function n(o,l){switch(e(o)){case"object":return i(o,l);case"array":return s(o,l);default:return t(o)}}function i(o,l){if(typeof l=="function")return l(o);if(l||r(o)){const c=new o.constructor;for(let h in o)c[h]=n(o[h],l);return c}return o}function s(o,l){const c=new o.constructor(o.length);for(let h=0;h<o.length;h++)c[h]=n(o[h],l);return c}return qr=n,qr}var eo=Za();const ti=Xs(eo);var er={exports:{}},ri;function to(){if(ri)return er.exports;ri=1;var t=typeof Reflect=="object"?Reflect:null,e=t&&typeof t.apply=="function"?t.apply:function(w,E,A){return Function.prototype.apply.call(w,E,A)},r;t&&typeof t.ownKeys=="function"?r=t.ownKeys:Object.getOwnPropertySymbols?r=function(w){return Object.getOwnPropertyNames(w).concat(Object.getOwnPropertySymbols(w))}:r=function(w){return Object.getOwnPropertyNames(w)};function n(C){console&&console.warn&&console.warn(C)}var i=Number.isNaN||function(w){return w!==w};function s(){s.init.call(this)}er.exports=s,er.exports.once=O,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var o=10;function l(C){if(typeof C!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof C)}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(C){if(typeof C!="number"||C<0||i(C))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+C+".");o=C}}),s.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(w){if(typeof w!="number"||w<0||i(w))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+w+".");return this._maxListeners=w,this};function c(C){return C._maxListeners===void 0?s.defaultMaxListeners:C._maxListeners}s.prototype.getMaxListeners=function(){return c(this)},s.prototype.emit=function(w){for(var E=[],A=1;A<arguments.length;A++)E.push(arguments[A]);var L=w==="error",F=this._events;if(F!==void 0)L=L&&F.error===void 0;else if(!L)return!1;if(L){var N;if(E.length>0&&(N=E[0]),N instanceof Error)throw N;var te=new Error("Unhandled error."+(N?" ("+N.message+")":""));throw te.context=N,te}var ge=F[w];if(ge===void 0)return!1;if(typeof ge=="function")e(ge,this,E);else for(var Ee=ge.length,Ye=v(ge,Ee),A=0;A<Ee;++A)e(Ye[A],this,E);return!0};function h(C,w,E,A){var L,F,N;if(l(E),F=C._events,F===void 0?(F=C._events=Object.create(null),C._eventsCount=0):(F.newListener!==void 0&&(C.emit("newListener",w,E.listener?E.listener:E),F=C._events),N=F[w]),N===void 0)N=F[w]=E,++C._eventsCount;else if(typeof N=="function"?N=F[w]=A?[E,N]:[N,E]:A?N.unshift(E):N.push(E),L=c(C),L>0&&N.length>L&&!N.warned){N.warned=!0;var te=new Error("Possible EventEmitter memory leak detected. "+N.length+" "+String(w)+" listeners added. Use emitter.setMaxListeners() to increase limit");te.name="MaxListenersExceededWarning",te.emitter=C,te.type=w,te.count=N.length,n(te)}return C}s.prototype.addListener=function(w,E){return h(this,w,E,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(w,E){return h(this,w,E,!0)};function f(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function g(C,w,E){var A={fired:!1,wrapFn:void 0,target:C,type:w,listener:E},L=f.bind(A);return L.listener=E,A.wrapFn=L,L}s.prototype.once=function(w,E){return l(E),this.on(w,g(this,w,E)),this},s.prototype.prependOnceListener=function(w,E){return l(E),this.prependListener(w,g(this,w,E)),this},s.prototype.removeListener=function(w,E){var A,L,F,N,te;if(l(E),L=this._events,L===void 0)return this;if(A=L[w],A===void 0)return this;if(A===E||A.listener===E)--this._eventsCount===0?this._events=Object.create(null):(delete L[w],L.removeListener&&this.emit("removeListener",w,A.listener||E));else if(typeof A!="function"){for(F=-1,N=A.length-1;N>=0;N--)if(A[N]===E||A[N].listener===E){te=A[N].listener,F=N;break}if(F<0)return this;F===0?A.shift():b(A,F),A.length===1&&(L[w]=A[0]),L.removeListener!==void 0&&this.emit("removeListener",w,te||E)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(w){var E,A,L;if(A=this._events,A===void 0)return this;if(A.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):A[w]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete A[w]),this;if(arguments.length===0){var F=Object.keys(A),N;for(L=0;L<F.length;++L)N=F[L],N!=="removeListener"&&this.removeAllListeners(N);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(E=A[w],typeof E=="function")this.removeListener(w,E);else if(E!==void 0)for(L=E.length-1;L>=0;L--)this.removeListener(w,E[L]);return this};function y(C,w,E){var A=C._events;if(A===void 0)return[];var L=A[w];return L===void 0?[]:typeof L=="function"?E?[L.listener||L]:[L]:E?M(L):v(L,L.length)}s.prototype.listeners=function(w){return y(this,w,!0)},s.prototype.rawListeners=function(w){return y(this,w,!1)},s.listenerCount=function(C,w){return typeof C.listenerCount=="function"?C.listenerCount(w):k.call(C,w)},s.prototype.listenerCount=k;function k(C){var w=this._events;if(w!==void 0){var E=w[C];if(typeof E=="function")return 1;if(E!==void 0)return E.length}return 0}s.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]};function v(C,w){for(var E=new Array(w),A=0;A<w;++A)E[A]=C[A];return E}function b(C,w){for(;w+1<C.length;w++)C[w]=C[w+1];C.pop()}function M(C){for(var w=new Array(C.length),E=0;E<w.length;++E)w[E]=C[E].listener||C[E];return w}function O(C,w){return new Promise(function(E,A){function L(N){C.removeListener(w,F),A(N)}function F(){typeof C.removeListener=="function"&&C.removeListener("error",L),E([].slice.call(arguments))}D(C,w,F,{once:!0}),w!=="error"&&x(C,L,{once:!0})})}function x(C,w,E){typeof C.on=="function"&&D(C,"error",w,E)}function D(C,w,E,A){if(typeof C.on=="function")A.once?C.once(w,E):C.on(w,E);else if(typeof C.addEventListener=="function")C.addEventListener(w,function L(F){A.once&&C.removeEventListener(w,L),E(F)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof C)}return er.exports}var ro=to();const no=Xs(ro);var ne=[];for(var Jr=0;Jr<256;++Jr)ne.push((Jr+256).toString(16).slice(1));function io(t,e=0){return(ne[t[e+0]]+ne[t[e+1]]+ne[t[e+2]]+ne[t[e+3]]+"-"+ne[t[e+4]]+ne[t[e+5]]+"-"+ne[t[e+6]]+ne[t[e+7]]+"-"+ne[t[e+8]]+ne[t[e+9]]+"-"+ne[t[e+10]]+ne[t[e+11]]+ne[t[e+12]]+ne[t[e+13]]+ne[t[e+14]]+ne[t[e+15]]).toLowerCase()}var tr,so=new Uint8Array(16);function ao(){if(!tr&&(tr=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!tr))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return tr(so)}var oo=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const ni={randomUUID:oo};function co(t,e,r){if(ni.randomUUID&&!e&&!t)return ni.randomUUID();t=t||{};var n=t.random||(t.rng||ao)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){r=r||0;for(var i=0;i<16;++i)e[r+i]=n[i];return e}return io(n)}function Z(t,e,r,n){Object.defineProperty(t,e,{get:r,set:n,enumerable:!0,configurable:!0})}function lo(t){return t&&t.__esModule?t.default:t}var uo={};Z(uo,"httpActionGenerator",()=>ea);async function ea(t,e,r,n){try{q.debug("[RTVI] Fetch action",t,e);const i=new Headers({...Object.fromEntries((r.headers??new Headers).entries())});i.has("Content-Type")||i.set("Content-Type","application/json"),i.set("Cache-Control","no-cache"),i.set("Connection","keep-alive");const s=await fetch(t,{method:"POST",headers:i,body:JSON.stringify({...r.requestData,actions:[e]})}),o=s.headers.get("content-type");if(!s.ok){const l=await s.text();throw new pe(`Failed to resolve action: ${l}`,s.status)}if(s.body&&(o!=null&&o.includes("text/event-stream"))){const l=s.body.pipeThrough(new TextDecoderStream).getReader();let c="";for(;;){const{value:h,done:f}=await l.read();if(f)break;c+=h;let g=c.indexOf(`

`);for(;g!==-1;){const y=c.slice(0,g);c=c.slice(g+2);const k=y.split(`
`);let v="";for(const b of k){const M=b.indexOf(":");M!==-1&&(v+=b.slice(M+1).trim())}try{const b=atob(v),M=JSON.parse(b);n(M)}catch(b){throw q.error("[RTVI] Failed to parse JSON:",b),b}g=c.indexOf(`

`)}}}else{const l=await s.json();n(l)}}catch(i){throw q.error("[RTVI] Error during fetch:",i),i}}var ho={};Z(ho,"RTVIClient",()=>Ne);var ta={};ta=JSON.parse('{"name":"@pipecat-ai/client-js","version":"0.3.4","license":"BSD-2-Clause","main":"dist/index.js","module":"dist/index.module.js","types":"dist/index.d.ts","source":"src/index.ts","repository":{"type":"git","url":"git+https://github.com/pipecat-ai/pipecat-client-web.git"},"files":["dist","package.json","README.md"],"scripts":{"build":"jest --silent && parcel build --no-cache","dev":"parcel watch","lint":"eslint src/ --report-unused-disable-directives --max-warnings 0","test":"jest"},"jest":{"preset":"ts-jest","testEnvironment":"node"},"devDependencies":{"@jest/globals":"^29.7.0","@types/clone-deep":"^4.0.4","@types/jest":"^29.5.12","@types/uuid":"^10.0.0","eslint":"^9.11.1","eslint-config-prettier":"^9.1.0","eslint-plugin-simple-import-sort":"^12.1.1","jest":"^29.7.0","ts-jest":"^29.2.5"},"dependencies":{"@types/events":"^3.0.3","clone-deep":"^4.0.1","events":"^3.3.0","typed-emitter":"^2.1.0","uuid":"^10.0.0"}}');var bt={};Z(bt,"RTVIError",()=>pe);Z(bt,"ConnectionTimeoutError",()=>ra);Z(bt,"StartBotError",()=>on);Z(bt,"TransportStartError",()=>na);Z(bt,"BotNotReadyError",()=>ze);Z(bt,"ConfigUpdateError",()=>fo);Z(bt,"ActionEndpointNotSetError",()=>ia);class pe extends Error{constructor(e,r){super(e),this.status=r}}class ra extends pe{constructor(e){super(e??"Bot did not enter ready state within the specified timeout period.")}}class on extends pe{constructor(e,r){super(e??"Failed to connect / invalid auth bundle from base url",r??500),this.error="invalid-request-error"}}class na extends pe{constructor(e){super(e??"Unable to connect to transport")}}class ze extends pe{constructor(e){super(e??"Attempt to call action on transport when not in 'ready' state.")}}class fo extends pe{constructor(e){super(e??"Unable to update configuration"),this.status=400}}class ia extends pe{constructor(e){super(e??"Action endpoint is not set")}}function Pt(t,e,r){const n=r.value;return r.value=function(...i){if(this.state==="ready")return n.apply(this,i);throw new ze(`Attempt to call ${e.toString()} when transport not in ready state. Await connect() first.`)},r}function po(...t){return t=["ready",...t],function(e,r,n){const i=n.get;return n.get=function(){if(t.includes(this.state))return i==null?void 0:i.apply(this);throw new ze(`Attempt to call ${r.toString()} when transport not in ${t}. Await connect() first.`)},n}}var mo={};Z(mo,"RTVIEvent",()=>I);var I;(function(t){t.MessageError="messageError",t.Error="error",t.Connected="connected",t.Disconnected="disconnected",t.TransportStateChanged="transportStateChanged",t.Config="config",t.ConfigDescribe="configDescribe",t.ActionsAvailable="actionsAvailable",t.ParticipantConnected="participantConnected",t.ParticipantLeft="participantLeft",t.TrackStarted="trackStarted",t.TrackStopped="trackStopped",t.ScreenTrackStarted="screenTrackStarted",t.ScreenTrackStopped="screenTrackStopped",t.ScreenShareError="screenShareError",t.AvailableCamsUpdated="availableCamsUpdated",t.AvailableMicsUpdated="availableMicsUpdated",t.AvailableSpeakersUpdated="availableSpeakersUpdated",t.CamUpdated="camUpdated",t.MicUpdated="micUpdated",t.SpeakerUpdated="speakerUpdated",t.BotConnected="botConnected",t.BotReady="botReady",t.BotDisconnected="botDisconnected",t.BotStartedSpeaking="botStartedSpeaking",t.BotStoppedSpeaking="botStoppedSpeaking",t.RemoteAudioLevel="remoteAudioLevel",t.UserStartedSpeaking="userStartedSpeaking",t.UserStoppedSpeaking="userStoppedSpeaking",t.LocalAudioLevel="localAudioLevel",t.Metrics="metrics",t.UserTranscript="userTranscript",t.BotTranscript="botTranscript",t.BotLlmText="botLlmText",t.BotLlmStarted="botLlmStarted",t.BotLlmStopped="botLlmStopped",t.BotTtsText="botTtsText",t.BotTtsStarted="botTtsStarted",t.BotTtsStopped="botTtsStopped",t.LLMFunctionCall="llmFunctionCall",t.LLMFunctionCallStart="llmFunctionCallStart",t.LLMJsonCompletion="llmJsonCompletion",t.StorageItemStored="storageItemStored",t.BotLlmSearchResponse="botLlmSearchResponse",t.ServerMessage="serverMessage"})(I||(I={}));var go={};Z(go,"RTVIClientHelper",()=>xn);class xn{constructor(e){this._options=e}set client(e){this._client=e}set service(e){this._service=e}}var sa={};Z(sa,"LogLevel",()=>Je);Z(sa,"logger",()=>q);var Je;(function(t){t[t.NONE=0]="NONE",t[t.ERROR=1]="ERROR",t[t.WARN=2]="WARN",t[t.INFO=3]="INFO",t[t.DEBUG=4]="DEBUG"})(Je||(Je={}));class St{constructor(){this.level=Je.DEBUG}static getInstance(){return St.instance||(St.instance=new St),St.instance}setLevel(e){this.level=e}debug(...e){this.level>=Je.DEBUG&&console.debug(...e)}info(...e){this.level>=Je.INFO&&console.info(...e)}warn(...e){this.level>=Je.WARN&&console.warn(...e)}error(...e){this.level>=Je.ERROR&&console.error(...e)}}const q=St.getInstance();var Qt={};Z(Qt,"RTVI_MESSAGE_LABEL",()=>aa);Z(Qt,"RTVIMessageType",()=>$);Z(Qt,"RTVIMessage",()=>re);Z(Qt,"RTVIActionRequest",()=>oa);Z(Qt,"MessageDispatcher",()=>cn);const aa="rtvi-ai";var $;(function(t){t.CLIENT_READY="client-ready",t.UPDATE_CONFIG="update-config",t.GET_CONFIG="get-config",t.DESCRIBE_CONFIG="describe-config",t.DESCRIBE_ACTIONS="describe-actions",t.DISCONNECT_BOT="disconnect-bot",t.ACTION="action",t.BOT_READY="bot-ready",t.ERROR="error",t.ERROR_RESPONSE="error-response",t.CONFIG="config",t.CONFIG_AVAILABLE="config-available",t.CONFIG_ERROR="config-error",t.ACTIONS_AVAILABLE="actions-available",t.ACTION_RESPONSE="action-response",t.METRICS="metrics",t.USER_TRANSCRIPTION="user-transcription",t.BOT_TRANSCRIPTION="bot-transcription",t.USER_STARTED_SPEAKING="user-started-speaking",t.USER_STOPPED_SPEAKING="user-stopped-speaking",t.BOT_STARTED_SPEAKING="bot-started-speaking",t.BOT_STOPPED_SPEAKING="bot-stopped-speaking",t.USER_LLM_TEXT="user-llm-text",t.BOT_LLM_TEXT="bot-llm-text",t.BOT_LLM_STARTED="bot-llm-started",t.BOT_LLM_STOPPED="bot-llm-stopped",t.BOT_TTS_TEXT="bot-tts-text",t.BOT_TTS_STARTED="bot-tts-started",t.BOT_TTS_STOPPED="bot-tts-stopped",t.BOT_LLM_SEARCH_RESPONSE="bot-llm-search-response",t.STORAGE_ITEM_STORED="storage-item-stored",t.SERVER_MESSAGE="server-message"})($||($={}));class re{constructor(e,r,n){this.label=aa,this.type=e,this.data=r,this.id=n||co().slice(0,8)}static clientReady(){return new re($.CLIENT_READY,{})}static updateConfig(e,r=!1){return new re($.UPDATE_CONFIG,{config:e,interrupt:r})}static describeConfig(){return new re($.DESCRIBE_CONFIG,{})}static getBotConfig(){return new re($.GET_CONFIG,{})}static describeActions(){return new re($.DESCRIBE_ACTIONS,{})}static disconnectBot(){return new re($.DISCONNECT_BOT,{})}static error(e,r=!1){return new re($.ERROR,{message:e,fatal:r})}}class oa extends re{constructor(e){super($.ACTION,e)}}class cn{constructor(e){this._queue=new Array,this._gcTime=1e4,this._queue=[],this._client=e}dispatch(e){const r=new Promise((n,i)=>{this._queue.push({message:e,timestamp:Date.now(),resolve:n,reject:i})});return q.debug("[MessageDispatcher] dispatch",e),this._client.sendMessage(e),this._gc(),r}async dispatchAction(e,r){var i;const n=new Promise((s,o)=>{this._queue.push({message:e,timestamp:Date.now(),resolve:s,reject:o})});if(q.debug("[MessageDispatcher] action",e),this._client.connected)this._client.sendMessage(e);else{if(!((i=this._client.params.endpoints)!=null&&i.action))throw q.error("[MessageDispatcher] Action endpoint is required when dispatching action in disconnected state"),new ia;const s=this._client.constructUrl("action");try{await ea(s,e,this._client.params,o=>{r(o)})}catch{r(new re($.ERROR_RESPONSE,`Action endpoint '${s}' returned an error response`,e.id))}}return this._gc(),n}_resolveReject(e,r=!0){const n=this._queue.find(i=>i.message.id===e.id);return n&&(r?(q.debug("[MessageDispatcher] Resolve",e),n.resolve((e.type===$.ACTION_RESPONSE,e))):(q.debug("[MessageDispatcher] Reject",e),n.reject(e)),this._queue=this._queue.filter(i=>i.message.id!==e.id),q.debug("[MessageDispatcher] Queue",this._queue)),e}resolve(e){return this._resolveReject(e,!0)}reject(e){return this._resolveReject(e,!1)}_gc(){this._queue=this._queue.filter(e=>Date.now()-e.timestamp<this._gcTime),q.debug("[MessageDispatcher] GC",this._queue)}}var _t=function(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var l=t.length-1;l>=0;l--)(o=t[l])&&(s=(i<3?o(s):i>3?o(e,r,s):o(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s};const vo={connect:"/connect",action:"/action"};class yo{constructor(e){this._transport=e,this._proxy=new Proxy(this._transport,{get:(r,n,i)=>{if(typeof r[n]=="function"){let s;switch(String(n)){case"initialize":s="Calls to initialize() are disabled and used internally by the RTVIClient";break;case"sendReadyMessage":s="Calls to sendReadyMessage() are disabled and used internally by the RTVIClient";break;case"connect":s="Calls to connect() are disabled. Please use RTVIClient.connect()";break;case"disconnect":s="Calls to disconnect() are disabled. Please use RTVIClient.disconnect()";break}return s?()=>{throw new Error(s)}:(...o)=>r[n](...o)}return Reflect.get(r,n,i)}})}get proxy(){return this._proxy}}class bo extends no{}class Ne extends bo{constructor(e){super(),this.params={...e.params,endpoints:{...vo,...e.params.endpoints??{}}},this._helpers={},this._transport=e.transport,this._transportWrapper=new yo(this._transport);const r={...e.callbacks,onMessageError:n=>{var i,s;(s=(i=e==null?void 0:e.callbacks)==null?void 0:i.onMessageError)==null||s.call(i,n),this.emit(I.MessageError,n)},onError:n=>{var s,o;(o=(s=e==null?void 0:e.callbacks)==null?void 0:s.onError)==null||o.call(s,n);try{this.emit(I.Error,n)}catch{q.debug("Could not emit error",n)}const i=n.data;i!=null&&i.fatal&&(q.error("Fatal error reported. Disconnecting..."),this.disconnect())},onConnected:()=>{var n,i;(i=(n=e==null?void 0:e.callbacks)==null?void 0:n.onConnected)==null||i.call(n),this.emit(I.Connected)},onDisconnected:()=>{var n,i;(i=(n=e==null?void 0:e.callbacks)==null?void 0:n.onDisconnected)==null||i.call(n),this.emit(I.Disconnected)},onTransportStateChanged:n=>{var i,s;(s=(i=e==null?void 0:e.callbacks)==null?void 0:i.onTransportStateChanged)==null||s.call(i,n),this.emit(I.TransportStateChanged,n)},onConfig:n=>{var i,s;(s=(i=e==null?void 0:e.callbacks)==null?void 0:i.onConfig)==null||s.call(i,n),this.emit(I.Config,n)},onConfigDescribe:n=>{var i,s;(s=(i=e==null?void 0:e.callbacks)==null?void 0:i.onConfigDescribe)==null||s.call(i,n),this.emit(I.ConfigDescribe,n)},onActionsAvailable:n=>{var i,s;(s=(i=e==null?void 0:e.callbacks)==null?void 0:i.onActionsAvailable)==null||s.call(i,n),this.emit(I.ActionsAvailable,n)},onParticipantJoined:n=>{var i,s;(s=(i=e==null?void 0:e.callbacks)==null?void 0:i.onParticipantJoined)==null||s.call(i,n),this.emit(I.ParticipantConnected,n)},onParticipantLeft:n=>{var i,s;(s=(i=e==null?void 0:e.callbacks)==null?void 0:i.onParticipantLeft)==null||s.call(i,n),this.emit(I.ParticipantLeft,n)},onTrackStarted:(n,i)=>{var s,o;(o=(s=e==null?void 0:e.callbacks)==null?void 0:s.onTrackStarted)==null||o.call(s,n,i),this.emit(I.TrackStarted,n,i)},onTrackStopped:(n,i)=>{var s,o;(o=(s=e==null?void 0:e.callbacks)==null?void 0:s.onTrackStopped)==null||o.call(s,n,i),this.emit(I.TrackStopped,n,i)},onScreenTrackStarted:(n,i)=>{var s,o;(o=(s=e==null?void 0:e.callbacks)==null?void 0:s.onScreenTrackStarted)==null||o.call(s,n,i),this.emit(I.ScreenTrackStarted,n,i)},onScreenTrackStopped:(n,i)=>{var s,o;(o=(s=e==null?void 0:e.callbacks)==null?void 0:s.onScreenTrackStopped)==null||o.call(s,n,i),this.emit(I.ScreenTrackStopped,n,i)},onScreenShareError:n=>{var i,s;(s=(i=e==null?void 0:e.callbacks)==null?void 0:i.onScreenShareError)==null||s.call(i,n),this.emit(I.ScreenShareError,n)},onAvailableCamsUpdated:n=>{var i,s;(s=(i=e==null?void 0:e.callbacks)==null?void 0:i.onAvailableCamsUpdated)==null||s.call(i,n),this.emit(I.AvailableCamsUpdated,n)},onAvailableMicsUpdated:n=>{var i,s;(s=(i=e==null?void 0:e.callbacks)==null?void 0:i.onAvailableMicsUpdated)==null||s.call(i,n),this.emit(I.AvailableMicsUpdated,n)},onAvailableSpeakersUpdated:n=>{var i,s;(s=(i=e==null?void 0:e.callbacks)==null?void 0:i.onAvailableSpeakersUpdated)==null||s.call(i,n),this.emit(I.AvailableSpeakersUpdated,n)},onCamUpdated:n=>{var i,s;(s=(i=e==null?void 0:e.callbacks)==null?void 0:i.onCamUpdated)==null||s.call(i,n),this.emit(I.CamUpdated,n)},onMicUpdated:n=>{var i,s;(s=(i=e==null?void 0:e.callbacks)==null?void 0:i.onMicUpdated)==null||s.call(i,n),this.emit(I.MicUpdated,n)},onSpeakerUpdated:n=>{var i,s;(s=(i=e==null?void 0:e.callbacks)==null?void 0:i.onSpeakerUpdated)==null||s.call(i,n),this.emit(I.SpeakerUpdated,n)},onBotConnected:n=>{var i,s;(s=(i=e==null?void 0:e.callbacks)==null?void 0:i.onBotConnected)==null||s.call(i,n),this.emit(I.BotConnected,n)},onBotReady:n=>{var i,s;(s=(i=e==null?void 0:e.callbacks)==null?void 0:i.onBotReady)==null||s.call(i,n),this.emit(I.BotReady,n)},onBotDisconnected:n=>{var i,s;(s=(i=e==null?void 0:e.callbacks)==null?void 0:i.onBotDisconnected)==null||s.call(i,n),this.emit(I.BotDisconnected,n)},onBotStartedSpeaking:()=>{var n,i;(i=(n=e==null?void 0:e.callbacks)==null?void 0:n.onBotStartedSpeaking)==null||i.call(n),this.emit(I.BotStartedSpeaking)},onBotStoppedSpeaking:()=>{var n,i;(i=(n=e==null?void 0:e.callbacks)==null?void 0:n.onBotStoppedSpeaking)==null||i.call(n),this.emit(I.BotStoppedSpeaking)},onRemoteAudioLevel:(n,i)=>{var s,o;(o=(s=e==null?void 0:e.callbacks)==null?void 0:s.onRemoteAudioLevel)==null||o.call(s,n,i),this.emit(I.RemoteAudioLevel,n,i)},onUserStartedSpeaking:()=>{var n,i;(i=(n=e==null?void 0:e.callbacks)==null?void 0:n.onUserStartedSpeaking)==null||i.call(n),this.emit(I.UserStartedSpeaking)},onUserStoppedSpeaking:()=>{var n,i;(i=(n=e==null?void 0:e.callbacks)==null?void 0:n.onUserStoppedSpeaking)==null||i.call(n),this.emit(I.UserStoppedSpeaking)},onLocalAudioLevel:n=>{var i,s;(s=(i=e==null?void 0:e.callbacks)==null?void 0:i.onLocalAudioLevel)==null||s.call(i,n),this.emit(I.LocalAudioLevel,n)},onUserTranscript:n=>{var i,s;(s=(i=e==null?void 0:e.callbacks)==null?void 0:i.onUserTranscript)==null||s.call(i,n),this.emit(I.UserTranscript,n)},onBotTranscript:n=>{var i,s;(s=(i=e==null?void 0:e.callbacks)==null?void 0:i.onBotTranscript)==null||s.call(i,n),this.emit(I.BotTranscript,n)},onBotLlmText:n=>{var i,s;(s=(i=e==null?void 0:e.callbacks)==null?void 0:i.onBotLlmText)==null||s.call(i,n),this.emit(I.BotLlmText,n)},onBotLlmStarted:()=>{var n,i;(i=(n=e==null?void 0:e.callbacks)==null?void 0:n.onBotLlmStarted)==null||i.call(n),this.emit(I.BotLlmStarted)},onBotLlmStopped:()=>{var n,i;(i=(n=e==null?void 0:e.callbacks)==null?void 0:n.onBotLlmStopped)==null||i.call(n),this.emit(I.BotLlmStopped)},onBotTtsText:n=>{var i,s;(s=(i=e==null?void 0:e.callbacks)==null?void 0:i.onBotTtsText)==null||s.call(i,n),this.emit(I.BotTtsText,n)},onBotTtsStarted:()=>{var n,i;(i=(n=e==null?void 0:e.callbacks)==null?void 0:n.onBotTtsStarted)==null||i.call(n),this.emit(I.BotTtsStarted)},onBotTtsStopped:()=>{var n,i;(i=(n=e==null?void 0:e.callbacks)==null?void 0:n.onBotTtsStopped)==null||i.call(n),this.emit(I.BotTtsStopped)},onStorageItemStored:n=>{var i,s;(s=(i=e==null?void 0:e.callbacks)==null?void 0:i.onStorageItemStored)==null||s.call(i,n),this.emit(I.StorageItemStored,n)}};this._options={...e,callbacks:r,enableMic:e.enableMic??!0,enableCam:e.enableCam??!1},this._initialize(),q.debug("[RTVI Client] Initialized",this.version)}constructUrl(e){var n;if(!this.params.baseUrl)throw new pe("Base URL not set. Please set rtviClient.params.baseUrl");return this.params.baseUrl.replace(/\/+$/,"")+(((n=this.params.endpoints)==null?void 0:n[e])??"")}setLogLevel(e){q.setLevel(e)}async initDevices(){q.debug("[RTVI Client] Initializing devices..."),await this._transport.initDevices()}async connect(){if(["authenticating","connecting","connected","ready"].includes(this._transport.state))throw new pe("Voice client has already been started. Please call disconnect() before starting again.");return this._abortController=new AbortController,new Promise((e,r)=>{(async()=>{var s,o,l;this._startResolve=e,this._transport.state==="disconnected"&&await this._transport.initDevices(),this._transport.state="authenticating",this._options.timeout&&(this._handshakeTimeout=setTimeout(async()=>{var c;(c=this._abortController)==null||c.abort(),await this.disconnect(),this._transport.state="error",r(new ra)},this._options.timeout));let n;const i=this._options.customConnectHandler;if(q.debug("[RTVI Client] Start params",this.params),this.params={...this.params,requestData:{...this.params.requestData,rtvi_client_version:this.version}},!this.params.baseUrl&&!((s=this.params.endpoints)!=null&&s.connect))q.debug("[RTVI Client] Connecting directly (skipping handshake / auth)..."),clearTimeout(this._handshakeTimeout);else{const c=this.constructUrl("connect");q.debug("[RTVI Client] Connecting...",c),q.debug("[RTVI Client] Start params",this.params);try{i?n=await i(this.params,this._handshakeTimeout,this._abortController):n=await fetch(c,{method:"POST",mode:"cors",headers:new Headers({"Content-Type":"application/json",...Object.fromEntries((this.params.headers??new Headers).entries())}),body:JSON.stringify({config:this.params.config,...this.params.services?{services:this.params.services}:{},...this.params.requestData}),signal:(o=this._abortController)==null?void 0:o.signal}).then(h=>(clearTimeout(this._handshakeTimeout),h.ok?h.json():Promise.reject(h)))}catch(h){if(clearTimeout(this._handshakeTimeout),(l=this._abortController)!=null&&l.signal.aborted)return;if(this._transport.state="error",h instanceof Response){const f=await h.json();r(new on(f.info??f.detail??h.statusText,h.status))}else r(new on);return}q.debug("[RTVI Client] Auth bundle received",n)}try{await this._transport.connect(n,this._abortController),await this._transport.sendReadyMessage()}catch(c){clearTimeout(this._handshakeTimeout),this.disconnect(),r(c);return}})()})}async disconnect(){this._abortController&&this._abortController.abort(),clearTimeout(this._handshakeTimeout),await this._transport.disconnect(),this._messageDispatcher=new cn(this)}_initialize(){this._transport.initialize(this._options,this.handleMessage.bind(this)),this._messageDispatcher=new cn(this)}get connected(){return["connected","ready"].includes(this._transport.state)}get transport(){return this._transportWrapper.proxy}get state(){return this._transport.state}get version(){return lo(ta).version}async getAllMics(){return await this._transport.getAllMics()}async getAllCams(){return await this._transport.getAllCams()}async getAllSpeakers(){return await this._transport.getAllSpeakers()}get selectedMic(){return this._transport.selectedMic}get selectedCam(){return this._transport.selectedCam}get selectedSpeaker(){return this._transport.selectedSpeaker}updateMic(e){this._transport.updateMic(e)}updateCam(e){this._transport.updateCam(e)}updateSpeaker(e){this._transport.updateSpeaker(e)}enableMic(e){this._transport.enableMic(e)}get isMicEnabled(){return this._transport.isMicEnabled}enableCam(e){this._transport.enableCam(e)}get isCamEnabled(){return this._transport.isCamEnabled}tracks(){return this._transport.tracks()}enableScreenShare(e){return this._transport.enableScreenShare(e)}get isSharingScreen(){return this._transport.isSharingScreen}async getConfig(){return(await this._messageDispatcher.dispatch(re.getBotConfig())).data.config}async updateConfig(e,r=!1){return q.debug("[RTVI Client] Updating config",e),this._messageDispatcher.dispatch(re.updateConfig(e,r))}async describeConfig(){return this._messageDispatcher.dispatch(re.describeConfig())}async getServiceOptionsFromConfig(e,r){if(!r&&this.state!=="ready")throw new ze("getServiceOptionsFromConfig called without config array before bot is ready");return Promise.resolve().then(async()=>{if(!e){q.debug("Target service name is required");return}const i=(r??await this.getConfig()).find(s=>s.service===e);if(!i){q.debug("No service with name "+e+" not found in config");return}return i})}async getServiceOptionValueFromConfig(e,r,n){const i=await this.getServiceOptionsFromConfig(e,n);if(!i){q.debug("Service with name "+e+" not found in config");return}const s=i.options.find(o=>o.name===r);return s?s.value:void 0}_updateOrAddOption(e,r){const n=e.findIndex(i=>i.name===r.name);return n!==-1?e.map((i,s)=>s===n?{...i,value:r.value}:i):[...e,{name:r.name,value:r.value}]}async setServiceOptionInConfig(e,r,n){const i=ti(n??await this.getConfig());if(!await this.getServiceOptionsFromConfig(e,i))return q.debug("Service with name '"+e+"' not found in config"),i;const o=Array.isArray(r)?r:[r];for(const l of o){const c=i.find(f=>f.service===e),h=c?this._updateOrAddOption(c.options,l):[{name:l.name,value:l.value}];c?c.options=h:i.push({service:e,options:h})}return i}async setConfigOptions(e,r){let n=ti(r??await this.getConfig());for(const i of e)n=await this.setServiceOptionInConfig(i.service,i.options,n)||n;return n}async action(e){return this._messageDispatcher.dispatchAction(new oa(e),this.handleMessage.bind(this))}async describeActions(){return this._messageDispatcher.dispatch(re.describeActions())}get transportExpiry(){return this._transport.expiry}sendMessage(e){this._transport.sendMessage(e)}disconnectBot(){this._transport.sendMessage(new re($.DISCONNECT_BOT,{}))}handleMessage(e){var r,n,i,s,o,l,c,h,f,g,y,k,v,b,M,O,x,D,C,w,E,A,L,F,N,te,ge,Ee,Ye,Xe,Dt,Ze,It,et,jt,tt,Xt,se,a,u,d,m,p,_,T,P,U;switch(q.debug("[RTVI Message]",e),e.type){case $.BOT_READY:clearTimeout(this._handshakeTimeout),(r=this._startResolve)==null||r.call(this,e.data),(i=(n=this._options.callbacks)==null?void 0:n.onBotReady)==null||i.call(n,e.data);break;case $.CONFIG_AVAILABLE:this._messageDispatcher.resolve(e),(o=(s=this._options.callbacks)==null?void 0:s.onConfigDescribe)==null||o.call(s,e.data);break;case $.CONFIG:{const K=this._messageDispatcher.resolve(e);(c=(l=this._options.callbacks)==null?void 0:l.onConfig)==null||c.call(l,K.data.config);break}case $.ACTIONS_AVAILABLE:this._messageDispatcher.resolve(e),(f=(h=this._options.callbacks)==null?void 0:h.onActionsAvailable)==null||f.call(h,e.data);break;case $.ACTION_RESPONSE:this._messageDispatcher.resolve(e);break;case $.ERROR_RESPONSE:{const K=this._messageDispatcher.reject(e);(y=(g=this._options.callbacks)==null?void 0:g.onMessageError)==null||y.call(g,K);break}case $.ERROR:(v=(k=this._options.callbacks)==null?void 0:k.onError)==null||v.call(k,e);break;case $.USER_STARTED_SPEAKING:(M=(b=this._options.callbacks)==null?void 0:b.onUserStartedSpeaking)==null||M.call(b);break;case $.USER_STOPPED_SPEAKING:(x=(O=this._options.callbacks)==null?void 0:O.onUserStoppedSpeaking)==null||x.call(O);break;case $.BOT_STARTED_SPEAKING:(C=(D=this._options.callbacks)==null?void 0:D.onBotStartedSpeaking)==null||C.call(D);break;case $.BOT_STOPPED_SPEAKING:(E=(w=this._options.callbacks)==null?void 0:w.onBotStoppedSpeaking)==null||E.call(w);break;case $.USER_TRANSCRIPTION:{const K=e.data;(L=(A=this._options.callbacks)==null?void 0:A.onUserTranscript)==null||L.call(A,K);break}case $.BOT_TRANSCRIPTION:(N=(F=this._options.callbacks)==null?void 0:F.onBotTranscript)==null||N.call(F,e.data);break;case $.BOT_LLM_TEXT:(ge=(te=this._options.callbacks)==null?void 0:te.onBotLlmText)==null||ge.call(te,e.data);break;case $.BOT_LLM_STARTED:(Ye=(Ee=this._options.callbacks)==null?void 0:Ee.onBotLlmStarted)==null||Ye.call(Ee);break;case $.BOT_LLM_STOPPED:(Dt=(Xe=this._options.callbacks)==null?void 0:Xe.onBotLlmStopped)==null||Dt.call(Xe);break;case $.BOT_TTS_TEXT:(It=(Ze=this._options.callbacks)==null?void 0:Ze.onBotTtsText)==null||It.call(Ze,e.data);break;case $.BOT_TTS_STARTED:(jt=(et=this._options.callbacks)==null?void 0:et.onBotTtsStarted)==null||jt.call(et);break;case $.BOT_TTS_STOPPED:(Xt=(tt=this._options.callbacks)==null?void 0:tt.onBotTtsStopped)==null||Xt.call(tt);break;case $.BOT_LLM_SEARCH_RESPONSE:(a=(se=this._options.callbacks)==null?void 0:se.onBotLlmSearchResponse)==null||a.call(se,e.data),this.emit(I.BotLlmSearchResponse,e.data);break;case $.METRICS:this.emit(I.Metrics,e.data),(d=(u=this._options.callbacks)==null?void 0:u.onMetrics)==null||d.call(u,e.data);break;case $.STORAGE_ITEM_STORED:(p=(m=this._options.callbacks)==null?void 0:m.onStorageItemStored)==null||p.call(m,e.data);break;case $.SERVER_MESSAGE:(T=(_=this._options.callbacks)==null?void 0:_.onServerMessage)==null||T.call(_,e.data),this.emit(I.ServerMessage,e.data);break;default:{let K=!1;for(const X of Object.values(this._helpers))X.getMessageTypes().includes(e.type)&&(K=!0,X.handleMessage(e));K||(U=(P=this._options.callbacks)==null?void 0:P.onGenericMessage)==null||U.call(P,e.data)}}}registerHelper(e,r){if(this._helpers[e])throw new Error(`Helper with name '${e}' already registered`);if(!(r instanceof xn))throw new Error("Helper must be an instance of RTVIClientHelper");return r.service=e,r.client=this,this._helpers[e]=r,this._helpers[e]}getHelper(e){const r=this._helpers[e];if(!r){q.debug(`Helper targeting service '${e}' not found`);return}return r}unregisterHelper(e){this._helpers[e]&&delete this._helpers[e]}}_t([Pt],Ne.prototype,"getConfig",null);_t([Pt],Ne.prototype,"updateConfig",null);_t([Pt],Ne.prototype,"describeConfig",null);_t([Pt],Ne.prototype,"describeActions",null);_t([po("connected","ready")],Ne.prototype,"transportExpiry",null);_t([Pt],Ne.prototype,"sendMessage",null);_t([Pt],Ne.prototype,"disconnectBot",null);var Dn={};Z(Dn,"LLMMessageType",()=>Ve);Z(Dn,"LLMActionType",()=>lt);Z(Dn,"LLMHelper",()=>_o);var Ve;(function(t){t.LLM_FUNCTION_CALL="llm-function-call",t.LLM_FUNCTION_CALL_START="llm-function-call-start",t.LLM_FUNCTION_CALL_RESULT="llm-function-call-result",t.LLM_JSON_COMPLETION="llm-json-completion"})(Ve||(Ve={}));var lt;(function(t){t.APPEND_TO_MESSAGES="append_to_messages",t.GET_CONTEXT="get_context",t.SET_CONTEXT="set_context",t.RUN="run"})(lt||(lt={}));class _o extends xn{constructor(e){super(e),this._functionCallCallback=null}getMessageTypes(){return Object.values(Ve)}async getContext(){if(this._client.state!=="ready")throw new ze("getContext called while transport not in ready state");return(await this._client.action({service:this._service,action:lt.GET_CONTEXT})).data.result}async setContext(e,r=!1){if(this._client.state!=="ready")throw new ze("setContext called while transport not in ready state");return!!(await this._client.action({service:this._service,action:lt.SET_CONTEXT,arguments:[{name:"messages",value:e.messages},{name:"interrupt",value:r}]})).data.result}async appendToMessages(e,r=!1){if(this._client.state!=="ready")throw new ze("setContext called while transport not in ready state");return!!(await this._client.action({service:this._service,action:lt.APPEND_TO_MESSAGES,arguments:[{name:"messages",value:[e]},{name:"run_immediately",value:r}]})).data.result}async run(e=!1){if(this._client.state==="ready")return this._client.action({service:this._service,action:lt.RUN,arguments:[{name:"interrupt",value:e}]})}handleFunctionCall(e){this._functionCallCallback=e}handleMessage(e){var r,n,i,s,o,l;switch(e.type){case Ve.LLM_JSON_COMPLETION:(n=(r=this._options.callbacks)==null?void 0:r.onLLMJsonCompletion)==null||n.call(r,e.data),this._client.emit(I.LLMJsonCompletion,e.data);break;case Ve.LLM_FUNCTION_CALL:{const c=e.data;if((s=(i=this._options.callbacks)==null?void 0:i.onLLMFunctionCall)==null||s.call(i,e.data),this._client.emit(I.LLMFunctionCall,e.data),this._functionCallCallback){const h={functionName:c.function_name,arguments:c.args};if(this._client.state==="ready")this._functionCallCallback(h).then(f=>{this._client.sendMessage(new re(Ve.LLM_FUNCTION_CALL_RESULT,{function_name:c.function_name,tool_call_id:c.tool_call_id,arguments:c.args,result:f}))});else throw new ze("Attempted to send a function call result from bot while transport not in ready state")}break}case Ve.LLM_FUNCTION_CALL_START:{const c=e.data;(l=(o=this._options.callbacks)==null?void 0:o.onLLMFunctionCallStart)==null||l.call(o,c.function_name),this._client.emit(I.LLMFunctionCallStart,c.function_name);break}}}}var wo={};Z(wo,"Transport",()=>ca);class ca{constructor(){this._state="disconnected",this._expiry=void 0}get expiry(){return this._expiry}}function ii(t,e){if(t==null)return{};var r,n,i=function(o,l){if(o==null)return{};var c,h,f={},g=Object.keys(o);for(h=0;h<g.length;h++)c=g[h],l.indexOf(c)>=0||(f[c]=o[c]);return f}(t,e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(n=0;n<s.length;n++)r=s[n],e.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function ke(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function G(t){return G=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},G(t)}function la(t){var e=function(r,n){if(G(r)!=="object"||r===null)return r;var i=r[Symbol.toPrimitive];if(i!==void 0){var s=i.call(r,n);if(G(s)!=="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(r)}(t,"string");return G(e)==="symbol"?e:String(e)}function si(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,la(n.key),n)}}function Ce(t,e,r){return e&&si(t.prototype,e),r&&si(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function xe(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Vt(t,e){return Vt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},Vt(t,e)}function Pr(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Vt(t,e)}function Lr(t,e){if(e&&(G(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return xe(t)}function Se(t){return Se=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Se(t)}function Ie(t,e,r){return(e=la(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function ai(t,e,r,n,i,s,o){try{var l=t[s](o),c=l.value}catch(h){return void r(h)}l.done?e(c):Promise.resolve(c).then(n,i)}function j(t){return function(){var e=this,r=arguments;return new Promise(function(n,i){var s=t.apply(e,r);function o(c){ai(s,n,i,o,l,"next",c)}function l(c){ai(s,n,i,o,l,"throw",c)}o(void 0)})}}function oi(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function pt(t,e){return function(r){if(Array.isArray(r))return r}(t)||function(r,n){var i=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(i!=null){var s,o,l,c,h=[],f=!0,g=!1;try{if(l=(i=i.call(r)).next,n===0){if(Object(i)!==i)return;f=!1}else for(;!(f=(s=l.call(i)).done)&&(h.push(s.value),h.length!==n);f=!0);}catch(y){g=!0,o=y}finally{try{if(!f&&i.return!=null&&(c=i.return(),Object(c)!==c))return}finally{if(g)throw o}}return h}}(t,e)||function(r,n){if(r){if(typeof r=="string")return oi(r,n);var i=Object.prototype.toString.call(r).slice(8,-1);return i==="Object"&&r.constructor&&(i=r.constructor.name),i==="Map"||i==="Set"?Array.from(r):i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?oi(r,n):void 0}}(t,e)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}var ua,je={},So={get exports(){return je},set exports(t){je=t}},Ct=typeof Reflect=="object"?Reflect:null,ci=Ct&&typeof Ct.apply=="function"?Ct.apply:function(t,e,r){return Function.prototype.apply.call(t,e,r)};ua=Ct&&typeof Ct.ownKeys=="function"?Ct.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var li=Number.isNaN||function(t){return t!=t};function W(){W.init.call(this)}So.exports=W,je.once=function(t,e){return new Promise(function(r,n){function i(o){t.removeListener(e,s),n(o)}function s(){typeof t.removeListener=="function"&&t.removeListener("error",i),r([].slice.call(arguments))}mi(t,e,s,{once:!0}),e!=="error"&&function(o,l,c){typeof o.on=="function"&&mi(o,"error",l,c)}(t,i,{once:!0})})},W.EventEmitter=W,W.prototype._events=void 0,W.prototype._eventsCount=0,W.prototype._maxListeners=void 0;var ui=10;function mr(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function da(t){return t._maxListeners===void 0?W.defaultMaxListeners:t._maxListeners}function di(t,e,r,n){var i,s,o,l;if(mr(r),(s=t._events)===void 0?(s=t._events=Object.create(null),t._eventsCount=0):(s.newListener!==void 0&&(t.emit("newListener",e,r.listener?r.listener:r),s=t._events),o=s[e]),o===void 0)o=s[e]=r,++t._eventsCount;else if(typeof o=="function"?o=s[e]=n?[r,o]:[o,r]:n?o.unshift(r):o.push(r),(i=da(t))>0&&o.length>i&&!o.warned){o.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=t,c.type=e,c.count=o.length,l=c,console&&console.warn&&console.warn(l)}return t}function ko(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function hi(t,e,r){var n={fired:!1,wrapFn:void 0,target:t,type:e,listener:r},i=ko.bind(n);return i.listener=r,n.wrapFn=i,i}function fi(t,e,r){var n=t._events;if(n===void 0)return[];var i=n[e];return i===void 0?[]:typeof i=="function"?r?[i.listener||i]:[i]:r?function(s){for(var o=new Array(s.length),l=0;l<o.length;++l)o[l]=s[l].listener||s[l];return o}(i):ha(i,i.length)}function pi(t){var e=this._events;if(e!==void 0){var r=e[t];if(typeof r=="function")return 1;if(r!==void 0)return r.length}return 0}function ha(t,e){for(var r=new Array(e),n=0;n<e;++n)r[n]=t[n];return r}function mi(t,e,r,n){if(typeof t.on=="function")n.once?t.once(e,r):t.on(e,r);else{if(typeof t.addEventListener!="function")throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t);t.addEventListener(e,function i(s){n.once&&t.removeEventListener(e,i),r(s)})}}Object.defineProperty(W,"defaultMaxListeners",{enumerable:!0,get:function(){return ui},set:function(t){if(typeof t!="number"||t<0||li(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");ui=t}}),W.init=function(){this._events!==void 0&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},W.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||li(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},W.prototype.getMaxListeners=function(){return da(this)},W.prototype.emit=function(t){for(var e=[],r=1;r<arguments.length;r++)e.push(arguments[r]);var n=t==="error",i=this._events;if(i!==void 0)n=n&&i.error===void 0;else if(!n)return!1;if(n){var s;if(e.length>0&&(s=e[0]),s instanceof Error)throw s;var o=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw o.context=s,o}var l=i[t];if(l===void 0)return!1;if(typeof l=="function")ci(l,this,e);else{var c=l.length,h=ha(l,c);for(r=0;r<c;++r)ci(h[r],this,e)}return!0},W.prototype.addListener=function(t,e){return di(this,t,e,!1)},W.prototype.on=W.prototype.addListener,W.prototype.prependListener=function(t,e){return di(this,t,e,!0)},W.prototype.once=function(t,e){return mr(e),this.on(t,hi(this,t,e)),this},W.prototype.prependOnceListener=function(t,e){return mr(e),this.prependListener(t,hi(this,t,e)),this},W.prototype.removeListener=function(t,e){var r,n,i,s,o;if(mr(e),(n=this._events)===void 0)return this;if((r=n[t])===void 0)return this;if(r===e||r.listener===e)--this._eventsCount==0?this._events=Object.create(null):(delete n[t],n.removeListener&&this.emit("removeListener",t,r.listener||e));else if(typeof r!="function"){for(i=-1,s=r.length-1;s>=0;s--)if(r[s]===e||r[s].listener===e){o=r[s].listener,i=s;break}if(i<0)return this;i===0?r.shift():function(l,c){for(;c+1<l.length;c++)l[c]=l[c+1];l.pop()}(r,i),r.length===1&&(n[t]=r[0]),n.removeListener!==void 0&&this.emit("removeListener",t,o||e)}return this},W.prototype.off=W.prototype.removeListener,W.prototype.removeAllListeners=function(t){var e,r,n;if((r=this._events)===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[t]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete r[t]),this;if(arguments.length===0){var i,s=Object.keys(r);for(n=0;n<s.length;++n)(i=s[n])!=="removeListener"&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(typeof(e=r[t])=="function")this.removeListener(t,e);else if(e!==void 0)for(n=e.length-1;n>=0;n--)this.removeListener(t,e[n]);return this},W.prototype.listeners=function(t){return fi(this,t,!0)},W.prototype.rawListeners=function(t){return fi(this,t,!1)},W.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):pi.call(t,e)},W.prototype.listenerCount=pi,W.prototype.eventNames=function(){return this._eventsCount>0?ua(this._events):[]};var gi=Object.prototype.hasOwnProperty;function vi(t,e,r){for(r of t.keys())if(le(r,e))return r}function le(t,e){var r,n,i;if(t===e)return!0;if(t&&e&&(r=t.constructor)===e.constructor){if(r===Date)return t.getTime()===e.getTime();if(r===RegExp)return t.toString()===e.toString();if(r===Array){if((n=t.length)===e.length)for(;n--&&le(t[n],e[n]););return n===-1}if(r===Set){if(t.size!==e.size)return!1;for(n of t)if((i=n)&&typeof i=="object"&&!(i=vi(e,i))||!e.has(i))return!1;return!0}if(r===Map){if(t.size!==e.size)return!1;for(n of t)if((i=n[0])&&typeof i=="object"&&!(i=vi(e,i))||!le(n[1],e.get(i)))return!1;return!0}if(r===ArrayBuffer)t=new Uint8Array(t),e=new Uint8Array(e);else if(r===DataView){if((n=t.byteLength)===e.byteLength)for(;n--&&t.getInt8(n)===e.getInt8(n););return n===-1}if(ArrayBuffer.isView(t)){if((n=t.byteLength)===e.byteLength)for(;n--&&t[n]===e[n];);return n===-1}if(!r||typeof t=="object"){for(r in n=0,t)if(gi.call(t,r)&&++n&&!gi.call(e,r)||!(r in e)||!le(t[r],e[r]))return!1;return Object.keys(e).length===n}}return t!=t&&e!=e}const Co={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},fa={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},ee={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},ce={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},Ue={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"};class S{static getFirstMatch(e,r){const n=r.match(e);return n&&n.length>0&&n[1]||""}static getSecondMatch(e,r){const n=r.match(e);return n&&n.length>1&&n[2]||""}static matchAndReturnConst(e,r,n){if(e.test(r))return n}static getWindowsVersionName(e){switch(e){case"NT":return"NT";case"XP":case"NT 5.1":return"XP";case"NT 5.0":return"2000";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}}static getMacOSVersionName(e){const r=e.split(".").splice(0,2).map(n=>parseInt(n,10)||0);if(r.push(0),r[0]===10)switch(r[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}}static getAndroidVersionName(e){const r=e.split(".").splice(0,2).map(n=>parseInt(n,10)||0);if(r.push(0),!(r[0]===1&&r[1]<5))return r[0]===1&&r[1]<6?"Cupcake":r[0]===1&&r[1]>=6?"Donut":r[0]===2&&r[1]<2?"Eclair":r[0]===2&&r[1]===2?"Froyo":r[0]===2&&r[1]>2?"Gingerbread":r[0]===3?"Honeycomb":r[0]===4&&r[1]<1?"Ice Cream Sandwich":r[0]===4&&r[1]<4?"Jelly Bean":r[0]===4&&r[1]>=4?"KitKat":r[0]===5?"Lollipop":r[0]===6?"Marshmallow":r[0]===7?"Nougat":r[0]===8?"Oreo":r[0]===9?"Pie":void 0}static getVersionPrecision(e){return e.split(".").length}static compareVersions(e,r,n=!1){const i=S.getVersionPrecision(e),s=S.getVersionPrecision(r);let o=Math.max(i,s),l=0;const c=S.map([e,r],h=>{const f=o-S.getVersionPrecision(h),g=h+new Array(f+1).join(".0");return S.map(g.split("."),y=>new Array(20-y.length).join("0")+y).reverse()});for(n&&(l=o-Math.min(i,s)),o-=1;o>=l;){if(c[0][o]>c[1][o])return 1;if(c[0][o]===c[1][o]){if(o===l)return 0;o-=1}else if(c[0][o]<c[1][o])return-1}}static map(e,r){const n=[];let i;if(Array.prototype.map)return Array.prototype.map.call(e,r);for(i=0;i<e.length;i+=1)n.push(r(e[i]));return n}static find(e,r){let n,i;if(Array.prototype.find)return Array.prototype.find.call(e,r);for(n=0,i=e.length;n<i;n+=1){const s=e[n];if(r(s,n))return s}}static assign(e,...r){const n=e;let i,s;if(Object.assign)return Object.assign(e,...r);for(i=0,s=r.length;i<s;i+=1){const o=r[i];typeof o=="object"&&o!==null&&Object.keys(o).forEach(l=>{n[l]=o[l]})}return e}static getBrowserAlias(e){return Co[e]}static getBrowserTypeByAlias(e){return fa[e]||""}}const H=/version\/(\d+(\.?_?\d+)+)/i,Eo=[{test:[/googlebot/i],describe(t){const e={name:"Googlebot"},r=S.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,t)||S.getFirstMatch(H,t);return r&&(e.version=r),e}},{test:[/opera/i],describe(t){const e={name:"Opera"},r=S.getFirstMatch(H,t)||S.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/opr\/|opios/i],describe(t){const e={name:"Opera"},r=S.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,t)||S.getFirstMatch(H,t);return r&&(e.version=r),e}},{test:[/SamsungBrowser/i],describe(t){const e={name:"Samsung Internet for Android"},r=S.getFirstMatch(H,t)||S.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/Whale/i],describe(t){const e={name:"NAVER Whale Browser"},r=S.getFirstMatch(H,t)||S.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/MZBrowser/i],describe(t){const e={name:"MZ Browser"},r=S.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,t)||S.getFirstMatch(H,t);return r&&(e.version=r),e}},{test:[/focus/i],describe(t){const e={name:"Focus"},r=S.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,t)||S.getFirstMatch(H,t);return r&&(e.version=r),e}},{test:[/swing/i],describe(t){const e={name:"Swing"},r=S.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,t)||S.getFirstMatch(H,t);return r&&(e.version=r),e}},{test:[/coast/i],describe(t){const e={name:"Opera Coast"},r=S.getFirstMatch(H,t)||S.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe(t){const e={name:"Opera Touch"},r=S.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,t)||S.getFirstMatch(H,t);return r&&(e.version=r),e}},{test:[/yabrowser/i],describe(t){const e={name:"Yandex Browser"},r=S.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,t)||S.getFirstMatch(H,t);return r&&(e.version=r),e}},{test:[/ucbrowser/i],describe(t){const e={name:"UC Browser"},r=S.getFirstMatch(H,t)||S.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/Maxthon|mxios/i],describe(t){const e={name:"Maxthon"},r=S.getFirstMatch(H,t)||S.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/epiphany/i],describe(t){const e={name:"Epiphany"},r=S.getFirstMatch(H,t)||S.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/puffin/i],describe(t){const e={name:"Puffin"},r=S.getFirstMatch(H,t)||S.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/sleipnir/i],describe(t){const e={name:"Sleipnir"},r=S.getFirstMatch(H,t)||S.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/k-meleon/i],describe(t){const e={name:"K-Meleon"},r=S.getFirstMatch(H,t)||S.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/micromessenger/i],describe(t){const e={name:"WeChat"},r=S.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,t)||S.getFirstMatch(H,t);return r&&(e.version=r),e}},{test:[/qqbrowser/i],describe(t){const e={name:/qqbrowserlite/i.test(t)?"QQ Browser Lite":"QQ Browser"},r=S.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,t)||S.getFirstMatch(H,t);return r&&(e.version=r),e}},{test:[/msie|trident/i],describe(t){const e={name:"Internet Explorer"},r=S.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/\sedg\//i],describe(t){const e={name:"Microsoft Edge"},r=S.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/edg([ea]|ios)/i],describe(t){const e={name:"Microsoft Edge"},r=S.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/vivaldi/i],describe(t){const e={name:"Vivaldi"},r=S.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/seamonkey/i],describe(t){const e={name:"SeaMonkey"},r=S.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/sailfish/i],describe(t){const e={name:"Sailfish"},r=S.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,t);return r&&(e.version=r),e}},{test:[/silk/i],describe(t){const e={name:"Amazon Silk"},r=S.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/phantom/i],describe(t){const e={name:"PhantomJS"},r=S.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/slimerjs/i],describe(t){const e={name:"SlimerJS"},r=S.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe(t){const e={name:"BlackBerry"},r=S.getFirstMatch(H,t)||S.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/(web|hpw)[o0]s/i],describe(t){const e={name:"WebOS Browser"},r=S.getFirstMatch(H,t)||S.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/bada/i],describe(t){const e={name:"Bada"},r=S.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/tizen/i],describe(t){const e={name:"Tizen"},r=S.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,t)||S.getFirstMatch(H,t);return r&&(e.version=r),e}},{test:[/qupzilla/i],describe(t){const e={name:"QupZilla"},r=S.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,t)||S.getFirstMatch(H,t);return r&&(e.version=r),e}},{test:[/firefox|iceweasel|fxios/i],describe(t){const e={name:"Firefox"},r=S.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/electron/i],describe(t){const e={name:"Electron"},r=S.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/MiuiBrowser/i],describe(t){const e={name:"Miui"},r=S.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/chromium/i],describe(t){const e={name:"Chromium"},r=S.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,t)||S.getFirstMatch(H,t);return r&&(e.version=r),e}},{test:[/chrome|crios|crmo/i],describe(t){const e={name:"Chrome"},r=S.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/GSA/i],describe(t){const e={name:"Google Search"},r=S.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test(t){const e=!t.test(/like android/i),r=t.test(/android/i);return e&&r},describe(t){const e={name:"Android Browser"},r=S.getFirstMatch(H,t);return r&&(e.version=r),e}},{test:[/playstation 4/i],describe(t){const e={name:"PlayStation 4"},r=S.getFirstMatch(H,t);return r&&(e.version=r),e}},{test:[/safari|applewebkit/i],describe(t){const e={name:"Safari"},r=S.getFirstMatch(H,t);return r&&(e.version=r),e}},{test:[/.*/i],describe(t){const e=t.search("\\(")!==-1?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:S.getFirstMatch(e,t),version:S.getSecondMatch(e,t)}}}];var Mo=[{test:[/Roku\/DVP/],describe(t){const e=S.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,t);return{name:ce.Roku,version:e}}},{test:[/windows phone/i],describe(t){const e=S.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,t);return{name:ce.WindowsPhone,version:e}}},{test:[/windows /i],describe(t){const e=S.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,t),r=S.getWindowsVersionName(e);return{name:ce.Windows,version:e,versionName:r}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe(t){const e={name:ce.iOS},r=S.getSecondMatch(/(Version\/)(\d[\d.]+)/,t);return r&&(e.version=r),e}},{test:[/macintosh/i],describe(t){const e=S.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,t).replace(/[_\s]/g,"."),r=S.getMacOSVersionName(e),n={name:ce.MacOS,version:e};return r&&(n.versionName=r),n}},{test:[/(ipod|iphone|ipad)/i],describe(t){const e=S.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,t).replace(/[_\s]/g,".");return{name:ce.iOS,version:e}}},{test(t){const e=!t.test(/like android/i),r=t.test(/android/i);return e&&r},describe(t){const e=S.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,t),r=S.getAndroidVersionName(e),n={name:ce.Android,version:e};return r&&(n.versionName=r),n}},{test:[/(web|hpw)[o0]s/i],describe(t){const e=S.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,t),r={name:ce.WebOS};return e&&e.length&&(r.version=e),r}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe(t){const e=S.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,t)||S.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,t)||S.getFirstMatch(/\bbb(\d+)/i,t);return{name:ce.BlackBerry,version:e}}},{test:[/bada/i],describe(t){const e=S.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,t);return{name:ce.Bada,version:e}}},{test:[/tizen/i],describe(t){const e=S.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,t);return{name:ce.Tizen,version:e}}},{test:[/linux/i],describe:()=>({name:ce.Linux})},{test:[/CrOS/],describe:()=>({name:ce.ChromeOS})},{test:[/PlayStation 4/],describe(t){const e=S.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,t);return{name:ce.PlayStation4,version:e}}}],To=[{test:[/googlebot/i],describe:()=>({type:"bot",vendor:"Google"})},{test:[/huawei/i],describe(t){const e=S.getFirstMatch(/(can-l01)/i,t)&&"Nova",r={type:ee.mobile,vendor:"Huawei"};return e&&(r.model=e),r}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:()=>({type:ee.tablet,vendor:"Nexus"})},{test:[/ipad/i],describe:()=>({type:ee.tablet,vendor:"Apple",model:"iPad"})},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:()=>({type:ee.tablet,vendor:"Apple",model:"iPad"})},{test:[/kftt build/i],describe:()=>({type:ee.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"})},{test:[/silk/i],describe:()=>({type:ee.tablet,vendor:"Amazon"})},{test:[/tablet(?! pc)/i],describe:()=>({type:ee.tablet})},{test(t){const e=t.test(/ipod|iphone/i),r=t.test(/like (ipod|iphone)/i);return e&&!r},describe(t){const e=S.getFirstMatch(/(ipod|iphone)/i,t);return{type:ee.mobile,vendor:"Apple",model:e}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:()=>({type:ee.mobile,vendor:"Nexus"})},{test:[/[^-]mobi/i],describe:()=>({type:ee.mobile})},{test:t=>t.getBrowserName(!0)==="blackberry",describe:()=>({type:ee.mobile,vendor:"BlackBerry"})},{test:t=>t.getBrowserName(!0)==="bada",describe:()=>({type:ee.mobile})},{test:t=>t.getBrowserName()==="windows phone",describe:()=>({type:ee.mobile,vendor:"Microsoft"})},{test(t){const e=Number(String(t.getOSVersion()).split(".")[0]);return t.getOSName(!0)==="android"&&e>=3},describe:()=>({type:ee.tablet})},{test:t=>t.getOSName(!0)==="android",describe:()=>({type:ee.mobile})},{test:t=>t.getOSName(!0)==="macos",describe:()=>({type:ee.desktop,vendor:"Apple"})},{test:t=>t.getOSName(!0)==="windows",describe:()=>({type:ee.desktop})},{test:t=>t.getOSName(!0)==="linux",describe:()=>({type:ee.desktop})},{test:t=>t.getOSName(!0)==="playstation 4",describe:()=>({type:ee.tv})},{test:t=>t.getOSName(!0)==="roku",describe:()=>({type:ee.tv})}],Ao=[{test:t=>t.getBrowserName(!0)==="microsoft edge",describe(t){if(/\sedg\//i.test(t))return{name:Ue.Blink};const e=S.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,t);return{name:Ue.EdgeHTML,version:e}}},{test:[/trident/i],describe(t){const e={name:Ue.Trident},r=S.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:t=>t.test(/presto/i),describe(t){const e={name:Ue.Presto},r=S.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test(t){const e=t.test(/gecko/i),r=t.test(/like gecko/i);return e&&!r},describe(t){const e={name:Ue.Gecko},r=S.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/(apple)?webkit\/537\.36/i],describe:()=>({name:Ue.Blink})},{test:[/(apple)?webkit/i],describe(t){const e={name:Ue.WebKit},r=S.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}}];class yi{constructor(e,r=!1){if(e==null||e==="")throw new Error("UserAgent parameter can't be empty");this._ua=e,this.parsedResult={},r!==!0&&this.parse()}getUA(){return this._ua}test(e){return e.test(this._ua)}parseBrowser(){this.parsedResult.browser={};const e=S.find(Eo,r=>{if(typeof r.test=="function")return r.test(this);if(r.test instanceof Array)return r.test.some(n=>this.test(n));throw new Error("Browser's test function is not valid")});return e&&(this.parsedResult.browser=e.describe(this.getUA())),this.parsedResult.browser}getBrowser(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()}getBrowserName(e){return e?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""}getBrowserVersion(){return this.getBrowser().version}getOS(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()}parseOS(){this.parsedResult.os={};const e=S.find(Mo,r=>{if(typeof r.test=="function")return r.test(this);if(r.test instanceof Array)return r.test.some(n=>this.test(n));throw new Error("Browser's test function is not valid")});return e&&(this.parsedResult.os=e.describe(this.getUA())),this.parsedResult.os}getOSName(e){const{name:r}=this.getOS();return e?String(r).toLowerCase()||"":r||""}getOSVersion(){return this.getOS().version}getPlatform(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()}getPlatformType(e=!1){const{type:r}=this.getPlatform();return e?String(r).toLowerCase()||"":r||""}parsePlatform(){this.parsedResult.platform={};const e=S.find(To,r=>{if(typeof r.test=="function")return r.test(this);if(r.test instanceof Array)return r.test.some(n=>this.test(n));throw new Error("Browser's test function is not valid")});return e&&(this.parsedResult.platform=e.describe(this.getUA())),this.parsedResult.platform}getEngine(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()}getEngineName(e){return e?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""}parseEngine(){this.parsedResult.engine={};const e=S.find(Ao,r=>{if(typeof r.test=="function")return r.test(this);if(r.test instanceof Array)return r.test.some(n=>this.test(n));throw new Error("Browser's test function is not valid")});return e&&(this.parsedResult.engine=e.describe(this.getUA())),this.parsedResult.engine}parse(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this}getResult(){return S.assign({},this.parsedResult)}satisfies(e){const r={};let n=0;const i={};let s=0;if(Object.keys(e).forEach(o=>{const l=e[o];typeof l=="string"?(i[o]=l,s+=1):typeof l=="object"&&(r[o]=l,n+=1)}),n>0){const o=Object.keys(r),l=S.find(o,h=>this.isOS(h));if(l){const h=this.satisfies(r[l]);if(h!==void 0)return h}const c=S.find(o,h=>this.isPlatform(h));if(c){const h=this.satisfies(r[c]);if(h!==void 0)return h}}if(s>0){const o=Object.keys(i),l=S.find(o,c=>this.isBrowser(c,!0));if(l!==void 0)return this.compareVersion(i[l])}}isBrowser(e,r=!1){const n=this.getBrowserName().toLowerCase();let i=e.toLowerCase();const s=S.getBrowserTypeByAlias(i);return r&&s&&(i=s.toLowerCase()),i===n}compareVersion(e){let r=[0],n=e,i=!1;const s=this.getBrowserVersion();if(typeof s=="string")return e[0]===">"||e[0]==="<"?(n=e.substr(1),e[1]==="="?(i=!0,n=e.substr(2)):r=[],e[0]===">"?r.push(1):r.push(-1)):e[0]==="="?n=e.substr(1):e[0]==="~"&&(i=!0,n=e.substr(1)),r.indexOf(S.compareVersions(s,n,i))>-1}isOS(e){return this.getOSName(!0)===String(e).toLowerCase()}isPlatform(e){return this.getPlatformType(!0)===String(e).toLowerCase()}isEngine(e){return this.getEngineName(!0)===String(e).toLowerCase()}is(e,r=!1){return this.isBrowser(e,r)||this.isOS(e)||this.isPlatform(e)}some(e=[]){return e.some(r=>this.is(r))}}/*!
 * Bowser - a browser detector
 * https://github.com/lancedikson/bowser
 * MIT License | (c) Dustin Diaz 2012-2015
 * MIT License | (c) Denis Demchenko 2015-2019
 */class Oo{static getParser(e,r=!1){if(typeof e!="string")throw new Error("UserAgent should be a string");return new yi(e,r)}static parse(e){return new yi(e).getResult()}static get BROWSER_MAP(){return fa}static get ENGINE_MAP(){return Ue}static get OS_MAP(){return ce}static get PLATFORMS_MAP(){return ee}}function xr(){return Date.now()+Math.random().toString()}function Bt(){throw new Error("Method must be implemented in subclass")}function pa(t,e){return e!=null&&e.proxyUrl?e.proxyUrl+(e.proxyUrl.slice(-1)==="/"?"":"/")+t.substring(8):t}function _r(t){return t!=null&&t.callObjectBundleUrlOverride?t.callObjectBundleUrlOverride:pa("https://c.daily.co/call-machine/versioned/".concat("0.73.0","/static/call-machine-object-bundle.js"),t)}function wr(t){try{new URL(t)}catch{return!1}return!0}const ma=Object.prototype.toString;function In(t){switch(ma.call(t)){case"[object Error]":case"[object Exception]":case"[object DOMException]":return!0;default:return mt(t,Error)}}function Lt(t,e){return ma.call(t)===`[object ${e}]`}function ga(t){return Lt(t,"ErrorEvent")}function bi(t){return Lt(t,"DOMError")}function Re(t){return Lt(t,"String")}function jn(t){return typeof t=="object"&&t!==null&&"__sentry_template_string__"in t&&"__sentry_template_values__"in t}function ln(t){return t===null||jn(t)||typeof t!="object"&&typeof t!="function"}function Tt(t){return Lt(t,"Object")}function Dr(t){return typeof Event<"u"&&mt(t,Event)}function Ir(t){return!!(t&&t.then&&typeof t.then=="function")}function mt(t,e){try{return t instanceof e}catch{return!1}}function va(t){return!(typeof t!="object"||t===null||!t.__isVue&&!t._isVue)}function Et(t,e=0){return typeof t!="string"||e===0||t.length<=e?t:`${t.slice(0,e)}...`}function _i(t,e){if(!Array.isArray(t))return"";const r=[];for(let n=0;n<t.length;n++){const i=t[n];try{va(i)?r.push("[VueViewModel]"):r.push(String(i))}catch{r.push("[value cannot be serialized]")}}return r.join(e)}function Po(t,e,r=!1){return!!Re(t)&&(Lt(e,"RegExp")?e.test(t):!!Re(e)&&(r?t===e:t.includes(e)))}function rr(t,e=[],r=!1){return e.some(n=>Po(t,n,r))}function Lo(t,e,r=250,n,i,s,o){if(!(s.exception&&s.exception.values&&o&&mt(o.originalException,Error)))return;const l=s.exception.values.length>0?s.exception.values[s.exception.values.length-1]:void 0;var c,h;l&&(s.exception.values=(c=un(t,e,i,o.originalException,n,s.exception.values,l,0),h=r,c.map(f=>(f.value&&(f.value=Et(f.value,h)),f))))}function un(t,e,r,n,i,s,o,l){if(s.length>=r+1)return s;let c=[...s];if(mt(n[i],Error)){wi(o,l);const h=t(e,n[i]),f=c.length;Si(h,i,f,l),c=un(t,e,r,n[i],i,[h,...c],h,f)}return Array.isArray(n.errors)&&n.errors.forEach((h,f)=>{if(mt(h,Error)){wi(o,l);const g=t(e,h),y=c.length;Si(g,`errors[${f}]`,y,l),c=un(t,e,r,h,i,[g,...c],g,y)}}),c}function wi(t,e){t.mechanism=t.mechanism||{type:"generic",handled:!0},t.mechanism={...t.mechanism,...t.type==="AggregateError"&&{is_exception_group:!0},exception_id:e}}function Si(t,e,r,n){t.mechanism=t.mechanism||{type:"generic",handled:!0},t.mechanism={...t.mechanism,type:"chained",source:e,exception_id:r,parent_id:n}}function ki(t){return t===void 0?void 0:t>=400&&t<500?"warning":t>=500?"error":void 0}const ft="8.33.1",z=globalThis;function Sr(t,e,r){const n=z,i=n.__SENTRY__=n.__SENTRY__||{},s=i[ft]=i[ft]||{};return s[t]||(s[t]=e())}const Rn=z;function ya(t,e={}){if(!t)return"<unknown>";try{let r=t;const n=5,i=[];let s=0,o=0;const l=" > ",c=l.length;let h;const f=Array.isArray(e)?e:e.keyAttrs,g=!Array.isArray(e)&&e.maxStringLength||80;for(;r&&s++<n&&(h=xo(r,f),!(h==="html"||s>1&&o+i.length*c+h.length>=g));)i.push(h),o+=h.length,r=r.parentNode;return i.reverse().join(l)}catch{return"<unknown>"}}function xo(t,e){const r=t,n=[];if(!r||!r.tagName)return"";if(Rn.HTMLElement&&r instanceof HTMLElement&&r.dataset){if(r.dataset.sentryComponent)return r.dataset.sentryComponent;if(r.dataset.sentryElement)return r.dataset.sentryElement}n.push(r.tagName.toLowerCase());const i=e&&e.length?e.filter(o=>r.getAttribute(o)).map(o=>[o,r.getAttribute(o)]):null;if(i&&i.length)i.forEach(o=>{n.push(`[${o[0]}="${o[1]}"]`)});else{r.id&&n.push(`#${r.id}`);const o=r.className;if(o&&Re(o)){const l=o.split(/\s+/);for(const c of l)n.push(`.${c}`)}}const s=["aria-label","type","name","title","alt"];for(const o of s){const l=r.getAttribute(o);l&&n.push(`[${o}="${l}"]`)}return n.join("")}const Kt=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,dn=["debug","info","warn","error","log","assert","trace"],kr={};function Nn(t){if(!("console"in z))return t();const e=z.console,r={},n=Object.keys(kr);n.forEach(i=>{const s=kr[i];r[i]=e[i],e[i]=s});try{return t()}finally{n.forEach(i=>{e[i]=r[i]})}}const B=Sr("logger",function(){let t=!1;const e={enable:()=>{t=!0},disable:()=>{t=!1},isEnabled:()=>t};return Kt?dn.forEach(r=>{e[r]=(...n)=>{t&&Nn(()=>{z.console[r](`Sentry Logger [${r}]:`,...n)})}}):dn.forEach(r=>{e[r]=()=>{}}),e}),Do=/^(?:(\w+):)\/\/(?:(\w+)(?::(\w+)?)?@)([\w.-]+)(?::(\d+))?\/(.+)/;function Cr(t,e=!1){const{host:r,path:n,pass:i,port:s,projectId:o,protocol:l,publicKey:c}=t;return`${l}://${c}${e&&i?`:${i}`:""}@${r}${s?`:${s}`:""}/${n&&`${n}/`}${o}`}function Ci(t){return{protocol:t.protocol,publicKey:t.publicKey||"",pass:t.pass||"",host:t.host,port:t.port||"",path:t.path||"",projectId:t.projectId}}function Io(t){const e=typeof t=="string"?function(r){const n=Do.exec(r);if(!n)return void Nn(()=>{console.error(`Invalid Sentry Dsn: ${r}`)});const[i,s,o="",l="",c="",h=""]=n.slice(1);let f="",g=h;const y=g.split("/");if(y.length>1&&(f=y.slice(0,-1).join("/"),g=y.pop()),g){const k=g.match(/^\d+/);k&&(g=k[0])}return Ci({host:l,pass:o,path:f,projectId:g,port:c,protocol:i,publicKey:s})}(t):Ci(t);if(e&&function(r){if(!Kt)return!0;const{port:n,projectId:i,protocol:s}=r;return!(["protocol","publicKey","host","projectId"].find(o=>!r[o]&&(B.error(`Invalid Sentry Dsn: ${o} missing`),!0))||(i.match(/^\d+$/)?function(o){return o==="http"||o==="https"}(s)?n&&isNaN(parseInt(n,10))&&(B.error(`Invalid Sentry Dsn: Invalid port ${n}`),1):(B.error(`Invalid Sentry Dsn: Invalid protocol ${s}`),1):(B.error(`Invalid Sentry Dsn: Invalid projectId ${i}`),1)))}(e))return e}class Me extends Error{constructor(e,r="warn"){super(e),this.message=e,this.name=new.target.prototype.constructor.name,Object.setPrototypeOf(this,new.target.prototype),this.logLevel=r}}function he(t,e,r){if(!(e in t))return;const n=t[e],i=r(n);typeof i=="function"&&ba(i,n),t[e]=i}function gt(t,e,r){try{Object.defineProperty(t,e,{value:r,writable:!0,configurable:!0})}catch{Kt&&B.log(`Failed to add non-enumerable property "${e}" to object`,t)}}function ba(t,e){try{const r=e.prototype||{};t.prototype=e.prototype=r,gt(t,"__sentry_original__",e)}catch{}}function Bn(t){return t.__sentry_original__}function _a(t){if(In(t))return{message:t.message,name:t.name,stack:t.stack,...Mi(t)};if(Dr(t)){const e={type:t.type,target:Ei(t.target),currentTarget:Ei(t.currentTarget),...Mi(t)};return typeof CustomEvent<"u"&&mt(t,CustomEvent)&&(e.detail=t.detail),e}return t}function Ei(t){try{return e=t,typeof Element<"u"&&mt(e,Element)?ya(t):Object.prototype.toString.call(t)}catch{return"<unknown>"}var e}function Mi(t){if(typeof t=="object"&&t!==null){const e={};for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}return{}}function be(t){return hn(t,new Map)}function hn(t,e){if(function(r){if(!Tt(r))return!1;try{const n=Object.getPrototypeOf(r).constructor.name;return!n||n==="Object"}catch{return!0}}(t)){const r=e.get(t);if(r!==void 0)return r;const n={};e.set(t,n);for(const i of Object.getOwnPropertyNames(t))t[i]!==void 0&&(n[i]=hn(t[i],e));return n}if(Array.isArray(t)){const r=e.get(t);if(r!==void 0)return r;const n=[];return e.set(t,n),t.forEach(i=>{n.push(hn(i,e))}),n}return t}const ut="?",Ti=/\(error: (.*)\)/,Ai=/captureMessage|captureException/;function nr(t){return t[t.length-1]||{}}const Oi="<anonymous>";function Qe(t){try{return t&&typeof t=="function"&&t.name||Oi}catch{return Oi}}function Pi(t){const e=t.exception;if(e){const r=[];try{return e.values.forEach(n=>{n.stacktrace.frames&&r.push(...n.stacktrace.frames)}),r}catch{return}}}const gr={},Li={};function dt(t,e){gr[t]=gr[t]||[],gr[t].push(e)}function ht(t,e){Li[t]||(e(),Li[t]=!0)}function _e(t,e){const r=t&&gr[t];if(r)for(const n of r)try{n(e)}catch(i){Kt&&B.error(`Error while triggering instrumentation handler.
Type: ${t}
Name: ${Qe(n)}
Error:`,i)}}function jo(){"console"in z&&dn.forEach(function(t){t in z.console&&he(z.console,t,function(e){return kr[t]=e,function(...r){_e("console",{args:r,level:t});const n=kr[t];n&&n.apply(z.console,r)}})})}const Vr=z;function fn(t){return t&&/^function\s+\w+\(\)\s+\{\s+\[native code\]\s+\}$/.test(t.toString())}function Ro(){if(typeof EdgeRuntime=="string")return!0;if(!function(){if(!("fetch"in Vr))return!1;try{return new Headers,new Request("http://www.example.com"),new Response,!0}catch{return!1}}())return!1;if(fn(Vr.fetch))return!0;let t=!1;const e=Vr.document;if(e&&typeof e.createElement=="function")try{const r=e.createElement("iframe");r.hidden=!0,e.head.appendChild(r),r.contentWindow&&r.contentWindow.fetch&&(t=fn(r.contentWindow.fetch)),e.head.removeChild(r)}catch(r){Kt&&B.warn("Could not create sandbox iframe for pure fetch check, bailing to window.fetch: ",r)}return t}function Yt(){return Date.now()/1e3}const We=function(){const{performance:t}=z;if(!t||!t.now)return Yt;const e=Date.now()-t.now(),r=t.timeOrigin==null?e:t.timeOrigin;return()=>(r+t.now())/1e3}();function No(t,e){const r="fetch";dt(r,t),ht(r,()=>function(n,i=!1){i&&!Ro()||he(z,"fetch",function(s){return function(...o){const{method:l,url:c}=function(g){if(g.length===0)return{method:"GET",url:""};if(g.length===2){const[k,v]=g;return{url:xi(k),method:pn(v,"method")?String(v.method).toUpperCase():"GET"}}const y=g[0];return{url:xi(y),method:pn(y,"method")?String(y.method).toUpperCase():"GET"}}(o),h={args:o,fetchData:{method:l,url:c},startTimestamp:1e3*We()};_e("fetch",{...h});const f=new Error().stack;return s.apply(z,o).then(async g=>(_e("fetch",{...h,endTimestamp:1e3*We(),response:g}),g),g=>{throw _e("fetch",{...h,endTimestamp:1e3*We(),error:g}),In(g)&&g.stack===void 0&&(g.stack=f,gt(g,"framesToPop",1)),g})}})}(void 0,e))}function pn(t,e){return!!t&&typeof t=="object"&&!!t[e]}function xi(t){return typeof t=="string"?t:t?pn(t,"url")?t.url:t.toString?t.toString():"":""}(()=>{const{performance:t}=z;!t||!t.now||(t.now(),t.timing&&t.timing.navigationStart)})();let ir=null;function Bo(){ir=z.onerror,z.onerror=function(t,e,r,n,i){return _e("error",{column:n,error:i,line:r,msg:t,url:e}),!(!ir||ir.__SENTRY_LOADER__)&&ir.apply(this,arguments)},z.onerror.__SENTRY_INSTRUMENTED__=!0}let sr=null;function Fo(){sr=z.onunhandledrejection,z.onunhandledrejection=function(t){return _e("unhandledrejection",t),!(sr&&!sr.__SENTRY_LOADER__)||sr.apply(this,arguments)},z.onunhandledrejection.__SENTRY_INSTRUMENTED__=!0}function we(){const t=z,e=t.crypto||t.msCrypto;let r=()=>16*Math.random();try{if(e&&e.randomUUID)return e.randomUUID().replace(/-/g,"");e&&e.getRandomValues&&(r=()=>{const n=new Uint8Array(1);return e.getRandomValues(n),n[0]})}catch{}return("10000000100040008000"+1e11).replace(/[018]/g,n=>(n^(15&r())>>n/4).toString(16))}function wa(t){return t.exception&&t.exception.values?t.exception.values[0]:void 0}function $e(t){const{message:e,event_id:r}=t;if(e)return e;const n=wa(t);return n?n.type&&n.value?`${n.type}: ${n.value}`:n.type||n.value||r||"<unknown>":r||"<unknown>"}function mn(t,e,r){const n=t.exception=t.exception||{},i=n.values=n.values||[],s=i[0]=i[0]||{};s.value||(s.value=e||""),s.type||(s.type="Error")}function zt(t,e){const r=wa(t);if(!r)return;const n=r.mechanism;if(r.mechanism={type:"generic",handled:!0,...n,...e},e&&"data"in e){const i={...n&&n.data,...e.data};r.mechanism.data=i}}function Di(t){if(t&&t.__sentry_captured__)return!0;try{gt(t,"__sentry_captured__",!0)}catch{}return!1}function qe(t,e=100,r=1/0){try{return gn("",t,e,r)}catch(n){return{ERROR:`**non-serializable** (${n})`}}}function Sa(t,e=3,r=102400){const n=qe(t,e);return i=n,function(s){return~-encodeURI(s).split(/%..|./).length}(JSON.stringify(i))>r?Sa(t,e-1,r):n;var i}function gn(t,e,r=1/0,n=1/0,i=function(){const s=typeof WeakSet=="function",o=s?new WeakSet:[];return[function(l){if(s)return!!o.has(l)||(o.add(l),!1);for(let c=0;c<o.length;c++)if(o[c]===l)return!0;return o.push(l),!1},function(l){if(s)o.delete(l);else for(let c=0;c<o.length;c++)if(o[c]===l){o.splice(c,1);break}}]}()){const[s,o]=i;if(e==null||["boolean","string"].includes(typeof e)||typeof e=="number"&&Number.isFinite(e))return e;const l=function(k,v){try{if(k==="domain"&&v&&typeof v=="object"&&v._events)return"[Domain]";if(k==="domainEmitter")return"[DomainEmitter]";if(typeof global<"u"&&v===global)return"[Global]";if(typeof window<"u"&&v===window)return"[Window]";if(typeof document<"u"&&v===document)return"[Document]";if(va(v))return"[VueViewModel]";if(Tt(b=v)&&"nativeEvent"in b&&"preventDefault"in b&&"stopPropagation"in b)return"[SyntheticEvent]";if(typeof v=="number"&&!Number.isFinite(v))return`[${v}]`;if(typeof v=="function")return`[Function: ${Qe(v)}]`;if(typeof v=="symbol")return`[${String(v)}]`;if(typeof v=="bigint")return`[BigInt: ${String(v)}]`;const M=function(O){const x=Object.getPrototypeOf(O);return x?x.constructor.name:"null prototype"}(v);return/^HTML(\w*)Element$/.test(M)?`[HTMLElement: ${M}]`:`[object ${M}]`}catch(M){return`**non-serializable** (${M})`}var b}(t,e);if(!l.startsWith("[object "))return l;if(e.__sentry_skip_normalization__)return e;const c=typeof e.__sentry_override_normalization_depth__=="number"?e.__sentry_override_normalization_depth__:r;if(c===0)return l.replace("object ","");if(s(e))return"[Circular ~]";const h=e;if(h&&typeof h.toJSON=="function")try{return gn("",h.toJSON(),c-1,n,i)}catch{}const f=Array.isArray(e)?[]:{};let g=0;const y=_a(e);for(const k in y){if(!Object.prototype.hasOwnProperty.call(y,k))continue;if(g>=n){f[k]="[MaxProperties ~]";break}const v=y[k];f[k]=gn(k,v,c-1,n,i),g++}return o(e),f}var De;function vt(t){return new fe(e=>{e(t)})}function Er(t){return new fe((e,r)=>{r(t)})}(function(t){t[t.PENDING=0]="PENDING",t[t.RESOLVED=1]="RESOLVED",t[t.REJECTED=2]="REJECTED"})(De||(De={}));class fe{constructor(e){fe.prototype.__init.call(this),fe.prototype.__init2.call(this),fe.prototype.__init3.call(this),fe.prototype.__init4.call(this),this._state=De.PENDING,this._handlers=[];try{e(this._resolve,this._reject)}catch(r){this._reject(r)}}then(e,r){return new fe((n,i)=>{this._handlers.push([!1,s=>{if(e)try{n(e(s))}catch(o){i(o)}else n(s)},s=>{if(r)try{n(r(s))}catch(o){i(o)}else i(s)}]),this._executeHandlers()})}catch(e){return this.then(r=>r,e)}finally(e){return new fe((r,n)=>{let i,s;return this.then(o=>{s=!1,i=o,e&&e()},o=>{s=!0,i=o,e&&e()}).then(()=>{s?n(i):r(i)})})}__init(){this._resolve=e=>{this._setResult(De.RESOLVED,e)}}__init2(){this._reject=e=>{this._setResult(De.REJECTED,e)}}__init3(){this._setResult=(e,r)=>{this._state===De.PENDING&&(Ir(r)?r.then(this._resolve,this._reject):(this._state=e,this._value=r,this._executeHandlers()))}}__init4(){this._executeHandlers=()=>{if(this._state===De.PENDING)return;const e=this._handlers.slice();this._handlers=[],e.forEach(r=>{r[0]||(this._state===De.RESOLVED&&r[1](this._value),this._state===De.REJECTED&&r[2](this._value),r[0]=!0)})}}}function Uo(t){const e=[];function r(n){return e.splice(e.indexOf(n),1)[0]||Promise.resolve(void 0)}return{$:e,add:function(n){if(!(t===void 0||e.length<t))return Er(new Me("Not adding Promise because buffer limit was reached."));const i=n();return e.indexOf(i)===-1&&e.push(i),i.then(()=>r(i)).then(null,()=>r(i).then(null,()=>{})),i},drain:function(n){return new fe((i,s)=>{let o=e.length;if(!o)return i(!0);const l=setTimeout(()=>{n&&n>0&&i(!1)},n);e.forEach(c=>{vt(c).then(()=>{--o||(clearTimeout(l),i(!0))},s)})})}}}function zr(t){if(!t)return{};const e=t.match(/^(([^:/?#]+):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/);if(!e)return{};const r=e[6]||"",n=e[8]||"";return{host:e[4],path:e[5],protocol:e[2],search:r,hash:n,relative:e[5]+r+n}}const $o=["fatal","error","warning","log","info","debug"];function qo(t){return t==="warn"?"warning":$o.includes(t)?t:"log"}const Jo=/^sentry-/;function Vo(t){const e=function(n){if(!(!n||!Re(n)&&!Array.isArray(n)))return Array.isArray(n)?n.reduce((i,s)=>{const o=Ii(s);return Object.entries(o).forEach(([l,c])=>{i[l]=c}),i},{}):Ii(n)}(t);if(!e)return;const r=Object.entries(e).reduce((n,[i,s])=>(i.match(Jo)&&(n[i.slice(7)]=s),n),{});return Object.keys(r).length>0?r:void 0}function Ii(t){return t.split(",").map(e=>e.split("=").map(r=>decodeURIComponent(r.trim()))).reduce((e,[r,n])=>(r&&n&&(e[r]=n),e),{})}function Wt(t,e=[]){return[t,e]}function zo(t,e){const[r,n]=t;return[r,[...n,e]]}function ji(t,e){const r=t[1];for(const n of r)if(e(n,n[0].type))return!0;return!1}function vn(t){return z.__SENTRY__&&z.__SENTRY__.encodePolyfill?z.__SENTRY__.encodePolyfill(t):new TextEncoder().encode(t)}function Wo(t){const[e,r]=t;let n=JSON.stringify(e);function i(s){typeof n=="string"?n=typeof s=="string"?n+s:[vn(n),s]:n.push(typeof s=="string"?vn(s):s)}for(const s of r){const[o,l]=s;if(i(`
${JSON.stringify(o)}
`),typeof l=="string"||l instanceof Uint8Array)i(l);else{let c;try{c=JSON.stringify(l)}catch{c=JSON.stringify(qe(l))}i(c)}}return typeof n=="string"?n:function(s){const o=s.reduce((h,f)=>h+f.length,0),l=new Uint8Array(o);let c=0;for(const h of s)l.set(h,c),c+=h.length;return l}(n)}function Go(t){const e=typeof t.data=="string"?vn(t.data):t.data;return[be({type:"attachment",length:e.length,filename:t.filename,content_type:t.contentType,attachment_type:t.attachmentType}),e]}const Ho={session:"session",sessions:"session",attachment:"attachment",transaction:"transaction",event:"error",client_report:"internal",user_report:"default",profile:"profile",profile_chunk:"profile",replay_event:"replay",replay_recording:"replay",check_in:"monitor",feedback:"feedback",span:"span",statsd:"metric_bucket"};function Ri(t){return Ho[t]}function ka(t){if(!t||!t.sdk)return;const{name:e,version:r}=t.sdk;return{name:e,version:r}}function Qo(t,{statusCode:e,headers:r},n=Date.now()){const i={...t},s=r&&r["x-sentry-rate-limits"],o=r&&r["retry-after"];if(s)for(const l of s.trim().split(",")){const[c,h,,,f]=l.split(":",5),g=parseInt(c,10),y=1e3*(isNaN(g)?60:g);if(h)for(const k of h.split(";"))k==="metric_bucket"&&f&&!f.split(";").includes("custom")||(i[k]=n+y);else i.all=n+y}else o?i.all=n+function(l,c=Date.now()){const h=parseInt(`${l}`,10);if(!isNaN(h))return 1e3*h;const f=Date.parse(`${l}`);return isNaN(f)?6e4:f-c}(o,n):e===429&&(i.all=n+6e4);return i}function Ni(){return{traceId:we(),spanId:we().substring(16)}}const ar=z,Y=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__;function jr(){return Fn(z),z}function Fn(t){const e=t.__SENTRY__=t.__SENTRY__||{};return e.version=e.version||ft,e[ft]=e[ft]||{}}function yn(t,e={}){if(e.user&&(!t.ipAddress&&e.user.ip_address&&(t.ipAddress=e.user.ip_address),t.did||e.did||(t.did=e.user.id||e.user.email||e.user.username)),t.timestamp=e.timestamp||We(),e.abnormal_mechanism&&(t.abnormal_mechanism=e.abnormal_mechanism),e.ignoreDuration&&(t.ignoreDuration=e.ignoreDuration),e.sid&&(t.sid=e.sid.length===32?e.sid:we()),e.init!==void 0&&(t.init=e.init),!t.did&&e.did&&(t.did=`${e.did}`),typeof e.started=="number"&&(t.started=e.started),t.ignoreDuration)t.duration=void 0;else if(typeof e.duration=="number")t.duration=e.duration;else{const r=t.timestamp-t.started;t.duration=r>=0?r:0}e.release&&(t.release=e.release),e.environment&&(t.environment=e.environment),!t.ipAddress&&e.ipAddress&&(t.ipAddress=e.ipAddress),!t.userAgent&&e.userAgent&&(t.userAgent=e.userAgent),typeof e.errors=="number"&&(t.errors=e.errors),e.status&&(t.status=e.status)}const bn="_sentrySpan";function Bi(t,e){e?gt(t,bn,e):delete t[bn]}function Fi(t){return t[bn]}class Un{constructor(){this._notifyingListeners=!1,this._scopeListeners=[],this._eventProcessors=[],this._breadcrumbs=[],this._attachments=[],this._user={},this._tags={},this._extra={},this._contexts={},this._sdkProcessingMetadata={},this._propagationContext=Ni()}clone(){const e=new Un;return e._breadcrumbs=[...this._breadcrumbs],e._tags={...this._tags},e._extra={...this._extra},e._contexts={...this._contexts},e._user=this._user,e._level=this._level,e._session=this._session,e._transactionName=this._transactionName,e._fingerprint=this._fingerprint,e._eventProcessors=[...this._eventProcessors],e._requestSession=this._requestSession,e._attachments=[...this._attachments],e._sdkProcessingMetadata={...this._sdkProcessingMetadata},e._propagationContext={...this._propagationContext},e._client=this._client,e._lastEventId=this._lastEventId,Bi(e,Fi(this)),e}setClient(e){this._client=e}setLastEventId(e){this._lastEventId=e}getClient(){return this._client}lastEventId(){return this._lastEventId}addScopeListener(e){this._scopeListeners.push(e)}addEventProcessor(e){return this._eventProcessors.push(e),this}setUser(e){return this._user=e||{email:void 0,id:void 0,ip_address:void 0,username:void 0},this._session&&yn(this._session,{user:e}),this._notifyScopeListeners(),this}getUser(){return this._user}getRequestSession(){return this._requestSession}setRequestSession(e){return this._requestSession=e,this}setTags(e){return this._tags={...this._tags,...e},this._notifyScopeListeners(),this}setTag(e,r){return this._tags={...this._tags,[e]:r},this._notifyScopeListeners(),this}setExtras(e){return this._extra={...this._extra,...e},this._notifyScopeListeners(),this}setExtra(e,r){return this._extra={...this._extra,[e]:r},this._notifyScopeListeners(),this}setFingerprint(e){return this._fingerprint=e,this._notifyScopeListeners(),this}setLevel(e){return this._level=e,this._notifyScopeListeners(),this}setTransactionName(e){return this._transactionName=e,this._notifyScopeListeners(),this}setContext(e,r){return r===null?delete this._contexts[e]:this._contexts[e]=r,this._notifyScopeListeners(),this}setSession(e){return e?this._session=e:delete this._session,this._notifyScopeListeners(),this}getSession(){return this._session}update(e){if(!e)return this;const r=typeof e=="function"?e(this):e,[n,i]=r instanceof Ke?[r.getScopeData(),r.getRequestSession()]:Tt(r)?[e,e.requestSession]:[],{tags:s,extra:o,user:l,contexts:c,level:h,fingerprint:f=[],propagationContext:g}=n||{};return this._tags={...this._tags,...s},this._extra={...this._extra,...o},this._contexts={...this._contexts,...c},l&&Object.keys(l).length&&(this._user=l),h&&(this._level=h),f.length&&(this._fingerprint=f),g&&(this._propagationContext=g),i&&(this._requestSession=i),this}clear(){return this._breadcrumbs=[],this._tags={},this._extra={},this._user={},this._contexts={},this._level=void 0,this._transactionName=void 0,this._fingerprint=void 0,this._requestSession=void 0,this._session=void 0,Bi(this,void 0),this._attachments=[],this._propagationContext=Ni(),this._notifyScopeListeners(),this}addBreadcrumb(e,r){const n=typeof r=="number"?r:100;if(n<=0)return this;const i={timestamp:Yt(),...e},s=this._breadcrumbs;return s.push(i),this._breadcrumbs=s.length>n?s.slice(-n):s,this._notifyScopeListeners(),this}getLastBreadcrumb(){return this._breadcrumbs[this._breadcrumbs.length-1]}clearBreadcrumbs(){return this._breadcrumbs=[],this._notifyScopeListeners(),this}addAttachment(e){return this._attachments.push(e),this}clearAttachments(){return this._attachments=[],this}getScopeData(){return{breadcrumbs:this._breadcrumbs,attachments:this._attachments,contexts:this._contexts,tags:this._tags,extra:this._extra,user:this._user,level:this._level,fingerprint:this._fingerprint||[],eventProcessors:this._eventProcessors,propagationContext:this._propagationContext,sdkProcessingMetadata:this._sdkProcessingMetadata,transactionName:this._transactionName,span:Fi(this)}}setSDKProcessingMetadata(e){return this._sdkProcessingMetadata={...this._sdkProcessingMetadata,...e},this}setPropagationContext(e){return this._propagationContext=e,this}getPropagationContext(){return this._propagationContext}captureException(e,r){const n=r&&r.event_id?r.event_id:we();if(!this._client)return B.warn("No client configured on scope - will not capture exception!"),n;const i=new Error("Sentry syntheticException");return this._client.captureException(e,{originalException:e,syntheticException:i,...r,event_id:n},this),n}captureMessage(e,r,n){const i=n&&n.event_id?n.event_id:we();if(!this._client)return B.warn("No client configured on scope - will not capture message!"),i;const s=new Error(e);return this._client.captureMessage(e,r,{originalException:e,syntheticException:s,...n,event_id:i},this),i}captureEvent(e,r){const n=r&&r.event_id?r.event_id:we();return this._client?(this._client.captureEvent(e,{...r,event_id:n},this),n):(B.warn("No client configured on scope - will not capture event!"),n)}_notifyScopeListeners(){this._notifyingListeners||(this._notifyingListeners=!0,this._scopeListeners.forEach(e=>{e(this)}),this._notifyingListeners=!1)}}const Ke=Un;class Ko{constructor(e,r){let n,i;n=e||new Ke,i=r||new Ke,this._stack=[{scope:n}],this._isolationScope=i}withScope(e){const r=this._pushScope();let n;try{n=e(r)}catch(i){throw this._popScope(),i}return Ir(n)?n.then(i=>(this._popScope(),i),i=>{throw this._popScope(),i}):(this._popScope(),n)}getClient(){return this.getStackTop().client}getScope(){return this.getStackTop().scope}getIsolationScope(){return this._isolationScope}getStackTop(){return this._stack[this._stack.length-1]}_pushScope(){const e=this.getScope().clone();return this._stack.push({client:this.getClient(),scope:e}),e}_popScope(){return!(this._stack.length<=1)&&!!this._stack.pop()}}function At(){const t=Fn(jr());return t.stack=t.stack||new Ko(Sr("defaultCurrentScope",()=>new Ke),Sr("defaultIsolationScope",()=>new Ke))}function Yo(t){return At().withScope(t)}function Xo(t,e){const r=At();return r.withScope(()=>(r.getStackTop().scope=t,e(t)))}function Ui(t){return At().withScope(()=>t(At().getIsolationScope()))}function $n(t){const e=Fn(t);return e.acs?e.acs:{withIsolationScope:Ui,withScope:Yo,withSetScope:Xo,withSetIsolationScope:(r,n)=>Ui(n),getCurrentScope:()=>At().getScope(),getIsolationScope:()=>At().getIsolationScope()}}function qn(){return $n(jr()).getCurrentScope()}function Ca(){return $n(jr()).getIsolationScope()}function ue(){return qn().getClient()}function Zo(t){const e=t._sentryMetrics;if(!e)return;const r={};for(const[,[n,i]]of e)(r[n]||(r[n]=[])).push(be(i));return r}function ec(t){const{spanId:e,traceId:r}=t.spanContext(),{parent_span_id:n}=Mr(t);return be({parent_span_id:n,span_id:e,trace_id:r})}function $i(t){return typeof t=="number"?qi(t):Array.isArray(t)?t[0]+t[1]/1e9:t instanceof Date?qi(t.getTime()):We()}function qi(t){return t>9999999999?t/1e3:t}function Mr(t){if(function(e){return typeof e.getSpanJSON=="function"}(t))return t.getSpanJSON();try{const{spanId:e,traceId:r}=t.spanContext();if(function(n){const i=n;return!!(i.attributes&&i.startTime&&i.name&&i.endTime&&i.status)}(t)){const{attributes:n,startTime:i,name:s,endTime:o,parentSpanId:l,status:c}=t;return be({span_id:e,trace_id:r,data:n,description:s,parent_span_id:l,start_timestamp:$i(i),timestamp:$i(o)||void 0,status:tc(c),op:n["sentry.op"],origin:n["sentry.origin"],_metrics_summary:Zo(t)})}return{span_id:e,trace_id:r}}catch{return{}}}function tc(t){if(t&&t.code!==0)return t.code===1?"ok":t.message||"unknown_error"}function Ea(t){return t._sentryRootSpan||t}const Ma="production";function Ta(t,e){const r=e.getOptions(),{publicKey:n}=e.getDsn()||{},i=be({environment:r.environment||Ma,release:r.release,public_key:n,trace_id:t});return e.emit("createDsc",i),i}function rc(t){const e=ue();if(!e)return{};const r=Ta(Mr(t).trace_id||"",e),n=Ea(t),i=n._frozenDsc;if(i)return i;const s=n.spanContext().traceState,o=s&&s.get("sentry.dsc"),l=o&&Vo(o);if(l)return l;const c=Mr(n),h=c.data||{},f=h["sentry.sample_rate"];f!=null&&(r.sample_rate=`${f}`);const g=h["sentry.source"],y=c.description;return g!=="url"&&y&&(r.transaction=y),function(k){if(typeof __SENTRY_TRACING__=="boolean"&&!__SENTRY_TRACING__)return!1;const v=ue(),b=v&&v.getOptions();return!!b&&(b.enableTracing||"tracesSampleRate"in b||"tracesSampler"in b)}()&&(r.sampled=String(function(k){const{traceFlags:v}=k.spanContext();return v===1}(n))),e.emit("createDsc",r,n),r}function nc(t,e,r,n){const i=ka(r),s=t.type&&t.type!=="replay_event"?t.type:"event";(function(l,c){c&&(l.sdk=l.sdk||{},l.sdk.name=l.sdk.name||c.name,l.sdk.version=l.sdk.version||c.version,l.sdk.integrations=[...l.sdk.integrations||[],...c.integrations||[]],l.sdk.packages=[...l.sdk.packages||[],...c.packages||[]])})(t,r&&r.sdk);const o=function(l,c,h,f){const g=l.sdkProcessingMetadata&&l.sdkProcessingMetadata.dynamicSamplingContext;return{event_id:l.event_id,sent_at:new Date().toISOString(),...c&&{sdk:c},...!!h&&f&&{dsn:Cr(f)},...g&&{trace:be({...g})}}}(t,i,n,e);return delete t.sdkProcessingMetadata,Wt(o,[[{type:s},t]])}function _n(t,e,r,n=0){return new fe((i,s)=>{const o=t[n];if(e===null||typeof o!="function")i(e);else{const l=o({...e},r);Y&&o.id&&l===null&&B.log(`Event processor "${o.id}" dropped event`),Ir(l)?l.then(c=>_n(t,c,r,n+1).then(i)).then(null,s):_n(t,l,r,n+1).then(i).then(null,s)}})}function ic(t,e){const{fingerprint:r,span:n,breadcrumbs:i,sdkProcessingMetadata:s}=e;(function(o,l){const{extra:c,tags:h,user:f,contexts:g,level:y,transactionName:k}=l,v=be(c);v&&Object.keys(v).length&&(o.extra={...v,...o.extra});const b=be(h);b&&Object.keys(b).length&&(o.tags={...b,...o.tags});const M=be(f);M&&Object.keys(M).length&&(o.user={...M,...o.user});const O=be(g);O&&Object.keys(O).length&&(o.contexts={...O,...o.contexts}),y&&(o.level=y),k&&o.type!=="transaction"&&(o.transaction=k)})(t,e),n&&function(o,l){o.contexts={trace:ec(l),...o.contexts},o.sdkProcessingMetadata={dynamicSamplingContext:rc(l),...o.sdkProcessingMetadata};const c=Ea(l),h=Mr(c).description;h&&!o.transaction&&o.type==="transaction"&&(o.transaction=h)}(t,n),function(o,l){o.fingerprint=o.fingerprint?function(c){return Array.isArray(c)?c:[c]}(o.fingerprint):[],l&&(o.fingerprint=o.fingerprint.concat(l)),o.fingerprint&&!o.fingerprint.length&&delete o.fingerprint}(t,r),function(o,l){const c=[...o.breadcrumbs||[],...l];o.breadcrumbs=c.length?c:void 0}(t,i),function(o,l){o.sdkProcessingMetadata={...o.sdkProcessingMetadata,...l}}(t,s)}function Ji(t,e){const{extra:r,tags:n,user:i,contexts:s,level:o,sdkProcessingMetadata:l,breadcrumbs:c,fingerprint:h,eventProcessors:f,attachments:g,propagationContext:y,transactionName:k,span:v}=e;Ft(t,"extra",r),Ft(t,"tags",n),Ft(t,"user",i),Ft(t,"contexts",s),Ft(t,"sdkProcessingMetadata",l),o&&(t.level=o),k&&(t.transactionName=k),v&&(t.span=v),c.length&&(t.breadcrumbs=[...t.breadcrumbs,...c]),h.length&&(t.fingerprint=[...t.fingerprint,...h]),f.length&&(t.eventProcessors=[...t.eventProcessors,...f]),g.length&&(t.attachments=[...t.attachments,...g]),t.propagationContext={...t.propagationContext,...y}}function Ft(t,e,r){if(r&&Object.keys(r).length){t[e]={...t[e]};for(const n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[e][n]=r[n])}}function sc(t,e,r,n,i,s){const{normalizeDepth:o=3,normalizeMaxBreadth:l=1e3}=t,c={...e,event_id:e.event_id||r.event_id||we(),timestamp:e.timestamp||Yt()},h=r.integrations||t.integrations.map(v=>v.name);(function(v,b){const{environment:M,release:O,dist:x,maxValueLength:D=250}=b;"environment"in v||(v.environment="environment"in b?M:Ma),v.release===void 0&&O!==void 0&&(v.release=O),v.dist===void 0&&x!==void 0&&(v.dist=x),v.message&&(v.message=Et(v.message,D));const C=v.exception&&v.exception.values&&v.exception.values[0];C&&C.value&&(C.value=Et(C.value,D));const w=v.request;w&&w.url&&(w.url=Et(w.url,D))})(c,t),function(v,b){b.length>0&&(v.sdk=v.sdk||{},v.sdk.integrations=[...v.sdk.integrations||[],...b])}(c,h),i&&i.emit("applyFrameMetadata",e),e.type===void 0&&function(v,b){const M=z._sentryDebugIds;if(!M)return;let O;const x=Vi.get(b);x?O=x:(O=new Map,Vi.set(b,O));const D=Object.entries(M).reduce((C,[w,E])=>{let A;const L=O.get(w);L?A=L:(A=b(w),O.set(w,A));for(let F=A.length-1;F>=0;F--){const N=A[F];if(N.filename){C[N.filename]=E;break}}return C},{});try{v.exception.values.forEach(C=>{C.stacktrace.frames.forEach(w=>{w.filename&&(w.debug_id=D[w.filename])})})}catch{}}(c,t.stackParser);const f=function(v,b){if(!b)return v;const M=v?v.clone():new Ke;return M.update(b),M}(n,r.captureContext);r.mechanism&&zt(c,r.mechanism);const g=i?i.getEventProcessors():[],y=Sr("globalScope",()=>new Ke).getScopeData();s&&Ji(y,s.getScopeData()),f&&Ji(y,f.getScopeData());const k=[...r.attachments||[],...y.attachments];return k.length&&(r.attachments=k),ic(c,y),_n([...g,...y.eventProcessors],c,r).then(v=>(v&&function(b){const M={};try{b.exception.values.forEach(x=>{x.stacktrace.frames.forEach(D=>{D.debug_id&&(D.abs_path?M[D.abs_path]=D.debug_id:D.filename&&(M[D.filename]=D.debug_id),delete D.debug_id)})})}catch{}if(Object.keys(M).length===0)return;b.debug_meta=b.debug_meta||{},b.debug_meta.images=b.debug_meta.images||[];const O=b.debug_meta.images;Object.entries(M).forEach(([x,D])=>{O.push({type:"sourcemap",code_file:x,debug_id:D})})}(v),typeof o=="number"&&o>0?function(b,M,O){if(!b)return null;const x={...b,...b.breadcrumbs&&{breadcrumbs:b.breadcrumbs.map(D=>({...D,...D.data&&{data:qe(D.data,M,O)}}))},...b.user&&{user:qe(b.user,M,O)},...b.contexts&&{contexts:qe(b.contexts,M,O)},...b.extra&&{extra:qe(b.extra,M,O)}};return b.contexts&&b.contexts.trace&&x.contexts&&(x.contexts.trace=b.contexts.trace,b.contexts.trace.data&&(x.contexts.trace.data=qe(b.contexts.trace.data,M,O))),b.spans&&(x.spans=b.spans.map(D=>({...D,...D.data&&{data:qe(D.data,M,O)}}))),x}(v,o,l):v))}const Vi=new WeakMap;function zi(t,e){return qn().captureEvent(t,e)}function ac(t,e){return r={sentry_key:t.publicKey,sentry_version:"7",...e&&{sentry_client:`${e.name}/${e.version}`}},Object.keys(r).map(n=>`${encodeURIComponent(n)}=${encodeURIComponent(r[n])}`).join("&");var r}const Wi=[];function Gi(t,e){for(const r of e)r&&r.afterAllSetup&&r.afterAllSetup(t)}function Hi(t,e,r){if(r[e.name])Y&&B.log(`Integration skipped because it was already installed: ${e.name}`);else{if(r[e.name]=e,Wi.indexOf(e.name)===-1&&typeof e.setupOnce=="function"&&(e.setupOnce(),Wi.push(e.name)),e.setup&&typeof e.setup=="function"&&e.setup(t),typeof e.preprocessEvent=="function"){const n=e.preprocessEvent.bind(e);t.on("preprocessEvent",(i,s)=>n(i,s,t))}if(typeof e.processEvent=="function"){const n=e.processEvent.bind(e),i=Object.assign((s,o)=>n(s,o,t),{id:e.name});t.addEventProcessor(i)}Y&&B.log(`Integration installed: ${e.name}`)}}const Qi="Not capturing exception because it's already been captured.";class oc{constructor(e){if(this._options=e,this._integrations={},this._numProcessing=0,this._outcomes={},this._hooks={},this._eventProcessors=[],e.dsn?this._dsn=Io(e.dsn):Y&&B.warn("No DSN provided, client will not send events."),this._dsn){const s=(r=this._dsn,n=e.tunnel,i=e._metadata?e._metadata.sdk:void 0,n||`${function(o){return`${function(l){const c=l.protocol?`${l.protocol}:`:"",h=l.port?`:${l.port}`:"";return`${c}//${l.host}${h}${l.path?`/${l.path}`:""}/api/`}(o)}${o.projectId}/envelope/`}(r)}?${ac(r,i)}`);this._transport=e.transport({tunnel:this._options.tunnel,recordDroppedEvent:this.recordDroppedEvent.bind(this),...e.transportOptions,url:s})}var r,n,i}captureException(e,r,n){const i=we();if(Di(e))return Y&&B.log(Qi),i;const s={event_id:i,...r};return this._process(this.eventFromException(e,s).then(o=>this._captureEvent(o,s,n))),s.event_id}captureMessage(e,r,n,i){const s={event_id:we(),...n},o=jn(e)?e:String(e),l=ln(e)?this.eventFromMessage(o,r,s):this.eventFromException(e,s);return this._process(l.then(c=>this._captureEvent(c,s,i))),s.event_id}captureEvent(e,r,n){const i=we();if(r&&r.originalException&&Di(r.originalException))return Y&&B.log(Qi),i;const s={event_id:i,...r},o=(e.sdkProcessingMetadata||{}).capturedSpanScope;return this._process(this._captureEvent(e,s,o||n)),s.event_id}captureSession(e){typeof e.release!="string"?Y&&B.warn("Discarded session because of missing or non-string release"):(this.sendSession(e),yn(e,{init:!1}))}getDsn(){return this._dsn}getOptions(){return this._options}getSdkMetadata(){return this._options._metadata}getTransport(){return this._transport}flush(e){const r=this._transport;return r?(this.emit("flush"),this._isClientDoneProcessing(e).then(n=>r.flush(e).then(i=>n&&i))):vt(!0)}close(e){return this.flush(e).then(r=>(this.getOptions().enabled=!1,this.emit("close"),r))}getEventProcessors(){return this._eventProcessors}addEventProcessor(e){this._eventProcessors.push(e)}init(){(this._isEnabled()||this._options.integrations.some(({name:e})=>e.startsWith("Spotlight")))&&this._setupIntegrations()}getIntegrationByName(e){return this._integrations[e]}addIntegration(e){const r=this._integrations[e.name];Hi(this,e,this._integrations),r||Gi(this,[e])}sendEvent(e,r={}){this.emit("beforeSendEvent",e,r);let n=nc(e,this._dsn,this._options._metadata,this._options.tunnel);for(const s of r.attachments||[])n=zo(n,Go(s));const i=this.sendEnvelope(n);i&&i.then(s=>this.emit("afterSendEvent",e,s),null)}sendSession(e){const r=function(n,i,s,o){const l=ka(s);return Wt({sent_at:new Date().toISOString(),...l&&{sdk:l},...!!o&&i&&{dsn:Cr(i)}},["aggregates"in n?[{type:"sessions"},n]:[{type:"session"},n.toJSON()]])}(e,this._dsn,this._options._metadata,this._options.tunnel);this.sendEnvelope(r)}recordDroppedEvent(e,r,n){if(this._options.sendClientReports){const i=typeof n=="number"?n:1,s=`${e}:${r}`;Y&&B.log(`Recording outcome: "${s}"${i>1?` (${i} times)`:""}`),this._outcomes[s]=(this._outcomes[s]||0)+i}}on(e,r){const n=this._hooks[e]=this._hooks[e]||[];return n.push(r),()=>{const i=n.indexOf(r);i>-1&&n.splice(i,1)}}emit(e,...r){const n=this._hooks[e];n&&n.forEach(i=>i(...r))}sendEnvelope(e){return this.emit("beforeEnvelope",e),this._isEnabled()&&this._transport?this._transport.send(e).then(null,r=>(Y&&B.error("Error while sending event:",r),r)):(Y&&B.error("Transport disabled"),vt({}))}_setupIntegrations(){const{integrations:e}=this._options;this._integrations=function(r,n){const i={};return n.forEach(s=>{s&&Hi(r,s,i)}),i}(this,e),Gi(this,e)}_updateSessionFromEvent(e,r){let n=!1,i=!1;const s=r.exception&&r.exception.values;if(s){i=!0;for(const l of s){const c=l.mechanism;if(c&&c.handled===!1){n=!0;break}}}const o=e.status==="ok";(o&&e.errors===0||o&&n)&&(yn(e,{...n&&{status:"crashed"},errors:e.errors||Number(i||n)}),this.captureSession(e))}_isClientDoneProcessing(e){return new fe(r=>{let n=0;const i=setInterval(()=>{this._numProcessing==0?(clearInterval(i),r(!0)):(n+=1,e&&n>=e&&(clearInterval(i),r(!1)))},1)})}_isEnabled(){return this.getOptions().enabled!==!1&&this._transport!==void 0}_prepareEvent(e,r,n,i=Ca()){const s=this.getOptions(),o=Object.keys(this._integrations);return!r.integrations&&o.length>0&&(r.integrations=o),this.emit("preprocessEvent",e,r),e.type||i.setLastEventId(e.event_id||r.event_id),sc(s,e,r,n,this,i).then(l=>{if(l===null)return l;const c={...i.getPropagationContext(),...n?n.getPropagationContext():void 0};if(!(l.contexts&&l.contexts.trace)&&c){const{traceId:h,spanId:f,parentSpanId:g,dsc:y}=c;l.contexts={trace:be({trace_id:h,span_id:f,parent_span_id:g}),...l.contexts};const k=y||Ta(h,this);l.sdkProcessingMetadata={dynamicSamplingContext:k,...l.sdkProcessingMetadata}}return l})}_captureEvent(e,r={},n){return this._processEvent(e,r,n).then(i=>i.event_id,i=>{if(Y){const s=i;s.logLevel==="log"?B.log(s.message):B.warn(s)}})}_processEvent(e,r,n){const i=this.getOptions(),{sampleRate:s}=i,o=Yi(e),l=Ki(e),c=e.type||"error",h=`before send for type \`${c}\``,f=s===void 0?void 0:function(k){if(typeof k=="boolean")return Number(k);const v=typeof k=="string"?parseFloat(k):k;if(!(typeof v!="number"||isNaN(v)||v<0||v>1))return v;Y&&B.warn(`[Tracing] Given sample rate is invalid. Sample rate must be a boolean or a number between 0 and 1. Got ${JSON.stringify(k)} of type ${JSON.stringify(typeof k)}.`)}(s);if(l&&typeof f=="number"&&Math.random()>f)return this.recordDroppedEvent("sample_rate","error",e),Er(new Me(`Discarding event because it's not included in the random sample (sampling rate = ${s})`,"log"));const g=c==="replay_event"?"replay":c,y=(e.sdkProcessingMetadata||{}).capturedSpanIsolationScope;return this._prepareEvent(e,r,n,y).then(k=>{if(k===null)throw this.recordDroppedEvent("event_processor",g,e),new Me("An event processor returned `null`, will not send event.","log");if(r.data&&r.data.__sentry__===!0)return k;const v=function(b,M,O,x){const{beforeSend:D,beforeSendTransaction:C,beforeSendSpan:w}=M;if(Ki(O)&&D)return D(O,x);if(Yi(O)){if(O.spans&&w){const E=[];for(const A of O.spans){const L=w(A);L?E.push(L):b.recordDroppedEvent("before_send","span")}O.spans=E}if(C){if(O.spans){const E=O.spans.length;O.sdkProcessingMetadata={...O.sdkProcessingMetadata,spanCountBeforeProcessing:E}}return C(O,x)}}return O}(this,i,k,r);return function(b,M){const O=`${M} must return \`null\` or a valid event.`;if(Ir(b))return b.then(x=>{if(!Tt(x)&&x!==null)throw new Me(O);return x},x=>{throw new Me(`${M} rejected with ${x}`)});if(!Tt(b)&&b!==null)throw new Me(O);return b}(v,h)}).then(k=>{if(k===null){if(this.recordDroppedEvent("before_send",g,e),o){const M=1+(e.spans||[]).length;this.recordDroppedEvent("before_send","span",M)}throw new Me(`${h} returned \`null\`, will not send event.`,"log")}const v=n&&n.getSession();if(!o&&v&&this._updateSessionFromEvent(v,k),o){const M=(k.sdkProcessingMetadata&&k.sdkProcessingMetadata.spanCountBeforeProcessing||0)-(k.spans?k.spans.length:0);M>0&&this.recordDroppedEvent("before_send","span",M)}const b=k.transaction_info;if(o&&b&&k.transaction!==e.transaction){const M="custom";k.transaction_info={...b,source:M}}return this.sendEvent(k,r),k}).then(null,k=>{throw k instanceof Me?k:(this.captureException(k,{data:{__sentry__:!0},originalException:k}),new Me(`Event processing pipeline threw an error, original event will not be sent. Details have been sent as a new event.
Reason: ${k}`))})}_process(e){this._numProcessing++,e.then(r=>(this._numProcessing--,r),r=>(this._numProcessing--,r))}_clearOutcomes(){const e=this._outcomes;return this._outcomes={},Object.entries(e).map(([r,n])=>{const[i,s]=r.split(":");return{reason:i,category:s,quantity:n}})}_flushOutcomes(){Y&&B.log("Flushing outcomes...");const e=this._clearOutcomes();if(e.length===0)return void(Y&&B.log("No outcomes to send"));if(!this._dsn)return void(Y&&B.log("No dsn provided, will not send outcomes"));Y&&B.log("Sending outcomes:",e);const r=(n=e,Wt((i=this._options.tunnel&&Cr(this._dsn))?{dsn:i}:{},[[{type:"client_report"},{timestamp:s||Yt(),discarded_events:n}]]));var n,i,s;this.sendEnvelope(r)}}function Ki(t){return t.type===void 0}function Yi(t){return t.type==="transaction"}function cc(t,e,r=Uo(t.bufferSize||64)){let n={};return{send:function(i){const s=[];if(ji(i,(c,h)=>{const f=Ri(h);if(function(g,y,k=Date.now()){return function(v,b){return v[b]||v.all||0}(g,y)>k}(n,f)){const g=Xi(c,h);t.recordDroppedEvent("ratelimit_backoff",f,g)}else s.push(c)}),s.length===0)return vt({});const o=Wt(i[0],s),l=c=>{ji(o,(h,f)=>{const g=Xi(h,f);t.recordDroppedEvent(c,Ri(f),g)})};return r.add(()=>e({body:Wo(o)}).then(c=>(c.statusCode!==void 0&&(c.statusCode<200||c.statusCode>=300)&&Y&&B.warn(`Sentry responded with status code ${c.statusCode} to sent event.`),n=Qo(n,c),c),c=>{throw l("network_error"),c})).then(c=>c,c=>{if(c instanceof Me)return Y&&B.error("Skipped sending event because buffer is full."),l("queue_overflow"),vt({});throw c})},flush:i=>r.drain(i)}}function Xi(t,e){if(e==="event"||e==="transaction")return Array.isArray(t)?t[1]:void 0}const lc=100;function nt(t,e){const r=ue(),n=Ca();if(!r)return;const{beforeBreadcrumb:i=null,maxBreadcrumbs:s=lc}=r.getOptions();if(s<=0)return;const o={timestamp:Yt(),...t},l=i?Nn(()=>i(o,e)):o;l!==null&&(r.emit&&r.emit("beforeAddBreadcrumb",l,e),n.addBreadcrumb(l,s))}let Zi;const es=new WeakMap,uc=()=>({name:"FunctionToString",setupOnce(){Zi=Function.prototype.toString;try{Function.prototype.toString=function(...t){const e=Bn(this),r=es.has(ue())&&e!==void 0?e:this;return Zi.apply(r,t)}}catch{}},setup(t){es.set(t,!0)}}),dc=[/^Script error\.?$/,/^Javascript error: Script error\.? on line 0$/,/^ResizeObserver loop completed with undelivered notifications.$/,/^Cannot redefine property: googletag$/,"undefined is not an object (evaluating 'a.L')",`can't redefine non-configurable property "solana"`,"vv().getRestrictions is not a function. (In 'vv().getRestrictions(1,a)', 'vv().getRestrictions' is undefined)","Can't find variable: _AutofillCallbackHandler"],hc=(t={})=>({name:"InboundFilters",processEvent(e,r,n){const i=n.getOptions(),s=function(o={},l={}){return{allowUrls:[...o.allowUrls||[],...l.allowUrls||[]],denyUrls:[...o.denyUrls||[],...l.denyUrls||[]],ignoreErrors:[...o.ignoreErrors||[],...l.ignoreErrors||[],...o.disableErrorDefaults?[]:dc],ignoreTransactions:[...o.ignoreTransactions||[],...l.ignoreTransactions||[]],ignoreInternal:o.ignoreInternal===void 0||o.ignoreInternal}}(t,i);return function(o,l){return l.ignoreInternal&&function(c){try{return c.exception.values[0].type==="SentryError"}catch{}return!1}(o)?(Y&&B.warn(`Event dropped due to being internal Sentry Error.
Event: ${$e(o)}`),!0):function(c,h){return c.type||!h||!h.length?!1:function(f){const g=[];f.message&&g.push(f.message);let y;try{y=f.exception.values[f.exception.values.length-1]}catch{}return y&&y.value&&(g.push(y.value),y.type&&g.push(`${y.type}: ${y.value}`)),g}(c).some(f=>rr(f,h))}(o,l.ignoreErrors)?(Y&&B.warn(`Event dropped due to being matched by \`ignoreErrors\` option.
Event: ${$e(o)}`),!0):function(c){return c.type||!c.exception||!c.exception.values||c.exception.values.length===0?!1:!c.message&&!c.exception.values.some(h=>h.stacktrace||h.type&&h.type!=="Error"||h.value)}(o)?(Y&&B.warn(`Event dropped due to not having an error message, error type or stacktrace.
Event: ${$e(o)}`),!0):function(c,h){if(c.type!=="transaction"||!h||!h.length)return!1;const f=c.transaction;return!!f&&rr(f,h)}(o,l.ignoreTransactions)?(Y&&B.warn(`Event dropped due to being matched by \`ignoreTransactions\` option.
Event: ${$e(o)}`),!0):function(c,h){if(!h||!h.length)return!1;const f=or(c);return!!f&&rr(f,h)}(o,l.denyUrls)?(Y&&B.warn(`Event dropped due to being matched by \`denyUrls\` option.
Event: ${$e(o)}.
Url: ${or(o)}`),!0):function(c,h){if(!h||!h.length)return!0;const f=or(c);return!f||rr(f,h)}(o,l.allowUrls)?!1:(Y&&B.warn(`Event dropped due to not being matched by \`allowUrls\` option.
Event: ${$e(o)}.
Url: ${or(o)}`),!0)}(e,s)?null:e}});function or(t){try{let e;try{e=t.exception.values[0].stacktrace.frames}catch{}return e?function(r=[]){for(let n=r.length-1;n>=0;n--){const i=r[n];if(i&&i.filename!=="<anonymous>"&&i.filename!=="[native code]")return i.filename||null}return null}(e):null}catch{return Y&&B.error(`Cannot extract url for event ${$e(t)}`),null}}const fc=()=>{let t;return{name:"Dedupe",processEvent(e){if(e.type)return e;try{if(function(r,n){return n?!!(function(i,s){const o=i.message,l=s.message;return!(!o&&!l||o&&!l||!o&&l||o!==l||!rs(i,s)||!ts(i,s))}(r,n)||function(i,s){const o=ns(s),l=ns(i);return!(!o||!l||o.type!==l.type||o.value!==l.value||!rs(i,s)||!ts(i,s))}(r,n)):!1}(e,t))return Y&&B.warn("Event dropped due to being a duplicate of previously captured event."),null}catch{}return t=e}}};function ts(t,e){let r=Pi(t),n=Pi(e);if(!r&&!n)return!0;if(r&&!n||!r&&n||n.length!==r.length)return!1;for(let i=0;i<n.length;i++){const s=n[i],o=r[i];if(s.filename!==o.filename||s.lineno!==o.lineno||s.colno!==o.colno||s.function!==o.function)return!1}return!0}function rs(t,e){let r=t.fingerprint,n=e.fingerprint;if(!r&&!n)return!0;if(r&&!n||!r&&n)return!1;try{return r.join("")===n.join("")}catch{return!1}}function ns(t){return t.exception&&t.exception.values&&t.exception.values[0]}const ie=z;let wn=0;function is(){return wn>0}function Ot(t,e={},r){if(typeof t!="function")return t;try{const i=t.__sentry_wrapped__;if(i)return typeof i=="function"?i:t;if(Bn(t))return t}catch{return t}const n=function(){const i=Array.prototype.slice.call(arguments);try{r&&typeof r=="function"&&r.apply(this,arguments);const s=i.map(o=>Ot(o,e));return t.apply(this,s)}catch(s){throw wn++,setTimeout(()=>{wn--}),function(...o){const l=$n(jr());if(o.length===2){const[c,h]=o;return c?l.withSetScope(c,h):l.withScope(h)}l.withScope(o[0])}(o=>{var l;o.addEventProcessor(c=>(e.mechanism&&(mn(c,void 0),zt(c,e.mechanism)),c.extra={...c.extra,arguments:i},c)),l=s,qn().captureException(l,void 0)}),s}};try{for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}catch{}ba(n,t),gt(t,"__sentry_wrapped__",n);try{Object.getOwnPropertyDescriptor(n,"name").configurable&&Object.defineProperty(n,"name",{get:()=>t.name})}catch{}return n}const Jn=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__;function Vn(t,e){const r=zn(t,e),n={type:e&&e.name,value:gc(e)};return r.length&&(n.stacktrace={frames:r}),n.type===void 0&&n.value===""&&(n.value="Unrecoverable error caught"),n}function pc(t,e,r,n){const i=ue(),s=i&&i.getOptions().normalizeDepth,o=function(h){for(const f in h)if(Object.prototype.hasOwnProperty.call(h,f)){const g=h[f];if(g instanceof Error)return g}}(e),l={__serialized__:Sa(e,s)};if(o)return{exception:{values:[Vn(t,o)]},extra:l};const c={exception:{values:[{type:Dr(e)?e.constructor.name:n?"UnhandledRejection":"Error",value:vc(e,{isUnhandledRejection:n})}]},extra:l};if(r){const h=zn(t,r);h.length&&(c.exception.values[0].stacktrace={frames:h})}return c}function Wr(t,e){return{exception:{values:[Vn(t,e)]}}}function zn(t,e){const r=e.stacktrace||e.stack||"",n=function(s){return s&&mc.test(s.message)?1:0}(e),i=function(s){return typeof s.framesToPop=="number"?s.framesToPop:0}(e);try{return t(r,n,i)}catch{}return[]}const mc=/Minified React error #\d+;/i;function gc(t){const e=t&&t.message;return e?e.error&&typeof e.error.message=="string"?e.error.message:e:"No error message"}function Sn(t,e,r,n,i){let s;if(ga(e)&&e.error)return Wr(t,e.error);if(bi(e)||Lt(e,"DOMException")){const o=e;if("stack"in e)s=Wr(t,e);else{const l=o.name||(bi(o)?"DOMError":"DOMException"),c=o.message?`${l}: ${o.message}`:l;s=kn(t,c,r,n),mn(s,c)}return"code"in o&&(s.tags={...s.tags,"DOMException.code":`${o.code}`}),s}return In(e)?Wr(t,e):Tt(e)||Dr(e)?(s=pc(t,e,r,i),zt(s,{synthetic:!0}),s):(s=kn(t,e,r,n),mn(s,`${e}`),zt(s,{synthetic:!0}),s)}function kn(t,e,r,n){const i={};if(n&&r){const s=zn(t,r);s.length&&(i.exception={values:[{value:e,stacktrace:{frames:s}}]})}if(jn(e)){const{__sentry_template_string__:s,__sentry_template_values__:o}=e;return i.logentry={message:s,params:o},i}return i.message=e,i}function vc(t,{isUnhandledRejection:e}){const r=function(i,s=40){const o=Object.keys(_a(i));o.sort();const l=o[0];if(!l)return"[object has no keys]";if(l.length>=s)return Et(l,s);for(let c=o.length;c>0;c--){const h=o.slice(0,c).join(", ");if(!(h.length>s))return c===o.length?h:Et(h,s)}return""}(t),n=e?"promise rejection":"exception";return ga(t)?`Event \`ErrorEvent\` captured as ${n} with message \`${t.message}\``:Dr(t)?`Event \`${function(i){try{const s=Object.getPrototypeOf(i);return s?s.constructor.name:void 0}catch{}}(t)}\` (type=${t.type}) captured as ${n}`:`Object captured as ${n} with keys: ${r}`}class yc extends oc{constructor(e){const r={parentSpanIsAlwaysRootSpan:!0,...e};(function(n,i,s=[i],o="npm"){const l=n._metadata||{};l.sdk||(l.sdk={name:`sentry.javascript.${i}`,packages:s.map(c=>({name:`${o}:@sentry/${c}`,version:ft})),version:ft}),n._metadata=l})(r,"browser",["browser"],ie.SENTRY_SDK_SOURCE||"npm"),super(r),r.sendClientReports&&ie.document&&ie.document.addEventListener("visibilitychange",()=>{ie.document.visibilityState==="hidden"&&this._flushOutcomes()})}eventFromException(e,r){return function(n,i,s,o){const l=Sn(n,i,s&&s.syntheticException||void 0,o);return zt(l),l.level="error",s&&s.event_id&&(l.event_id=s.event_id),vt(l)}(this._options.stackParser,e,r,this._options.attachStacktrace)}eventFromMessage(e,r="info",n){return function(i,s,o="info",l,c){const h=kn(i,s,l&&l.syntheticException||void 0,c);return h.level=o,l&&l.event_id&&(h.event_id=l.event_id),vt(h)}(this._options.stackParser,e,r,n,this._options.attachStacktrace)}captureUserFeedback(e){if(!this._isEnabled())return void(Jn&&B.warn("SDK not enabled, will not capture user feedback."));const r=function(n,{metadata:i,tunnel:s,dsn:o}){const l={event_id:n.event_id,sent_at:new Date().toISOString(),...i&&i.sdk&&{sdk:{name:i.sdk.name,version:i.sdk.version}},...!!s&&!!o&&{dsn:Cr(o)}};return Wt(l,[function(h){return[{type:"user_report"},h]}(n)])}(e,{metadata:this.getSdkMetadata(),dsn:this.getDsn(),tunnel:this.getOptions().tunnel});this.sendEnvelope(r)}_prepareEvent(e,r,n){return e.platform=e.platform||"javascript",super._prepareEvent(e,r,n)}}const bc=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,oe=z;let ss,Gr,Hr,cr;function _c(){if(!oe.document)return;const t=_e.bind(null,"dom"),e=as(t,!0);oe.document.addEventListener("click",e,!1),oe.document.addEventListener("keypress",e,!1),["EventTarget","Node"].forEach(r=>{const n=oe[r]&&oe[r].prototype;n&&n.hasOwnProperty&&n.hasOwnProperty("addEventListener")&&(he(n,"addEventListener",function(i){return function(s,o,l){if(s==="click"||s=="keypress")try{const c=this,h=c.__sentry_instrumentation_handlers__=c.__sentry_instrumentation_handlers__||{},f=h[s]=h[s]||{refCount:0};if(!f.handler){const g=as(t);f.handler=g,i.call(this,s,g,l)}f.refCount++}catch{}return i.call(this,s,o,l)}}),he(n,"removeEventListener",function(i){return function(s,o,l){if(s==="click"||s=="keypress")try{const c=this,h=c.__sentry_instrumentation_handlers__||{},f=h[s];f&&(f.refCount--,f.refCount<=0&&(i.call(this,s,f.handler,l),f.handler=void 0,delete h[s]),Object.keys(h).length===0&&delete c.__sentry_instrumentation_handlers__)}catch{}return i.call(this,s,o,l)}}))})}function as(t,e=!1){return r=>{if(!r||r._sentryCaptured)return;const n=function(s){try{return s.target}catch{return null}}(r);if(function(s,o){return s==="keypress"&&(!o||!o.tagName||o.tagName!=="INPUT"&&o.tagName!=="TEXTAREA"&&!o.isContentEditable)}(r.type,n))return;gt(r,"_sentryCaptured",!0),n&&!n._sentryId&&gt(n,"_sentryId",we());const i=r.type==="keypress"?"input":r.type;(function(s){if(s.type!==Gr)return!1;try{if(!s.target||s.target._sentryId!==Hr)return!1}catch{}return!0})(r)||(t({event:r,name:i,global:e}),Gr=r.type,Hr=n?n._sentryId:void 0),clearTimeout(ss),ss=oe.setTimeout(()=>{Hr=void 0,Gr=void 0},1e3)}}function wc(){if(!function(){const r=ar.chrome,n=r&&r.app&&r.app.runtime,i="history"in ar&&!!ar.history.pushState&&!!ar.history.replaceState;return!n&&i}())return;const t=oe.onpopstate;function e(r){return function(...n){const i=n.length>2?n[2]:void 0;if(i){const s=cr,o=String(i);cr=o,_e("history",{from:s,to:o})}return r.apply(this,n)}}oe.onpopstate=function(...r){const n=oe.location.href,i=cr;if(cr=n,_e("history",{from:i,to:n}),t)try{return t.apply(this,r)}catch{}},he(oe.history,"pushState",e),he(oe.history,"replaceState",e)}const vr={};function os(t){vr[t]=void 0}const $t="__sentry_xhr_v3__";function Sc(){if(!oe.XMLHttpRequest)return;const t=XMLHttpRequest.prototype;t.open=new Proxy(t.open,{apply(e,r,n){const i=1e3*We(),s=Re(n[0])?n[0].toUpperCase():void 0,o=function(c){if(Re(c))return c;try{return c.toString()}catch{}}(n[1]);if(!s||!o)return e.apply(r,n);r[$t]={method:s,url:o,request_headers:{}},s==="POST"&&o.match(/sentry_key/)&&(r.__sentry_own_request__=!0);const l=()=>{const c=r[$t];if(c&&r.readyState===4){try{c.status_code=r.status}catch{}_e("xhr",{endTimestamp:1e3*We(),startTimestamp:i,xhr:r})}};return"onreadystatechange"in r&&typeof r.onreadystatechange=="function"?r.onreadystatechange=new Proxy(r.onreadystatechange,{apply:(c,h,f)=>(l(),c.apply(h,f))}):r.addEventListener("readystatechange",l),r.setRequestHeader=new Proxy(r.setRequestHeader,{apply(c,h,f){const[g,y]=f,k=h[$t];return k&&Re(g)&&Re(y)&&(k.request_headers[g.toLowerCase()]=y),c.apply(h,f)}}),e.apply(r,n)}}),t.send=new Proxy(t.send,{apply(e,r,n){const i=r[$t];return i?(n[0]!==void 0&&(i.body=n[0]),_e("xhr",{startTimestamp:1e3*We(),xhr:r}),e.apply(r,n)):e.apply(r,n)}})}function kc(t,e=function(r){const n=vr[r];if(n)return n;let i=oe[r];if(fn(i))return vr[r]=i.bind(oe);const s=oe.document;if(s&&typeof s.createElement=="function")try{const o=s.createElement("iframe");o.hidden=!0,s.head.appendChild(o);const l=o.contentWindow;l&&l[r]&&(i=l[r]),s.head.removeChild(o)}catch(o){bc&&B.warn(`Could not create sandbox iframe for ${r} check, bailing to window.${r}: `,o)}return i&&(vr[r]=i.bind(oe))}("fetch")){let r=0,n=0;return cc(t,function(i){const s=i.body.length;r+=s,n++;const o={body:i.body,method:"POST",referrerPolicy:"origin",headers:t.headers,keepalive:r<=6e4&&n<15,...t.fetchOptions};if(!e)return os("fetch"),Er("No fetch implementation available");try{return e(t.url,o).then(l=>(r-=s,n--,{statusCode:l.status,headers:{"x-sentry-rate-limits":l.headers.get("X-Sentry-Rate-Limits"),"retry-after":l.headers.get("Retry-After")}}))}catch(l){return os("fetch"),r-=s,n--,Er(l)}})}function Qr(t,e,r,n){const i={filename:t,function:e==="<anonymous>"?ut:e,in_app:!0};return r!==void 0&&(i.lineno=r),n!==void 0&&(i.colno=n),i}const Cc=/^\s*at (\S+?)(?::(\d+))(?::(\d+))\s*$/i,Ec=/^\s*at (?:(.+?\)(?: \[.+\])?|.*?) ?\((?:address at )?)?(?:async )?((?:<anonymous>|[-a-z]+:|.*bundle|\/)?.*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,Mc=/\((\S*)(?::(\d+))(?::(\d+))\)/,Tc=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)?((?:[-a-z]+)?:\/.*?|\[native code\]|[^@]*(?:bundle|\d+\.js)|\/[\w\-. /=]+)(?::(\d+))?(?::(\d+))?\s*$/i,Ac=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i,Oc=function(...t){const e=t.sort((r,n)=>r[0]-n[0]).map(r=>r[1]);return(r,n=0,i=0)=>{const s=[],o=r.split(`
`);for(let l=n;l<o.length;l++){const c=o[l];if(c.length>1024)continue;const h=Ti.test(c)?c.replace(Ti,"$1"):c;if(!h.match(/\S*Error: /)){for(const f of e){const g=f(h);if(g){s.push(g);break}}if(s.length>=50+i)break}}return function(l){if(!l.length)return[];const c=Array.from(l);return/sentryWrapped/.test(nr(c).function||"")&&c.pop(),c.reverse(),Ai.test(nr(c).function||"")&&(c.pop(),Ai.test(nr(c).function||"")&&c.pop()),c.slice(0,50).map(h=>({...h,filename:h.filename||nr(c).filename,function:h.function||ut}))}(s.slice(i))}}([30,t=>{const e=Cc.exec(t);if(e){const[,n,i,s]=e;return Qr(n,ut,+i,+s)}const r=Ec.exec(t);if(r){if(r[2]&&r[2].indexOf("eval")===0){const s=Mc.exec(r[2]);s&&(r[2]=s[1],r[3]=s[2],r[4]=s[3])}const[n,i]=cs(r[1]||ut,r[2]);return Qr(i,n,r[3]?+r[3]:void 0,r[4]?+r[4]:void 0)}}],[50,t=>{const e=Tc.exec(t);if(e){if(e[3]&&e[3].indexOf(" > eval")>-1){const i=Ac.exec(e[3]);i&&(e[1]=e[1]||"eval",e[3]=i[1],e[4]=i[2],e[5]="")}let r=e[3],n=e[1]||ut;return[n,r]=cs(n,r),Qr(r,n,e[4]?+e[4]:void 0,e[5]?+e[5]:void 0)}}]),cs=(t,e)=>{const r=t.indexOf("safari-extension")!==-1,n=t.indexOf("safari-web-extension")!==-1;return r||n?[t.indexOf("@")!==-1?t.split("@")[0]:ut,r?`safari-extension:${e}`:`safari-web-extension:${e}`]:[t,e]},ls=1024,Pc=(t={})=>{const e={console:!0,dom:!0,fetch:!0,history:!0,sentry:!0,xhr:!0,...t};return{name:"Breadcrumbs",setup(r){var n;e.console&&function(i){const s="console";dt(s,i),ht(s,jo)}(function(i){return function(s){if(ue()!==i)return;const o={category:"console",data:{arguments:s.args,logger:"console"},level:qo(s.level),message:_i(s.args," ")};if(s.level==="assert"){if(s.args[0]!==!1)return;o.message=`Assertion failed: ${_i(s.args.slice(1)," ")||"console.assert"}`,o.data.arguments=s.args.slice(1)}nt(o,{input:s.args,level:s.level})}}(r)),e.dom&&(n=function(i,s){return function(o){if(ue()!==i)return;let l,c,h=typeof s=="object"?s.serializeAttribute:void 0,f=typeof s=="object"&&typeof s.maxStringLength=="number"?s.maxStringLength:void 0;f&&f>ls&&(Jn&&B.warn(`\`dom.maxStringLength\` cannot exceed 1024, but a value of ${f} was configured. Sentry will use 1024 instead.`),f=ls),typeof h=="string"&&(h=[h]);try{const y=o.event,k=function(v){return!!v&&!!v.target}(y)?y.target:y;l=ya(k,{keyAttrs:h,maxStringLength:f}),c=function(v){if(!Rn.HTMLElement)return null;let b=v;for(let M=0;M<5;M++){if(!b)return null;if(b instanceof HTMLElement){if(b.dataset.sentryComponent)return b.dataset.sentryComponent;if(b.dataset.sentryElement)return b.dataset.sentryElement}b=b.parentNode}return null}(k)}catch{l="<unknown>"}if(l.length===0)return;const g={category:`ui.${o.name}`,message:l};c&&(g.data={"ui.component_name":c}),nt(g,{event:o.event,name:o.name,global:o.global})}}(r,e.dom),dt("dom",n),ht("dom",_c)),e.xhr&&function(i){dt("xhr",i),ht("xhr",Sc)}(function(i){return function(s){if(ue()!==i)return;const{startTimestamp:o,endTimestamp:l}=s,c=s.xhr[$t];if(!o||!l||!c)return;const{method:h,url:f,status_code:g,body:y}=c,k={method:h,url:f,status_code:g},v={xhr:s.xhr,input:y,startTimestamp:o,endTimestamp:l};nt({category:"xhr",data:k,type:"http",level:ki(g)},v)}}(r)),e.fetch&&No(function(i){return function(s){if(ue()!==i)return;const{startTimestamp:o,endTimestamp:l}=s;if(l&&(!s.fetchData.url.match(/sentry_key/)||s.fetchData.method!=="POST"))if(s.error)nt({category:"fetch",data:s.fetchData,level:"error",type:"http"},{data:s.error,input:s.args,startTimestamp:o,endTimestamp:l});else{const c=s.response,h={...s.fetchData,status_code:c&&c.status},f={input:s.args,response:c,startTimestamp:o,endTimestamp:l};nt({category:"fetch",data:h,type:"http",level:ki(h.status_code)},f)}}}(r)),e.history&&function(i){const s="history";dt(s,i),ht(s,wc)}(function(i){return function(s){if(ue()!==i)return;let o=s.from,l=s.to;const c=zr(ie.location.href);let h=o?zr(o):void 0;const f=zr(l);h&&h.path||(h=c),c.protocol===f.protocol&&c.host===f.host&&(l=f.relative),c.protocol===h.protocol&&c.host===h.host&&(o=h.relative),nt({category:"navigation",data:{from:o,to:l}})}}(r)),e.sentry&&r.on("beforeSendEvent",function(i){return function(s){ue()===i&&nt({category:"sentry."+(s.type==="transaction"?"transaction":"event"),event_id:s.event_id,level:s.level,message:$e(s)},{event:s})}}(r))}}},Lc=["EventTarget","Window","Node","ApplicationCache","AudioTrackList","BroadcastChannel","ChannelMergerNode","CryptoOperation","EventSource","FileReader","HTMLUnknownElement","IDBDatabase","IDBRequest","IDBTransaction","KeyOperation","MediaController","MessagePort","ModalWindow","Notification","SVGElementInstance","Screen","SharedWorker","TextTrack","TextTrackCue","TextTrackList","WebSocket","WebSocketWorker","Worker","XMLHttpRequest","XMLHttpRequestEventTarget","XMLHttpRequestUpload"],xc=(t={})=>{const e={XMLHttpRequest:!0,eventTarget:!0,requestAnimationFrame:!0,setInterval:!0,setTimeout:!0,...t};return{name:"BrowserApiErrors",setupOnce(){e.setTimeout&&he(ie,"setTimeout",us),e.setInterval&&he(ie,"setInterval",us),e.requestAnimationFrame&&he(ie,"requestAnimationFrame",Dc),e.XMLHttpRequest&&"XMLHttpRequest"in ie&&he(XMLHttpRequest.prototype,"send",Ic);const r=e.eventTarget;r&&(Array.isArray(r)?r:Lc).forEach(jc)}}};function us(t){return function(...e){const r=e[0];return e[0]=Ot(r,{mechanism:{data:{function:Qe(t)},handled:!1,type:"instrument"}}),t.apply(this,e)}}function Dc(t){return function(e){return t.apply(this,[Ot(e,{mechanism:{data:{function:"requestAnimationFrame",handler:Qe(t)},handled:!1,type:"instrument"}})])}}function Ic(t){return function(...e){const r=this;return["onload","onerror","onprogress","onreadystatechange"].forEach(n=>{n in r&&typeof r[n]=="function"&&he(r,n,function(i){const s={mechanism:{data:{function:n,handler:Qe(i)},handled:!1,type:"instrument"}},o=Bn(i);return o&&(s.mechanism.data.handler=Qe(o)),Ot(i,s)})}),t.apply(this,e)}}function jc(t){const e=ie,r=e[t]&&e[t].prototype;r&&r.hasOwnProperty&&r.hasOwnProperty("addEventListener")&&(he(r,"addEventListener",function(n){return function(i,s,o){try{typeof s.handleEvent=="function"&&(s.handleEvent=Ot(s.handleEvent,{mechanism:{data:{function:"handleEvent",handler:Qe(s),target:t},handled:!1,type:"instrument"}}))}catch{}return n.apply(this,[i,Ot(s,{mechanism:{data:{function:"addEventListener",handler:Qe(s),target:t},handled:!1,type:"instrument"}}),o])}}),he(r,"removeEventListener",function(n){return function(i,s,o){const l=s;try{const c=l&&l.__sentry_wrapped__;c&&n.call(this,i,c,o)}catch{}return n.call(this,i,l,o)}}))}const Rc=(t={})=>{const e={onerror:!0,onunhandledrejection:!0,...t};return{name:"GlobalHandlers",setupOnce(){Error.stackTraceLimit=50},setup(r){e.onerror&&(function(n){(function(i){const s="error";dt(s,i),ht(s,Bo)})(i=>{const{stackParser:s,attachStacktrace:o}=hs();if(ue()!==n||is())return;const{msg:l,url:c,line:h,column:f,error:g}=i,y=function(k,v,b,M){const O=k.exception=k.exception||{},x=O.values=O.values||[],D=x[0]=x[0]||{},C=D.stacktrace=D.stacktrace||{},w=C.frames=C.frames||[],E=isNaN(parseInt(M,10))?void 0:M,A=isNaN(parseInt(b,10))?void 0:b,L=Re(v)&&v.length>0?v:function(){try{return Rn.document.location.href}catch{return""}}();return w.length===0&&w.push({colno:E,filename:L,function:ut,in_app:!0,lineno:A}),k}(Sn(s,g||l,void 0,o,!1),c,h,f);y.level="error",zi(y,{originalException:g,mechanism:{handled:!1,type:"onerror"}})})}(r),ds("onerror")),e.onunhandledrejection&&(function(n){(function(i){const s="unhandledrejection";dt(s,i),ht(s,Fo)})(i=>{const{stackParser:s,attachStacktrace:o}=hs();if(ue()!==n||is())return;const l=function(h){if(ln(h))return h;try{if("reason"in h)return h.reason;if("detail"in h&&"reason"in h.detail)return h.detail.reason}catch{}return h}(i),c=ln(l)?{exception:{values:[{type:"UnhandledRejection",value:`Non-Error promise rejection captured with value: ${String(l)}`}]}}:Sn(s,l,void 0,o,!0);c.level="error",zi(c,{originalException:l,mechanism:{handled:!1,type:"onunhandledrejection"}})})}(r),ds("onunhandledrejection"))}}};function ds(t){Jn&&B.log(`Global Handler attached: ${t}`)}function hs(){const t=ue();return t&&t.getOptions()||{stackParser:()=>[],attachStacktrace:!1}}const Nc=()=>({name:"HttpContext",preprocessEvent(t){if(!ie.navigator&&!ie.location&&!ie.document)return;const e=t.request&&t.request.url||ie.location&&ie.location.href,{referrer:r}=ie.document||{},{userAgent:n}=ie.navigator||{},i={...t.request&&t.request.headers,...r&&{Referer:r},...n&&{"User-Agent":n}},s={...t.request,...e&&{url:e},headers:i};t.request=s}}),Bc=(t={})=>{const e=t.limit||5,r=t.key||"cause";return{name:"LinkedErrors",preprocessEvent(n,i,s){const o=s.getOptions();Lo(Vn,o.stackParser,o.maxValueLength,r,e,n,i)}}};var fs="new",ps="loading",ms="loaded",Cn="joining-meeting",ct="joined-meeting",it="left-meeting",Fe="error",Kr="unknown",Fc="full",Uc="base",gs="no-room",$c="end-of-life",qc="connection-error",Jc="iframe-ready-for-launch-config",Vc="iframe-launch-config",zc="theme-updated",Wc="loading",Gc="load-attempt-failed",vs="loaded",Hc="started-camera",Qc="camera-error",Kc="joining-meeting",Yc="joined-meeting",Xc="left-meeting",Zc="participant-joined",el="participant-updated",tl="participant-left",rl="participant-counts-updated",nl="access-state-updated",il="meeting-session-summary-updated",sl="meeting-session-state-updated",al="waiting-participant-added",ol="waiting-participant-updated",cl="waiting-participant-removed",ll="track-started",ul="track-stopped",dl="transcription-started",hl="transcription-stopped",fl="transcription-error",ys="recording-started",bs="recording-stopped",pl="recording-stats",ml="recording-error",gl="recording-upload-completed",vl="recording-data",yl="app-message",bl="transcription-message",_l="remote-media-player-started",wl="remote-media-player-updated",Sl="remote-media-player-stopped",kl="local-screen-share-started",Cl="local-screen-share-stopped",El="local-screen-share-canceled",Ml="active-speaker-change",Tl="active-speaker-mode-change",Al="network-quality-change",Ol="network-connection",Pl="cpu-load-change",Ll="face-counts-updated",lr="fullscreen",ur="exited-fullscreen",xl="live-streaming-started",Dl="live-streaming-updated",Il="live-streaming-stopped",jl="live-streaming-error",Rl="lang-updated",Nl="receive-settings-updated",Bl="input-settings-updated",_s="nonfatal-error",ws="error",Yr=4096,Ss=102400,Xr="iframe-call-message",ks="local-screen-start",Cs="daily-method-update-live-streaming-endpoints",dr="transmit-log",qt="daily-custom-track",yr={NONE:"none",BGBLUR:"background-blur",BGIMAGE:"background-image",FACE_DETECTION:"face-detection"},Aa={NONE:"none",NOISE_CANCELLATION:"noise-cancellation"},En={PLAY:"play",PAUSE:"pause"},Zr=["jpg","png","jpeg"],Fl="add-endpoints",Ul="remove-endpoints",Es="sip-call-transfer";function me(){return!V()&&typeof window<"u"&&window.navigator&&window.navigator.userAgent?window.navigator.userAgent:""}function V(){return typeof navigator<"u"&&navigator.product&&navigator.product==="ReactNative"}function Oa(){return navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia}function $l(){return!!(navigator&&navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)&&(function(t,e){if(!t||!e)return!0;switch(t){case"Chrome":return e.major>=75;case"Safari":return RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection")&&!(e.major===13&&e.minor===0&&e.point===0);case"Firefox":return e.major>=67}return!0}(yt(),Gt())||V())}function Ms(){if(V()||!document)return!1;var t=document.createElement("iframe");return!!t.requestFullscreen||!!t.webkitRequestFullscreen}var ql=function(){try{var t=document.createElement("canvas"),e=t.getContext("webgl2")!=null;return t.remove(),e}catch{return!1}}();function Pa(){var t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return!V()&&!!ql&&(t?function(){return As()?!1:["Chrome","Firefox"].includes(yt())}():function(){if(As())return!1;var e=yt();if(e==="Safari"){var r=Gn();if(r.major<15||r.major===15&&r.minor<4)return!1}return e==="Chrome"?Wn().major>=77:e==="Firefox"?Hn().major>=97:["Chrome","Firefox","Safari"].includes(e)}())}function La(){if(V()||xa()||typeof AudioWorkletNode>"u")return!1;switch(yt()){case"Chrome":case"Firefox":return!0;case"Safari":return Gt().major>=17&&Gt().minor>=4}return!1}function Ts(){return Oa()&&!function(){var t,e=yt();if(!me())return!0;switch(e){case"Chrome":return(t=Wn()).major&&t.major>0&&t.major<75;case"Firefox":return(t=Hn()).major<91;case"Safari":return(t=Gn()).major<13||t.major===13&&t.minor<1;default:return!0}}()}function xa(){return me().match(/Linux; Android/)}function As(){var t,e,r=me(),n=r.match(/Mac/)&&(!V()&&typeof window<"u"&&(t=window)!==null&&t!==void 0&&(e=t.navigator)!==null&&e!==void 0&&e.maxTouchPoints?window.navigator.maxTouchPoints:0)>=5;return!!(r.match(/Mobi/)||r.match(/Android/)||n)||!!me().match(/DailyAnd\//)||void 0}function yt(){if(typeof window<"u"){var t=me();return Da()?"Safari":t.indexOf("Edge")>-1?"Edge":t.match(/Chrome\//)?"Chrome":t.indexOf("Safari")>-1||Ia()?"Safari":t.indexOf("Firefox")>-1?"Firefox":t.indexOf("MSIE")>-1||t.indexOf(".NET")>-1?"IE":"Unknown Browser"}}function Gt(){switch(yt()){case"Chrome":return Wn();case"Safari":return Gn();case"Firefox":return Hn();case"Edge":return function(){var t=0,e=0;if(typeof window<"u"){var r=me().match(/Edge\/(\d+).(\d+)/);if(r)try{t=parseInt(r[1]),e=parseInt(r[2])}catch{}}return{major:t,minor:e}}()}}function Wn(){var t=0,e=0,r=0,n=0,i=!1;if(typeof window<"u"){var s=me(),o=s.match(/Chrome\/(\d+).(\d+).(\d+).(\d+)/);if(o)try{t=parseInt(o[1]),e=parseInt(o[2]),r=parseInt(o[3]),n=parseInt(o[4]),i=s.indexOf("OPR/")>-1}catch{}}return{major:t,minor:e,build:r,patch:n,opera:i}}function Da(){return!!me().match(/iPad|iPhone|iPod/i)&&Oa()}function Ia(){return me().indexOf("AppleWebKit/605.1.15")>-1}function Gn(){var t=0,e=0,r=0;if(typeof window<"u"){var n=me().match(/Version\/(\d+).(\d+)(.(\d+))?/);if(n)try{t=parseInt(n[1]),e=parseInt(n[2]),r=parseInt(n[4])}catch{}else(Da()||Ia())&&(t=14,e=0,r=3)}return{major:t,minor:e,point:r}}function Hn(){var t=0,e=0;if(typeof window<"u"){var r=me().match(/Firefox\/(\d+).(\d+)/);if(r)try{t=parseInt(r[1]),e=parseInt(r[2])}catch{}}return{major:t,minor:e}}var ja=function(){function t(){ke(this,t)}return Ce(t,[{key:"addListenerForMessagesFromCallMachine",value:function(e,r,n){Bt()}},{key:"addListenerForMessagesFromDailyJs",value:function(e,r,n){Bt()}},{key:"sendMessageToCallMachine",value:function(e,r,n,i){Bt()}},{key:"sendMessageToDailyJs",value:function(e,r){Bt()}},{key:"removeListener",value:function(e){Bt()}}]),t}();function Os(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function en(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Os(Object(r),!0).forEach(function(n){Ie(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Os(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function Jl(t){var e=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var r,n=Se(t);if(e){var i=Se(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Lr(this,r)}}var Vl=function(){Pr(e,ja);var t=Jl(e);function e(){var r;return ke(this,e),(r=t.call(this))._wrappedListeners={},r._messageCallbacks={},r}return Ce(e,[{key:"addListenerForMessagesFromCallMachine",value:function(r,n,i){var s=this,o=function(l){if(l.data&&l.data.what==="iframe-call-message"&&(!l.data.callClientId||l.data.callClientId===n)&&(!l.data.from||l.data.from!=="module")){var c=en({},l.data);if(delete c.from,c.callbackStamp&&s._messageCallbacks[c.callbackStamp]){var h=c.callbackStamp;s._messageCallbacks[h].call(i,c),delete s._messageCallbacks[h]}delete c.what,delete c.callbackStamp,r.call(i,c)}};this._wrappedListeners[r]=o,window.addEventListener("message",o)}},{key:"addListenerForMessagesFromDailyJs",value:function(r,n,i){var s=function(o){var l;if(!(!o.data||o.data.what!==Xr||!o.data.action||o.data.from&&o.data.from!=="module"||o.data.callClientId&&n&&o.data.callClientId!==n||o!=null&&(l=o.data)!==null&&l!==void 0&&l.callFrameId)){var c=o.data;r.call(i,c)}};this._wrappedListeners[r]=s,window.addEventListener("message",s)}},{key:"sendMessageToCallMachine",value:function(r,n,i,s){if(!i)throw new Error("undefined callClientId. Are you trying to use a DailyCall instance previously destroyed?");var o=en({},r);if(o.what=Xr,o.from="module",o.callClientId=i,n){var l=xr();this._messageCallbacks[l]=n,o.callbackStamp=l}var c=s?s.contentWindow:window,h=this._callMachineTargetOrigin(s);h&&c.postMessage(o,h)}},{key:"sendMessageToDailyJs",value:function(r,n){r.what=Xr,r.callClientId=n,r.from="embedded",window.postMessage(r,this._targetOriginFromWindowLocation())}},{key:"removeListener",value:function(r){var n=this._wrappedListeners[r];n&&(window.removeEventListener("message",n),delete this._wrappedListeners[r])}},{key:"forwardPackagedMessageToCallMachine",value:function(r,n,i){var s=en({},r);s.callClientId=i;var o=n?n.contentWindow:window,l=this._callMachineTargetOrigin(n);l&&o.postMessage(s,l)}},{key:"addListenerForPackagedMessagesFromCallMachine",value:function(r,n){var i=function(s){if(s.data&&s.data.what==="iframe-call-message"&&(!s.data.callClientId||s.data.callClientId===n)&&(!s.data.from||s.data.from!=="module")){var o=s.data;r(o)}};return this._wrappedListeners[r]=i,window.addEventListener("message",i),r}},{key:"removeListenerForPackagedMessagesFromCallMachine",value:function(r){var n=this._wrappedListeners[r];n&&(window.removeEventListener("message",n),delete this._wrappedListeners[r])}},{key:"_callMachineTargetOrigin",value:function(r){return r?r.src?new URL(r.src).origin:void 0:this._targetOriginFromWindowLocation()}},{key:"_targetOriginFromWindowLocation",value:function(){return window.location.protocol==="file:"?"*":window.location.origin}}]),e}();function Ps(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function zl(t){var e=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var r,n=Se(t);if(e){var i=Se(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Lr(this,r)}}var Wl=function(){Pr(e,ja);var t=zl(e);function e(){var r;return ke(this,e),r=t.call(this),global.callMachineToDailyJsEmitter=global.callMachineToDailyJsEmitter||new je.EventEmitter,global.dailyJsToCallMachineEmitter=global.dailyJsToCallMachineEmitter||new je.EventEmitter,r._wrappedListeners={},r._messageCallbacks={},r}return Ce(e,[{key:"addListenerForMessagesFromCallMachine",value:function(r,n,i){this._addListener(r,global.callMachineToDailyJsEmitter,n,i,"received call machine message")}},{key:"addListenerForMessagesFromDailyJs",value:function(r,n,i){this._addListener(r,global.dailyJsToCallMachineEmitter,n,i,"received daily-js message")}},{key:"sendMessageToCallMachine",value:function(r,n,i){this._sendMessage(r,global.dailyJsToCallMachineEmitter,i,n,"sending message to call machine")}},{key:"sendMessageToDailyJs",value:function(r,n){this._sendMessage(r,global.callMachineToDailyJsEmitter,n,null,"sending message to daily-js")}},{key:"removeListener",value:function(r){var n=this._wrappedListeners[r];n&&(global.callMachineToDailyJsEmitter.removeListener("message",n),global.dailyJsToCallMachineEmitter.removeListener("message",n),delete this._wrappedListeners[r])}},{key:"_addListener",value:function(r,n,i,s,o){var l=this,c=function(h){if(h.callClientId===i){if(h.callbackStamp&&l._messageCallbacks[h.callbackStamp]){var f=h.callbackStamp;l._messageCallbacks[f].call(s,h),delete l._messageCallbacks[f]}r.call(s,h)}};this._wrappedListeners[r]=c,n.addListener("message",c)}},{key:"_sendMessage",value:function(r,n,i,s,o){var l=function(h){for(var f=1;f<arguments.length;f++){var g=arguments[f]!=null?arguments[f]:{};f%2?Ps(Object(g),!0).forEach(function(y){Ie(h,y,g[y])}):Object.getOwnPropertyDescriptors?Object.defineProperties(h,Object.getOwnPropertyDescriptors(g)):Ps(Object(g)).forEach(function(y){Object.defineProperty(h,y,Object.getOwnPropertyDescriptor(g,y))})}return h}({},r);if(l.callClientId=i,s){var c=xr();this._messageCallbacks[c]=s,l.callbackStamp=c}n.emit("message",l)}}]),e}(),Mn="replace",Tn="shallow-merge",Ls=[Mn,Tn],Gl=function(){function t(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=e.data,n=e.mergeStrategy,i=n===void 0?Mn:n;ke(this,t),t._validateMergeStrategy(i),t._validateData(r,i),this.mergeStrategy=i,this.data=r}return Ce(t,[{key:"isNoOp",value:function(){return t.isNoOpUpdate(this.data,this.mergeStrategy)}}],[{key:"isNoOpUpdate",value:function(e,r){return Object.keys(e).length===0&&r===Tn}},{key:"_validateMergeStrategy",value:function(e){if(!Ls.includes(e))throw Error("Unrecognized mergeStrategy provided. Options are: [".concat(Ls,"]"))}},{key:"_validateData",value:function(e,r){if(!function(l){if(l==null||G(l)!=="object")return!1;var c=Object.getPrototypeOf(l);return c==null||c===Object.prototype}(e))throw Error("Meeting session data must be a plain (map-like) object");var n;try{if(n=JSON.stringify(e),r===Mn){var i=JSON.parse(n);le(i,e)||console.warn("The meeting session data provided will be modified when serialized.",i,e)}else if(r===Tn){for(var s in e)if(Object.hasOwnProperty.call(e,s)&&e[s]!==void 0){var o=JSON.parse(JSON.stringify(e[s]));le(e[s],o)||console.warn("At least one key in the meeting session data provided will be modified when serialized.",o,e[s])}}}catch(l){throw Error("Meeting session data must be serializable to JSON: ".concat(l))}if(n.length>Ss)throw Error("Meeting session data is too large (".concat(n.length," characters). Maximum size suppported is ").concat(Ss,"."))}}]),t}();function An(t,e,r){return An=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}()?Reflect.construct.bind():function(n,i,s){var o=[null];o.push.apply(o,i);var l=new(Function.bind.apply(n,o));return s&&Vt(l,s.prototype),l},An.apply(null,arguments)}function On(t){var e=typeof Map=="function"?new Map:void 0;return On=function(r){if(r===null||(n=r,Function.toString.call(n).indexOf("[native code]")===-1))return r;var n;if(typeof r!="function")throw new TypeError("Super expression must either be null or a function");if(e!==void 0){if(e.has(r))return e.get(r);e.set(r,i)}function i(){return An(r,arguments,Se(this).constructor)}return i.prototype=Object.create(r.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),Vt(i,r)},On(t)}function Hl(t){var e=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var r,n=Se(t);if(e){var i=Se(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Lr(this,r)}}function xs(t){var e,r=(e=window._daily)===null||e===void 0?void 0:e.pendings;if(r){var n=r.indexOf(t);n!==-1&&r.splice(n,1)}}var Ql=function(){function t(e){ke(this,t),this._currentLoad=null,this._callClientId=e}return Ce(t,[{key:"load",value:function(){var e,r=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=arguments.length>1?arguments[1]:void 0,s=arguments.length>2?arguments[2]:void 0;if(this.loaded)return window._daily.instances[this._callClientId].callMachine.reset(),void i(!0);e=this._callClientId,window._daily.pendings.push(e),this._currentLoad&&this._currentLoad.cancel(),this._currentLoad=new Kl(n,function(){i(!1)},function(o,l){l||xs(r._callClientId),s(o,l)}),this._currentLoad.start()}},{key:"cancel",value:function(){this._currentLoad&&this._currentLoad.cancel(),xs(this._callClientId)}},{key:"loaded",get:function(){return this._currentLoad&&this._currentLoad.succeeded}}]),t}(),Kl=function(){function t(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;ke(this,t),this._attemptsRemaining=3,this._currentAttempt=null,this._dailyConfig=e,this._successCallback=r,this._failureCallback=n}return Ce(t,[{key:"start",value:function(){var e=this;this._currentAttempt||(this._currentAttempt=new Ds(this._dailyConfig,this._successCallback,function r(n){e._currentAttempt.cancelled||(e._attemptsRemaining--,e._failureCallback(n,e._attemptsRemaining>0),e._attemptsRemaining<=0||setTimeout(function(){e._currentAttempt.cancelled||(e._currentAttempt=new Ds(e._dailyConfig,e._successCallback,r),e._currentAttempt.start())},3e3))}),this._currentAttempt.start())}},{key:"cancel",value:function(){this._currentAttempt&&this._currentAttempt.cancel()}},{key:"cancelled",get:function(){return this._currentAttempt&&this._currentAttempt.cancelled}},{key:"succeeded",get:function(){return this._currentAttempt&&this._currentAttempt.succeeded}}]),t}(),tn=function(){Pr(e,On(Error));var t=Hl(e);function e(){return ke(this,e),t.apply(this,arguments)}return Ce(e)}(),Tr=2e4,Ds=function(){function t(r,n,i){ke(this,t),this._loadAttemptImpl=V()||!r.avoidEval?new Yl(r,n,i):new Xl(r,n,i)}var e;return Ce(t,[{key:"start",value:(e=j(function*(){return this._loadAttemptImpl.start()}),function(){return e.apply(this,arguments)})},{key:"cancel",value:function(){this._loadAttemptImpl.cancel()}},{key:"cancelled",get:function(){return this._loadAttemptImpl.cancelled}},{key:"succeeded",get:function(){return this._loadAttemptImpl.succeeded}}]),t}(),Yl=function(){function t(s,o,l){ke(this,t),this.cancelled=!1,this.succeeded=!1,this._networkTimedOut=!1,this._networkTimeout=null,this._iosCache=typeof iOSCallObjectBundleCache<"u"&&iOSCallObjectBundleCache,this._refetchHeaders=null,this._dailyConfig=s,this._successCallback=o,this._failureCallback=l}var e,r,n,i;return Ce(t,[{key:"start",value:(i=j(function*(){var s=_r(this._dailyConfig);!(yield this._tryLoadFromIOSCache(s))&&this._loadFromNetwork(s)}),function(){return i.apply(this,arguments)})},{key:"cancel",value:function(){clearTimeout(this._networkTimeout),this.cancelled=!0}},{key:"_tryLoadFromIOSCache",value:(n=j(function*(s){if(!this._iosCache)return!1;try{var o=yield this._iosCache.get(s);return!!this.cancelled||!!o&&(o.code?(Function('"use strict";'+o.code)(),this.succeeded=!0,this._successCallback(),!0):(this._refetchHeaders=o.refetchHeaders,!1))}catch{return!1}}),function(s){return n.apply(this,arguments)})},{key:"_loadFromNetwork",value:(r=j(function*(s){var o=this;this._networkTimeout=setTimeout(function(){o._networkTimedOut=!0,o._failureCallback({msg:"Timed out (>".concat(Tr," ms) when loading call object bundle ").concat(s),type:"timeout"})},Tr);try{var l=this._refetchHeaders?{headers:this._refetchHeaders}:{},c=yield fetch(s,l);if(clearTimeout(this._networkTimeout),this.cancelled||this._networkTimedOut)throw new tn;var h=yield this._getBundleCodeFromResponse(s,c);if(this.cancelled)throw new tn;Function('"use strict";'+h)(),this._iosCache&&this._iosCache.set(s,h,c.headers),this.succeeded=!0,this._successCallback()}catch(f){if(clearTimeout(this._networkTimeout),f instanceof tn||this.cancelled||this._networkTimedOut)return;this._failureCallback({msg:"Failed to load call object bundle ".concat(s,": ").concat(f),type:f.message})}}),function(s){return r.apply(this,arguments)})},{key:"_getBundleCodeFromResponse",value:(e=j(function*(s,o){if(o.ok)return yield o.text();if(this._iosCache&&o.status===304)return(yield this._iosCache.renew(s,o.headers)).code;throw new Error("Received ".concat(o.status," response"))}),function(s,o){return e.apply(this,arguments)})}]),t}(),Xl=function(){function t(e,r,n){ke(this,t),this.cancelled=!1,this.succeeded=!1,this._dailyConfig=e,this._successCallback=r,this._failureCallback=n,this._attemptId=xr(),this._networkTimeout=null,this._scriptElement=null}return Ce(t,[{key:"start",value:function(){window._dailyCallMachineLoadWaitlist||(window._dailyCallMachineLoadWaitlist=new Set);var e=_r(this._dailyConfig);(typeof document>"u"?"undefined":G(document))==="object"?this._startLoading(e):this._failureCallback({msg:"Call object bundle must be loaded in a DOM/web context",type:"missing context"})}},{key:"cancel",value:function(){this._stopLoading(),this.cancelled=!0}},{key:"_startLoading",value:function(e){var r=this;this._signUpForCallMachineLoadWaitlist(),this._networkTimeout=setTimeout(function(){r._stopLoading(),r._failureCallback({msg:"Timed out (>".concat(Tr," ms) when loading call object bundle ").concat(e),type:"timeout"})},Tr);var n=document.getElementsByTagName("head")[0],i=document.createElement("script");this._scriptElement=i,i.onload=function(){r._stopLoading(),r.succeeded=!0,r._successCallback()},i.onerror=function(s){r._stopLoading(),r._failureCallback({msg:"Failed to load call object bundle ".concat(s.target.src),type:s.message})},i.src=e,n.appendChild(i)}},{key:"_stopLoading",value:function(){this._withdrawFromCallMachineLoadWaitlist(),clearTimeout(this._networkTimeout),this._scriptElement&&(this._scriptElement.onload=null,this._scriptElement.onerror=null)}},{key:"_signUpForCallMachineLoadWaitlist",value:function(){window._dailyCallMachineLoadWaitlist.add(this._attemptId)}},{key:"_withdrawFromCallMachineLoadWaitlist",value:function(){window._dailyCallMachineLoadWaitlist.delete(this._attemptId)}}]),t}(),hr=function(t,e,r){return eu(t.local,e,r)===!0},Zl=function(t,e,r){return t.local.streams&&t.local.streams[e]&&t.local.streams[e].stream&&t.local.streams[e].stream["get".concat(r==="video"?"Video":"Audio","Tracks")]()[0]},kt=function(t,e,r,n){var i=tu(t,e,r,n);return i&&i.pendingTrack},eu=function(t,e,r){if(!t)return!1;var n=function(s){switch(s){case"avatar":return!0;case"staged":return s;default:return!!s}},i=t.public.subscribedTracks;return i&&i[e]?["cam-audio","cam-video","screen-video","screen-audio","rmpAudio","rmpVideo"].indexOf(r)===-1&&i[e].custom?[!0,"staged"].includes(i[e].custom)?n(i[e].custom):n(i[e].custom[r]):n(i[e][r]):!i||n(i.ALL)},tu=function(t,e,r,n){var i=Object.values(t.streams||{}).filter(function(s){return s.participantId===e&&s.type===r&&s.pendingTrack&&s.pendingTrack.kind===n}).sort(function(s,o){return new Date(o.starttime)-new Date(s.starttime)});return i&&i[0]},ru=function(t,e){var r=t.local.public.customTracks;if(r&&r[e])return r[e].track};function Is(t,e){for(var r=e.getState(),n=0,i=["cam","screen"];n<i.length;n++)for(var s=i[n],o=0,l=["video","audio"];o<l.length;o++){var c=l[o],h=s==="cam"?c:"screen".concat(c.charAt(0).toUpperCase()+c.slice(1)),f=t.tracks[h];if(f){var g=t.local?Zl(r,s,c):kt(r,t.session_id,s,c);f.state==="playable"&&(f.track=g),f.persistentTrack=g}}}function js(t,e){try{var r=e.getState();for(var n in t.tracks)if(!nu(n)){var i=t.tracks[n].kind;if(i){var s=t.tracks[n];if(s){var o=t.local?ru(r,n):kt(r,t.session_id,n,i);s.state==="playable"&&(t.tracks[n].track=o),s.persistentTrack=o}}else console.error("unknown type for custom track")}}catch(l){console.error(l)}}function nu(t){return["video","audio","screenVideo","screenAudio"].includes(t)}function Rs(t,e,r){var n=r.getState();if(t.local){if(t.audio)try{t.audioTrack=n.local.streams.cam.stream.getAudioTracks()[0],t.audioTrack||(t.audio=!1)}catch{}if(t.video)try{t.videoTrack=n.local.streams.cam.stream.getVideoTracks()[0],t.videoTrack||(t.video=!1)}catch{}if(t.screen)try{t.screenVideoTrack=n.local.streams.screen.stream.getVideoTracks()[0],t.screenAudioTrack=n.local.streams.screen.stream.getAudioTracks()[0],t.screenVideoTrack||t.screenAudioTrack||(t.screen=!1)}catch{}}else{var i=!0;try{var s=n.participants[t.session_id];s&&s.public&&s.public.rtcType&&s.public.rtcType.impl==="peer-to-peer"&&s.private&&!["connected","completed"].includes(s.private.peeringState)&&(i=!1)}catch(f){console.error(f)}if(!i)return t.audio=!1,t.audioTrack=!1,t.video=!1,t.videoTrack=!1,t.screen=!1,void(t.screenTrack=!1);try{if(n.streams,t.audio&&hr(n,t.session_id,"cam-audio")){var o=kt(n,t.session_id,"cam","audio");o&&(e&&e.audioTrack&&e.audioTrack.id===o.id?t.audioTrack=o:o.muted||(t.audioTrack=o)),t.audioTrack||(t.audio=!1)}if(t.video&&hr(n,t.session_id,"cam-video")){var l=kt(n,t.session_id,"cam","video");l&&(e&&e.videoTrack&&e.videoTrack.id===l.id?t.videoTrack=l:l.muted||(t.videoTrack=l)),t.videoTrack||(t.video=!1)}if(t.screen&&hr(n,t.session_id,"screen-audio")){var c=kt(n,t.session_id,"screen","audio");c&&(e&&e.screenAudioTrack&&e.screenAudioTrack.id===c.id?t.screenAudioTrack=c:c.muted||(t.screenAudioTrack=c))}if(t.screen&&hr(n,t.session_id,"screen-video")){var h=kt(n,t.session_id,"screen","video");h&&(e&&e.screenVideoTrack&&e.screenVideoTrack.id===h.id?t.screenVideoTrack=h:h.muted||(t.screenVideoTrack=h))}t.screenVideoTrack||t.screenAudioTrack||(t.screen=!1)}catch(f){console.error("unexpected error matching up tracks",f)}}}function iu(t,e){var r=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(c,h){if(c){if(typeof c=="string")return Ns(c,h);var f=Object.prototype.toString.call(c).slice(8,-1);if(f==="Object"&&c.constructor&&(f=c.constructor.name),f==="Map"||f==="Set")return Array.from(c);if(f==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(f))return Ns(c,h)}}(t))||e){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(c){throw c},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s,o=!0,l=!1;return{s:function(){r=r.call(t)},n:function(){var c=r.next();return o=c.done,c},e:function(c){l=!0,s=c},f:function(){try{o||r.return==null||r.return()}finally{if(l)throw s}}}}function Ns(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var Te=new Map,Mt=null;function su(t,e){var r=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(c,h){if(c){if(typeof c=="string")return Bs(c,h);var f=Object.prototype.toString.call(c).slice(8,-1);if(f==="Object"&&c.constructor&&(f=c.constructor.name),f==="Map"||f==="Set")return Array.from(c);if(f==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(f))return Bs(c,h)}}(t))||e){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(c){throw c},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s,o=!0,l=!1;return{s:function(){r=r.call(t)},n:function(){var c=r.next();return o=c.done,c},e:function(c){l=!0,s=c},f:function(){try{o||r.return==null||r.return()}finally{if(l)throw s}}}}function Bs(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var Ae=new Map,Jt=null;function au(t){Ra()?function(e){Te.has(e)||(Te.set(e,{}),navigator.mediaDevices.enumerateDevices().then(function(r){Te.has(e)&&(Te.get(e).lastDevicesString=JSON.stringify(r),Mt||(Mt=function(){var n=j(function*(){var i,s=yield navigator.mediaDevices.enumerateDevices(),o=iu(Te.keys());try{for(o.s();!(i=o.n()).done;){var l=i.value,c=JSON.stringify(s);c!==Te.get(l).lastDevicesString&&(Te.get(l).lastDevicesString=c,l(s))}}catch(h){o.e(h)}finally{o.f()}});return function(){return n.apply(this,arguments)}}(),navigator.mediaDevices.addEventListener("devicechange",Mt)))}).catch(function(){}))}(t):function(e){Ae.has(e)||(Ae.set(e,{}),navigator.mediaDevices.enumerateDevices().then(function(r){Ae.has(e)&&(Ae.get(e).lastDevicesString=JSON.stringify(r),Jt||(Jt=setInterval(j(function*(){var n,i=yield navigator.mediaDevices.enumerateDevices(),s=su(Ae.keys());try{for(s.s();!(n=s.n()).done;){var o=n.value,l=JSON.stringify(i);l!==Ae.get(o).lastDevicesString&&(Ae.get(o).lastDevicesString=l,o(i))}}catch(c){s.e(c)}finally{s.f()}}),3e3)))}))}(t)}function ou(t){Ra()?function(e){Te.has(e)&&(Te.delete(e),Te.size===0&&Mt&&(navigator.mediaDevices.removeEventListener("devicechange",Mt),Mt=null))}(t):function(e){Ae.has(e)&&(Ae.delete(e),Ae.size===0&&Jt&&(clearInterval(Jt),Jt=null))}(t)}function Ra(){return V()||navigator.mediaDevices.ondevicechange!==void 0}var cu=new Set;function lu(t,e){return t&&t.readyState==="live"&&!function(r,n){return r.muted&&!cu.has(r.id)}(t)}var uu=["result"],du=["preserveIframe"];function Fs(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function R(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Fs(Object(r),!0).forEach(function(n){Ie(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Fs(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function hu(t){var e=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var r,n=Se(t);if(e){var i=Se(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Lr(this,r)}}function Us(t,e){var r=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(c,h){if(c){if(typeof c=="string")return $s(c,h);var f=Object.prototype.toString.call(c).slice(8,-1);if(f==="Object"&&c.constructor&&(f=c.constructor.name),f==="Map"||f==="Set")return Array.from(c);if(f==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(f))return $s(c,h)}}(t))||e){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(c){throw c},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s,o=!0,l=!1;return{s:function(){r=r.call(t)},n:function(){var c=r.next();return o=c.done,c},e:function(c){l=!0,s=c},f:function(){try{o||r.return==null||r.return()}finally{if(l)throw s}}}}function $s(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var st={},qs="video",fu="voice",Js=V()?{data:{}}:{data:{},topology:"none"},Vs={present:0,hidden:0},Na={maxBitrate:{min:1e5,max:25e5},maxFramerate:{min:1,max:30},scaleResolutionDownBy:{min:1,max:8}},rn=Object.keys(Na),zs=["state","volume","simulcastEncodings"],Ws={androidInCallNotification:{title:"string",subtitle:"string",iconName:"string",disableForCustomOverride:"boolean"},disableAutoDeviceManagement:{audio:"boolean",video:"boolean"}},Ar={id:{iconPath:"string",iconPathDarkMode:"string",label:"string",tooltip:"string",visualState:"'default' | 'sidebar-open' | 'active'"}},Pn={id:{allow:"string",controlledBy:"'*' | 'owners' | string[]",csp:"string",iconURL:"string",label:"string",loading:"'eager' | 'lazy'",location:"'main' | 'sidebar'",name:"string",referrerPolicy:"string",sandbox:"string",src:"string",srcdoc:"string",shared:"string[] | 'owners' | boolean"}},at={customIntegrations:{validate:za,help:Ja()},customTrayButtons:{validate:Va,help:"customTrayButtons should be a dictionary of the type ".concat(JSON.stringify(Ar))},url:{validate:function(t){return typeof t=="string"},help:"url should be a string"},baseUrl:{validate:function(t){return typeof t=="string"},help:"baseUrl should be a string"},token:{validate:function(t){return typeof t=="string"},help:"token should be a string",queryString:"t"},dailyConfig:{validate:function(t,e){try{return e.validateDailyConfig(t),!0}catch(r){console.error("Failed to validate dailyConfig",r)}return!1},help:"Unsupported dailyConfig. Check error logs for detailed info."},reactNativeConfig:{validate:function(t){return Wa(t,Ws)},help:"reactNativeConfig should look like ".concat(JSON.stringify(Ws),", all fields optional")},lang:{validate:function(t){return["da","de","en-us","en","es","fi","fr","it","jp","ka","nl","no","pl","pt","pt-BR","ru","sv","tr","user"].includes(t)},help:"language not supported. Options are: da, de, en-us, en, es, fi, fr, it, jp, ka, nl, no, pl, pt, pt-BR, ru, sv, tr, user"},userName:!0,userData:{validate:function(t){try{return Ba(t),!0}catch(e){return console.error(e),!1}},help:"invalid userData type provided"},startVideoOff:!0,startAudioOff:!0,activeSpeakerMode:!0,showLeaveButton:!0,showLocalVideo:!0,showParticipantsBar:!0,showFullscreenButton:!0,showUserNameChangeUI:!0,iframeStyle:!0,customLayout:!0,cssFile:!0,cssText:!0,bodyClass:!0,videoSource:{validate:function(t,e){return t instanceof MediaStreamTrack&&(e._sharedTracks.videoDeviceId=t),e._preloadCache.videoDeviceId=t,!0}},audioSource:{validate:function(t,e){return t instanceof MediaStreamTrack&&(e._sharedTracks.audioDeviceId=t),e._preloadCache.audioDeviceId=t,!0}},subscribeToTracksAutomatically:{validate:function(t,e){return e._preloadCache.subscribeToTracksAutomatically=t,!0}},theme:{validate:function(t){var e=["accent","accentText","background","backgroundAccent","baseText","border","mainAreaBg","mainAreaBgAccent","mainAreaText","supportiveText"],r=function(n){for(var i=0,s=Object.keys(n);i<s.length;i++){var o=s[i];if(!e.includes(o))return console.error('unsupported color "'.concat(o,'". Valid colors: ').concat(e.join(", "))),!1;if(!n[o].match(/^#[0-9a-f]{6}|#[0-9a-f]{3}$/i))return console.error("".concat(o,' theme color should be provided in valid hex color format. Received: "').concat(n[o],'"')),!1}return!0};return G(t)==="object"&&("light"in t&&"dark"in t||"colors"in t)?"light"in t&&"dark"in t?"colors"in t.light?"colors"in t.dark?r(t.light.colors)&&r(t.dark.colors):(console.error('Dark theme is missing "colors" property.',t),!1):(console.error('Light theme is missing "colors" property.',t),!1):r(t.colors):(console.error('Theme must contain either both "light" and "dark" properties, or "colors".',t),!1)},help:"unsupported theme configuration. Check error logs for detailed info."},layoutConfig:{validate:function(t){if("grid"in t){var e=t.grid;if("maxTilesPerPage"in e){if(!Number.isInteger(e.maxTilesPerPage))return console.error("grid.maxTilesPerPage should be an integer. You passed ".concat(e.maxTilesPerPage,".")),!1;if(e.maxTilesPerPage>49)return console.error("grid.maxTilesPerPage can't be larger than 49 without sacrificing browser performance. Please contact us at https://www.daily.co/contact to talk about your use case."),!1}if("minTilesPerPage"in e){if(!Number.isInteger(e.minTilesPerPage))return console.error("grid.minTilesPerPage should be an integer. You passed ".concat(e.minTilesPerPage,".")),!1;if(e.minTilesPerPage<1)return console.error("grid.minTilesPerPage can't be lower than 1."),!1;if("maxTilesPerPage"in e&&e.minTilesPerPage>e.maxTilesPerPage)return console.error("grid.minTilesPerPage can't be higher than grid.maxTilesPerPage."),!1}}return!0},help:"unsupported layoutConfig. Check error logs for detailed info."},receiveSettings:{validate:function(t){return Fa(t,{allowAllParticipantsKey:!1})},help:qa({allowAllParticipantsKey:!1})},sendSettings:{validate:function(t,e){return!!function(r,n){try{return n.validateUpdateSendSettings(r),!0}catch(i){return console.error("Failed to validate send settings",i),!1}}(t,e)&&(e._preloadCache.sendSettings=t,!0)},help:"Invalid sendSettings provided. Check error logs for detailed info."},inputSettings:{validate:function(t,e){var r;return!!Ua(t)&&(e._preloadCache.inputSettings||(e._preloadCache.inputSettings={}),$a(t,(r=e.properties)===null||r===void 0?void 0:r.dailyConfig),t.audio&&(e._preloadCache.inputSettings.audio=t.audio),t.video&&(e._preloadCache.inputSettings.video=t.video),!0)},help:Ln()},layout:{validate:function(t){return t==="custom-v1"||t==="browser"||t==="none"},help:'layout may only be set to "custom-v1"',queryString:"layout"},emb:{queryString:"emb"},embHref:{queryString:"embHref"},dailyJsVersion:{queryString:"dailyJsVersion"},proxy:{queryString:"proxy"},strictMode:!0,allowMultipleCallInstances:!0},fr={styles:{validate:function(t){for(var e in t)if(e!=="cam"&&e!=="screen")return!1;if(t.cam){for(var r in t.cam)if(r!=="div"&&r!=="video")return!1}if(t.screen){for(var n in t.screen)if(n!=="div"&&n!=="video")return!1}return!0},help:"styles format should be a subset of: { cam: {div: {}, video: {}}, screen: {div: {}, video: {}} }"},setSubscribedTracks:{validate:function(t,e){if(e._preloadCache.subscribeToTracksAutomatically)return!1;var r=[!0,!1,"staged"];if(r.includes(t)||!V()&&t==="avatar")return!0;var n=["audio","video","screenAudio","screenVideo","rmpAudio","rmpVideo"];return function i(s){var o=arguments.length>1&&arguments[1]!==void 0&&arguments[1];for(var l in s)if(l==="custom"){if(!r.includes(s[l])&&!i(s[l],!0))return!1}else{var c=!o&&!n.includes(l),h=!r.includes(s[l]);if(c||h)return!1}return!0}(t)},help:"setSubscribedTracks cannot be used when setSubscribeToTracksAutomatically is enabled, and should be of the form: "+"true".concat(V()?"":" | 'avatar'"," | false | 'staged' | { [audio: true|false|'staged'], [video: true|false|'staged'], [screenAudio: true|false|'staged'], [screenVideo: true|false|'staged'] }")},setAudio:!0,setVideo:!0,setScreenShare:{validate:function(t){return t===!1},help:"setScreenShare must be false, as it's only meant for stopping remote participants' screen shares"},eject:!0,updatePermissions:{validate:function(t){for(var e=0,r=Object.entries(t);e<r.length;e++){var n=pt(r[e],2),i=n[0],s=n[1];switch(i){case"hasPresence":if(typeof s!="boolean")return!1;break;case"canSend":if(s instanceof Set||s instanceof Array||Array.isArray(s)){var o,l=["video","audio","screenVideo","screenAudio","customVideo","customAudio"],c=Us(s);try{for(c.s();!(o=c.n()).done;){var h=o.value;if(!l.includes(h))return!1}}catch(v){c.e(v)}finally{c.f()}}else if(typeof s!="boolean")return!1;(s instanceof Array||Array.isArray(s))&&(t.canSend=new Set(s));break;case"canAdmin":if(s instanceof Set||s instanceof Array||Array.isArray(s)){var f,g=["participants","streaming","transcription"],y=Us(s);try{for(y.s();!(f=y.n()).done;){var k=f.value;if(!g.includes(k))return!1}}catch(v){y.e(v)}finally{y.f()}}else if(typeof s!="boolean")return!1;(s instanceof Array||Array.isArray(s))&&(t.canAdmin=new Set(s));break;default:return!1}}return!0},help:"updatePermissions can take hasPresence, canSend, and canAdmin permissions. hasPresence must be a boolean. canSend can be a boolean or an Array or Set of media types (video, audio, screenVideo, screenAudio, customVideo, customAudio). canAdmin can be a boolean or an Array or Set of admin types (participants, streaming, transcription)."}};Promise.any||(Promise.any=function(){var t=j(function*(e){return new Promise(function(r,n){var i=[];e.forEach(function(s){return Promise.resolve(s).then(function(o){r(o)}).catch(function(o){i.push(o),i.length===e.length&&n(i)})})})});return function(e){return t.apply(this,arguments)}}());var pu=function(){Pr(se,je);var t,e,r,n,i,s,o,l,c,h,f,g,y,k,v,b,M,O,x,D,C,w,E,A,L,F,N,te,ge,Ee,Ye,Xe,Dt,Ze,It,et,jt,tt,Xt=hu(se);function se(a){var u,d,m,p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(ke(this,se),Ie(xe(d=Xt.call(this)),"startListeningForDeviceChanges",function(){au(d.handleDeviceChange)}),Ie(xe(d),"stopListeningForDeviceChanges",function(){ou(d.handleDeviceChange)}),Ie(xe(d),"handleDeviceChange",function(T){T=T.map(function(P){return JSON.parse(JSON.stringify(P))}),d.emitDailyJSEvent({action:"available-devices-updated",availableDevices:T})}),Ie(xe(d),"handleNativeAppStateChange",function(){var T=j(function*(P){if(P==="destroyed")return console.warn("App has been destroyed before leaving the meeting. Cleaning up all the resources!"),void(yield d.destroy());var U=P==="active";d.disableReactNativeAutoDeviceManagement("video")||(U?d.camUnmutedBeforeLosingNativeActiveState&&d.setLocalVideo(!0):(d.camUnmutedBeforeLosingNativeActiveState=d.localVideo(),d.camUnmutedBeforeLosingNativeActiveState&&d.setLocalVideo(!1)))});return function(P){return T.apply(this,arguments)}}()),Ie(xe(d),"handleNativeAudioFocusChange",function(T){d.disableReactNativeAutoDeviceManagement("audio")||(d._hasNativeAudioFocus=T,d.toggleParticipantAudioBasedOnNativeAudioFocus(),d._hasNativeAudioFocus?d.micUnmutedBeforeLosingNativeAudioFocus&&d.setLocalAudio(!0):(d.micUnmutedBeforeLosingNativeAudioFocus=d.localAudio(),d.setLocalAudio(!1)))}),Ie(xe(d),"handleNativeSystemScreenCaptureStop",function(){d.stopScreenShare()}),d.strictMode=p.strictMode===void 0||p.strictMode,d.allowMultipleCallInstances=(u=p.allowMultipleCallInstances)!==null&&u!==void 0&&u,Object.keys(st).length&&(d._logDuplicateInstanceAttempt(),!d.allowMultipleCallInstances)){if(d.strictMode)throw new Error("Duplicate DailyIframe instances are not allowed");console.warn("Using strictMode: false to allow multiple call instances is now deprecated. Set `allowMultipleCallInstances: true`")}if(window._daily||(window._daily={pendings:[],instances:{}}),d.callClientId=xr(),m=xe(d),st[m.callClientId]=m,window._daily.instances[d.callClientId]={},d._sharedTracks={},window._daily.instances[d.callClientId].tracks=d._sharedTracks,p.dailyJsVersion=se.version(),d._iframe=a,d._callObjectMode=p.layout==="none"&&!d._iframe,d._preloadCache={subscribeToTracksAutomatically:!0,audioDeviceId:null,videoDeviceId:null,outputDeviceId:null,inputSettings:null,sendSettings:null,videoTrackForNetworkConnectivityTest:null,videoTrackForConnectionQualityTest:null},p.showLocalVideo!==void 0?d._callObjectMode?console.error("showLocalVideo is not available in call object mode"):d._showLocalVideo=!!p.showLocalVideo:d._showLocalVideo=!0,p.showParticipantsBar!==void 0?d._callObjectMode?console.error("showParticipantsBar is not available in call object mode"):d._showParticipantsBar=!!p.showParticipantsBar:d._showParticipantsBar=!0,p.customIntegrations!==void 0?d._callObjectMode?console.error("customIntegrations is not available in call object mode"):d._customIntegrations=p.customIntegrations:d._customIntegrations={},p.customTrayButtons!==void 0?d._callObjectMode?console.error("customTrayButtons is not available in call object mode"):d._customTrayButtons=p.customTrayButtons:d._customTrayButtons={},p.activeSpeakerMode!==void 0?d._callObjectMode?console.error("activeSpeakerMode is not available in call object mode"):d._activeSpeakerMode=!!p.activeSpeakerMode:d._activeSpeakerMode=!1,p.receiveSettings?d._callObjectMode?d._receiveSettings=p.receiveSettings:console.error("receiveSettings is only available in call object mode"):d._receiveSettings={},d.validateProperties(p),d.properties=R({},p),d._preloadCache.inputSettings||(d._preloadCache.inputSettings={}),p.inputSettings&&p.inputSettings.audio&&(d._preloadCache.inputSettings.audio=p.inputSettings.audio),p.inputSettings&&p.inputSettings.video&&(d._preloadCache.inputSettings.video=p.inputSettings.video),d._callObjectLoader=d._callObjectMode?new Ql(d.callClientId):null,d._callState=fs,d._isPreparingToJoin=!1,d._accessState={access:Kr},d._meetingSessionSummary={},d._finalSummaryOfPrevSession={},d._meetingSessionState=an(Js,d._callObjectMode),d._nativeInCallAudioMode=qs,d._participants={},d._isScreenSharing=!1,d._participantCounts=Vs,d._rmpPlayerState={},d._waitingParticipants={},d._network={threshold:"good",quality:100},d._activeSpeaker={},d._localAudioLevel=0,d._isLocalAudioLevelObserverRunning=!1,d._remoteParticipantsAudioLevel={},d._isRemoteParticipantsAudioLevelObserverRunning=!1,d._maxAppMessageSize=Yr,d._messageChannel=V()?new Wl:new Vl,d._iframe&&(d._iframe.requestFullscreen?d._iframe.addEventListener("fullscreenchange",function(){document.fullscreenElement===d._iframe?(d.emitDailyJSEvent({action:lr}),d.sendMessageToCallMachine({action:lr})):(d.emitDailyJSEvent({action:ur}),d.sendMessageToCallMachine({action:ur}))}):d._iframe.webkitRequestFullscreen&&d._iframe.addEventListener("webkitfullscreenchange",function(){document.webkitFullscreenElement===d._iframe?(d.emitDailyJSEvent({action:lr}),d.sendMessageToCallMachine({action:lr})):(d.emitDailyJSEvent({action:ur}),d.sendMessageToCallMachine({action:ur}))})),V()){var _=d.nativeUtils();_.addAudioFocusChangeListener&&_.removeAudioFocusChangeListener&&_.addAppStateChangeListener&&_.removeAppStateChangeListener&&_.addSystemScreenCaptureStopListener&&_.removeSystemScreenCaptureStopListener||console.warn("expected (add|remove)(AudioFocusChange|AppActiveStateChange|SystemScreenCaptureStop)Listener to be available in React Native"),d._hasNativeAudioFocus=!0,_.addAudioFocusChangeListener(d.handleNativeAudioFocusChange),_.addAppStateChangeListener(d.handleNativeAppStateChange),_.addSystemScreenCaptureStopListener(d.handleNativeSystemScreenCaptureStop)}return d._callObjectMode&&d.startListeningForDeviceChanges(),d._messageChannel.addListenerForMessagesFromCallMachine(d.handleMessageFromCallMachine,d.callClientId,xe(d)),d}return Ce(se,[{key:"destroy",value:(tt=j(function*(){var a,u;try{yield this.leave()}catch{}var d=this._iframe;if(d){var m=d.parentElement;m&&m.removeChild(d)}if(this._messageChannel.removeListener(this.handleMessageFromCallMachine),V()){var p=this.nativeUtils();p.removeAudioFocusChangeListener(this.handleNativeAudioFocusChange),p.removeAppStateChangeListener(this.handleNativeAppStateChange),p.removeSystemScreenCaptureStopListener(this.handleNativeSystemScreenCaptureStop)}this._callObjectMode&&this.stopListeningForDeviceChanges(),this.resetMeetingDependentVars(),this._destroyed=!0,this.emitDailyJSEvent({action:"call-instance-destroyed"}),delete st[this.callClientId],!((a=window)===null||a===void 0||(u=a._daily)===null||u===void 0)&&u.instances&&delete window._daily.instances[this.callClientId],this.strictMode&&(this.callClientId=void 0)}),function(){return tt.apply(this,arguments)})},{key:"isDestroyed",value:function(){return!!this._destroyed}},{key:"loadCss",value:function(a){var u=a.bodyClass,d=a.cssFile,m=a.cssText;return J(),this.sendMessageToCallMachine({action:"load-css",cssFile:this.absoluteUrl(d),bodyClass:u,cssText:m}),this}},{key:"iframe",value:function(){return J(),this._iframe}},{key:"meetingState",value:function(){return this._callState}},{key:"accessState",value:function(){return ve(this._callObjectMode,"accessState()"),this._accessState}},{key:"participants",value:function(){return this._participants}},{key:"participantCounts",value:function(){return this._participantCounts}},{key:"waitingParticipants",value:function(){return ve(this._callObjectMode,"waitingParticipants()"),this._waitingParticipants}},{key:"validateParticipantProperties",value:function(a,u){for(var d in u){if(!fr[d])throw new Error("unrecognized updateParticipant property ".concat(d));if(fr[d].validate&&!fr[d].validate(u[d],this,this._participants[a]))throw new Error(fr[d].help)}}},{key:"updateParticipant",value:function(a,u){return this._participants.local&&this._participants.local.session_id===a&&(a="local"),a&&u&&(this.validateParticipantProperties(a,u),this.sendMessageToCallMachine({action:"update-participant",id:a,properties:u})),this}},{key:"updateParticipants",value:function(a){var u=this._participants.local&&this._participants.local.session_id;for(var d in a)d===u&&(d="local"),d&&a[d]&&this.validateParticipantProperties(d,a[d]);return this.sendMessageToCallMachine({action:"update-participants",participants:a}),this}},{key:"updateWaitingParticipant",value:(jt=j(function*(){var a=this,u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(ve(this._callObjectMode,"updateWaitingParticipant()"),Q(this._callState,"updateWaitingParticipant()"),typeof u!="string"||G(d)!=="object")throw new Error("updateWaitingParticipant() must take an id string and a updates object");return new Promise(function(m,p){a.sendMessageToCallMachine({action:"daily-method-update-waiting-participant",id:u,updates:d},function(_){_.error&&p(_.error),_.id||p(new Error("unknown error in updateWaitingParticipant()")),m({id:_.id})})})}),function(){return jt.apply(this,arguments)})},{key:"updateWaitingParticipants",value:(et=j(function*(){var a=this,u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(ve(this._callObjectMode,"updateWaitingParticipants()"),Q(this._callState,"updateWaitingParticipants()"),G(u)!=="object")throw new Error("updateWaitingParticipants() must take a mapping between ids and update objects");return new Promise(function(d,m){a.sendMessageToCallMachine({action:"daily-method-update-waiting-participants",updatesById:u},function(p){p.error&&m(p.error),p.ids||m(new Error("unknown error in updateWaitingParticipants()")),d({ids:p.ids})})})}),function(){return et.apply(this,arguments)})},{key:"requestAccess",value:(It=j(function*(){var a=this,u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=u.access,m=d===void 0?{level:Fc}:d,p=u.name,_=p===void 0?"":p;return ve(this._callObjectMode,"requestAccess()"),Q(this._callState,"requestAccess()"),new Promise(function(T,P){a.sendMessageToCallMachine({action:"daily-method-request-access",access:m,name:_},function(U){U.error&&P(U.error),U.access||P(new Error("unknown error in requestAccess()")),T({access:U.access,granted:U.granted})})})}),function(){return It.apply(this,arguments)})},{key:"localAudio",value:function(){return this._participants.local?!["blocked","off"].includes(this._participants.local.tracks.audio.state):null}},{key:"localVideo",value:function(){return this._participants.local?!["blocked","off"].includes(this._participants.local.tracks.video.state):null}},{key:"setLocalAudio",value:function(a){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return"forceDiscardTrack"in u&&(V()?(console.warn("forceDiscardTrack option not supported in React Native; ignoring"),u={}):a&&(console.warn("forceDiscardTrack option only supported when calling setLocalAudio(false); ignoring"),u={})),this.sendMessageToCallMachine({action:"local-audio",state:a,options:u}),this}},{key:"localScreenAudio",value:function(){return this._participants.local?!["blocked","off"].includes(this._participants.local.tracks.screenAudio.state):null}},{key:"localScreenVideo",value:function(){return this._participants.local?!["blocked","off"].includes(this._participants.local.tracks.screenVideo.state):null}},{key:"updateScreenShare",value:function(a){if(this._isScreenSharing)return this.sendMessageToCallMachine({action:"local-screen-update",options:a}),this;console.warn("There is no screen share in progress. Try calling startScreenShare first.")}},{key:"setLocalVideo",value:function(a){return this.sendMessageToCallMachine({action:"local-video",state:a}),this}},{key:"getReceiveSettings",value:(Ze=j(function*(a){var u=this,d=(arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}).showInheritedValues,m=d!==void 0&&d;if(ve(this._callObjectMode,"getReceiveSettings()"),!this._callMachineInitialized)return this._receiveSettings;switch(G(a)){case"string":return new Promise(function(p){u.sendMessageToCallMachine({action:"get-single-participant-receive-settings",id:a,showInheritedValues:m},function(_){p(_.receiveSettings)})});case"undefined":return this._receiveSettings;default:throw new Error('first argument to getReceiveSettings() must be a participant id (or "base"), or there should be no arguments')}}),function(a){return Ze.apply(this,arguments)})},{key:"updateReceiveSettings",value:(Dt=j(function*(a){var u=this;if(ve(this._callObjectMode,"updateReceiveSettings()"),!Fa(a,{allowAllParticipantsKey:!0}))throw new Error(qa({allowAllParticipantsKey:!0}));return Q(this._callState,"updateReceiveSettings()","To specify receive settings earlier, use the receiveSettings config property."),new Promise(function(d){u.sendMessageToCallMachine({action:"update-receive-settings",receiveSettings:a},function(m){d({receiveSettings:m.receiveSettings})})})}),function(a){return Dt.apply(this,arguments)})},{key:"_prepInputSettingsToPresentToUser",value:function(a){var u,d,m,p,_,T,P,U;if(a){var K={},X=((u=a.audio)===null||u===void 0||(d=u.processor)===null||d===void 0?void 0:d.type)==="none"&&((m=a.audio)===null||m===void 0||(p=m.processor)===null||p===void 0?void 0:p._isDefaultWhenNone);if(a.audio&&!X){var Oe=R({},a.audio.processor);delete Oe._isDefaultWhenNone,K.audio=R(R({},a.audio),{},{processor:Oe})}var Be=((_=a.video)===null||_===void 0||(T=_.processor)===null||T===void 0?void 0:T.type)==="none"&&((P=a.video)===null||P===void 0||(U=P.processor)===null||U===void 0?void 0:U._isDefaultWhenNone);if(a.video&&!Be){var Pe=R({},a.video.processor);delete Pe._isDefaultWhenNone,K.video=R(R({},a.video),{},{processor:Pe})}return K}}},{key:"getInputSettings",value:function(){var a=this;return J(),new Promise(function(u){u(a._getInputSettings())})}},{key:"_getInputSettings",value:function(){var a,u,d,m,p,_,T,P,U={processor:{type:"none",_isDefaultWhenNone:!0}};this._inputSettings?(a=((d=this._inputSettings)===null||d===void 0?void 0:d.video)||U,u=((m=this._inputSettings)===null||m===void 0?void 0:m.audio)||U):(a=((p=this._preloadCache)===null||p===void 0||(_=p.inputSettings)===null||_===void 0?void 0:_.video)||U,u=((T=this._preloadCache)===null||T===void 0||(P=T.inputSettings)===null||P===void 0?void 0:P.audio)||U);var K={audio:u,video:a};return this._prepInputSettingsToPresentToUser(K)}},{key:"updateInputSettings",value:(Xe=j(function*(a){var u=this;return J(),Ua(a)?(a&&(this._preloadCache.inputSettings||(this._preloadCache.inputSettings={}),$a(a,this.properties.dailyConfig),a.audio&&(this._preloadCache.inputSettings.audio=a.audio),a.video&&(this._preloadCache.inputSettings.video=a.video)),a.video||a.audio?this._callObjectMode&&!this._callMachineInitialized?this._getInputSettings():new Promise(function(d,m){u.sendMessageToCallMachine({action:"update-input-settings",inputSettings:a},function(p){p.error?m(p.error):d({inputSettings:u._prepInputSettingsToPresentToUser(p.inputSettings)})})}):this._getInputSettings()):(console.error(Ln()),Promise.reject(Ln()))}),function(a){return Xe.apply(this,arguments)})},{key:"setBandwidth",value:function(a){var u=a.kbs,d=a.trackConstraints;if(J(),this._callMachineInitialized)return this.sendMessageToCallMachine({action:"set-bandwidth",kbs:u,trackConstraints:d}),this}},{key:"getDailyLang",value:function(){var a=this;if(J(),this._callMachineInitialized)return new Promise(function(u){a.sendMessageToCallMachine({action:"get-daily-lang"},function(d){delete d.action,delete d.callbackStamp,u(d)})})}},{key:"setDailyLang",value:function(a){return J(),this.sendMessageToCallMachine({action:"set-daily-lang",lang:a}),this}},{key:"setProxyUrl",value:function(a){return this.sendMessageToCallMachine({action:"set-proxy-url",proxyUrl:a}),this}},{key:"setIceConfig",value:function(a){return this.sendMessageToCallMachine({action:"set-ice-config",iceConfig:a}),this}},{key:"meetingSessionSummary",value:function(){return[it,Fe].includes(this._callState)?this._finalSummaryOfPrevSession:this._meetingSessionSummary}},{key:"getMeetingSession",value:(Ye=j(function*(){var a=this;return console.warn("getMeetingSession() is deprecated: use meetingSessionSummary(), which will return immediately"),Q(this._callState,"getMeetingSession()"),new Promise(function(u){a.sendMessageToCallMachine({action:"get-meeting-session"},function(d){delete d.action,delete d.callbackStamp,u(d)})})}),function(){return Ye.apply(this,arguments)})},{key:"meetingSessionState",value:function(){return Q(this._callState,"meetingSessionState"),this._meetingSessionState}},{key:"setMeetingSessionData",value:function(a){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"replace";ve(this._callObjectMode,"setMeetingSessionData()"),Q(this._callState,"setMeetingSessionData");try{(function(d,m){new Gl({data:d,mergeStrategy:m})})(a,u)}catch(d){throw console.error(d),d}try{this.sendMessageToCallMachine({action:"set-session-data",data:a,mergeStrategy:u})}catch(d){throw new Error("Error setting meeting session data: ".concat(d))}}},{key:"setUserName",value:function(a,u){var d=this;return this.properties.userName=a,new Promise(function(m){d.sendMessageToCallMachine({action:"set-user-name",name:a??"",thisMeetingOnly:V()||!!u&&!!u.thisMeetingOnly},function(p){delete p.action,delete p.callbackStamp,m(p)})})}},{key:"setUserData",value:(Ee=j(function*(a){var u=this;try{Ba(a)}catch(d){throw console.error(d),d}if(this.properties.userData=a,this._callMachineInitialized)return new Promise(function(d){try{u.sendMessageToCallMachine({action:"set-user-data",userData:a},function(m){delete m.action,delete m.callbackStamp,d(m)})}catch(m){throw new Error("Error setting user data: ".concat(m))}})}),function(a){return Ee.apply(this,arguments)})},{key:"validateAudioLevelInterval",value:function(a){if(a&&(a<100||typeof a!="number"))throw new Error("The interval must be a number greater than or equal to 100 milliseconds.")}},{key:"startLocalAudioLevelObserver",value:function(a){var u=this;if(typeof AudioWorkletNode>"u"&&!V())throw new Error("startLocalAudioLevelObserver() is not supported on this browser");if(this.validateAudioLevelInterval(a),this._callMachineInitialized)return this._isLocalAudioLevelObserverRunning=!0,new Promise(function(d,m){u.sendMessageToCallMachine({action:"start-local-audio-level-observer",interval:a},function(p){u._isLocalAudioLevelObserverRunning=!p.error,p.error?m({error:p.error}):d()})});this._preloadCache.localAudioLevelObserver={enabled:!0,interval:a}}},{key:"isLocalAudioLevelObserverRunning",value:function(){return this._isLocalAudioLevelObserverRunning}},{key:"stopLocalAudioLevelObserver",value:function(){this._preloadCache.localAudioLevelObserver=null,this._localAudioLevel=0,this._isLocalAudioLevelObserverRunning=!1,this.sendMessageToCallMachine({action:"stop-local-audio-level-observer"})}},{key:"startRemoteParticipantsAudioLevelObserver",value:function(a){var u=this;if(this.validateAudioLevelInterval(a),this._callMachineInitialized)return this._isRemoteParticipantsAudioLevelObserverRunning=!0,new Promise(function(d,m){u.sendMessageToCallMachine({action:"start-remote-participants-audio-level-observer",interval:a},function(p){u._isRemoteParticipantsAudioLevelObserverRunning=!p.error,p.error?m({error:p.error}):d()})});this._preloadCache.remoteParticipantsAudioLevelObserver={enabled:!0,interval:a}}},{key:"isRemoteParticipantsAudioLevelObserverRunning",value:function(){return this._isRemoteParticipantsAudioLevelObserverRunning}},{key:"stopRemoteParticipantsAudioLevelObserver",value:function(){this._preloadCache.remoteParticipantsAudioLevelObserver=null,this._remoteParticipantsAudioLevel={},this._isRemoteParticipantsAudioLevelObserverRunning=!1,this.sendMessageToCallMachine({action:"stop-remote-participants-audio-level-observer"})}},{key:"startCamera",value:(ge=j(function*(){var a=this,u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(ve(this._callObjectMode,"startCamera()"),nn(this._callState,this._isPreparingToJoin,"startCamera()","Did you mean to use setLocalAudio() and/or setLocalVideo() instead?"),this.needsLoad())try{yield this.load(u)}catch(d){return Promise.reject(d)}else{if(this._didPreAuth){if(u.url&&u.url!==this.properties.url)return console.error("url in startCamera() is different than the one used in preAuth()"),Promise.reject();if(u.token&&u.token!==this.properties.token)return console.error("token in startCamera() is different than the one used in preAuth()"),Promise.reject()}this.validateProperties(u),this.properties=R(R({},this.properties),u)}return new Promise(function(d){a.sendMessageToCallMachine({action:"start-camera",properties:wt(a.properties,a.callClientId),preloadCache:wt(a._preloadCache,a.callClientId)},function(m){delete m.action,delete m.callbackStamp,d(m)})})}),function(){return ge.apply(this,arguments)})},{key:"validateCustomTrack",value:function(a,u,d){if(d&&d.length>50)throw new Error("Custom track `trackName` must not be more than 50 characters");if(u&&u!=="music"&&u!=="speech"&&!(u instanceof Object))throw new Error("Custom track `mode` must be either `music` | `speech` | `DailyMicAudioModeSettings` or `undefined`");if(d&&["cam-audio","cam-video","screen-video","screen-audio","rmpAudio","rmpVideo","customVideoDefaults"].includes(d))throw new Error("Custom track `trackName` must not match a track name already used by daily: cam-audio, cam-video, customVideoDefaults, screen-video, screen-audio, rmpAudio, rmpVideo");if(!(a instanceof MediaStreamTrack))throw new Error("Custom tracks provided must be instances of MediaStreamTrack")}},{key:"startCustomTrack",value:function(){var a=this,u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{track,mode,trackName};return J(),Q(this._callState,"startCustomTrack()"),this.validateCustomTrack(u.track,u.mode,u.trackName),new Promise(function(d,m){a._sharedTracks.customTrack=u.track,u.track=qt,a.sendMessageToCallMachine({action:"start-custom-track",properties:u},function(p){p.error?m({error:p.error}):d(p.mediaTag)})})}},{key:"stopCustomTrack",value:function(a){var u=this;return J(),Q(this._callState,"stopCustomTrack()"),new Promise(function(d){u.sendMessageToCallMachine({action:"stop-custom-track",mediaTag:a},function(m){d(m.mediaTag)})})}},{key:"setCamera",value:function(a){var u=this;return Ut(),pr(this._callMachineInitialized,"setCamera()"),new Promise(function(d){u.sendMessageToCallMachine({action:"set-camera",cameraDeviceId:a},function(m){d({device:m.device})})})}},{key:"setAudioDevice",value:(te=j(function*(a){return Ut(),this.nativeUtils().setAudioDevice(a),{deviceId:yield this.nativeUtils().getAudioDevice()}}),function(a){return te.apply(this,arguments)})},{key:"cycleCamera",value:function(){var a=this,u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return new Promise(function(d){a.sendMessageToCallMachine({action:"cycle-camera",properties:u},function(m){d({device:m.device})})})}},{key:"cycleMic",value:function(){var a=this;return J(),new Promise(function(u){a.sendMessageToCallMachine({action:"cycle-mic"},function(d){u({device:d.device})})})}},{key:"getCameraFacingMode",value:function(){var a=this;return Ut(),new Promise(function(u){a.sendMessageToCallMachine({action:"get-camera-facing-mode"},function(d){u(d.facingMode)})})}},{key:"setInputDevicesAsync",value:(N=j(function*(a){var u=this,d=a.audioDeviceId,m=a.videoDeviceId,p=a.audioSource,_=a.videoSource;return J(),p!==void 0&&(d=p),_!==void 0&&(m=_),d&&(this._preloadCache.audioDeviceId=d,this._sharedTracks.audioDeviceId=d),m&&(this._preloadCache.videoDeviceId=m,this._sharedTracks.videoDeviceId=m),this._callObjectMode&&this.needsLoad()?{camera:{deviceId:this._preloadCache.videoDeviceId},mic:{deviceId:this._preloadCache.audioDeviceId},speaker:{deviceId:this._preloadCache.outputDeviceId}}:(d instanceof MediaStreamTrack&&(d=qt),m instanceof MediaStreamTrack&&(m=qt),new Promise(function(T){u.sendMessageToCallMachine({action:"set-input-devices",audioDeviceId:d,videoDeviceId:m},function(P){delete P.action,delete P.callbackStamp,P.returnPreloadCache?T({camera:{deviceId:u._preloadCache.videoDeviceId},mic:{deviceId:u._preloadCache.audioDeviceId},speaker:{deviceId:u._preloadCache.outputDeviceId}}):T(P)})}))}),function(a){return N.apply(this,arguments)})},{key:"setOutputDeviceAsync",value:(F=j(function*(a){var u=this,d=a.outputDeviceId;return J(),d&&(this._preloadCache.outputDeviceId=d),this._callObjectMode&&this.needsLoad()?{camera:{deviceId:this._preloadCache.videoDeviceId},mic:{deviceId:this._preloadCache.audioDeviceId},speaker:{deviceId:this._preloadCache.outputDeviceId}}:new Promise(function(m){u.sendMessageToCallMachine({action:"set-output-device",outputDeviceId:d},function(p){delete p.action,delete p.callbackStamp,p.returnPreloadCache?m({camera:{deviceId:u._preloadCache.videoDeviceId},mic:{deviceId:u._preloadCache.audioDeviceId},speaker:{deviceId:u._preloadCache.outputDeviceId}}):m(p)})})}),function(a){return F.apply(this,arguments)})},{key:"getInputDevices",value:(L=j(function*(){var a=this;return this._callObjectMode&&this.needsLoad()?{camera:{deviceId:this._preloadCache.videoDeviceId},mic:{deviceId:this._preloadCache.audioDeviceId},speaker:{deviceId:this._preloadCache.outputDeviceId}}:new Promise(function(u){a.sendMessageToCallMachine({action:"get-input-devices"},function(d){delete d.action,delete d.callbackStamp,d.returnPreloadCache?u({camera:{deviceId:a._preloadCache.videoDeviceId},mic:{deviceId:a._preloadCache.audioDeviceId},speaker:{deviceId:a._preloadCache.outputDeviceId}}):u(d)})})}),function(){return L.apply(this,arguments)})},{key:"nativeInCallAudioMode",value:function(){return Ut(),this._nativeInCallAudioMode}},{key:"setNativeInCallAudioMode",value:function(a){if(Ut(),[qs,fu].includes(a)){if(a!==this._nativeInCallAudioMode)return this._nativeInCallAudioMode=a,!this.disableReactNativeAutoDeviceManagement("audio")&&br(this._callState,this._isPreparingToJoin)&&this.nativeUtils().setAudioMode(this._nativeInCallAudioMode),this}else console.error("invalid in-call audio mode specified: ",a)}},{key:"preAuth",value:(A=j(function*(){var a=this,u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(ve(this._callObjectMode,"preAuth()"),nn(this._callState,this._isPreparingToJoin,"preAuth()"),this.needsLoad()&&(yield this.load(u)),!u.url)throw new Error("preAuth() requires at least a url to be provided");return this.validateProperties(u),this.properties=R(R({},this.properties),u),new Promise(function(d,m){a.sendMessageToCallMachine({action:"daily-method-preauth",properties:wt(a.properties,a.callClientId),preloadCache:wt(a._preloadCache,a.callClientId)},function(p){return p.error?m(p.error):p.access?(a._didPreAuth=!0,void d({access:p.access})):m(new Error("unknown error in preAuth()"))})})}),function(){return A.apply(this,arguments)})},{key:"load",value:(E=j(function*(a){var u=this;if(this.needsLoad()){if(this._destroyed&&(this._logUseAfterDestroy(),this.strictMode))throw new Error("Use after destroy");if(a&&(this.validateProperties(a),this.properties=R(R({},this.properties),a)),!this._callObjectMode&&!this.properties.url)throw new Error("can't load iframe meeting because url property isn't set");return this._updateCallState(ps),this.emitDailyJSEvent({action:Wc}),this._callObjectMode?new Promise(function(d,m){u._callObjectLoader.cancel();var p=Date.now();u._callObjectLoader.load(u.properties.dailyConfig,function(_){u._bundleLoadTime=_?"no-op":Date.now()-p,u._updateCallState(ms),_&&u.emitDailyJSEvent({action:vs}),d()},function(_,T){if(u.emitDailyJSEvent({action:Gc}),!T){u._updateCallState(Fe),u.resetMeetingDependentVars();var P={action:ws,errorMsg:_.msg,error:{type:"connection-error",msg:"Failed to load call object bundle.",details:{on:"load",sourceError:_,bundleUrl:_r(u.properties.dailyConfig)}}};u._maybeSendToSentry(P),u.emitDailyJSEvent(P),m(_.msg)}})}):(this._iframe.src=pa(this.assembleMeetingUrl(),this.properties.dailyConfig),new Promise(function(d,m){u._loadedCallback=function(p){u._callState!==Fe?(u._updateCallState(ms),(u.properties.cssFile||u.properties.cssText)&&u.loadCss(u.properties),d()):m(p)}}))}}),function(a){return E.apply(this,arguments)})},{key:"join",value:(w=j(function*(){var a=this,u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._testCallInProgress&&this.stopTestCallQuality();var d=!1;if(this.needsLoad()){this.updateIsPreparingToJoin(!0);try{yield this.load(u)}catch(m){return this.updateIsPreparingToJoin(!1),Promise.reject(m)}}else{if(d=!(!this.properties.cssFile&&!this.properties.cssText),this._didPreAuth){if(u.url&&u.url!==this.properties.url)return console.error("url in join() is different than the one used in preAuth()"),this.updateIsPreparingToJoin(!1),Promise.reject();if(u.token&&u.token!==this.properties.token)return console.error("token in join() is different than the one used in preAuth()"),this.updateIsPreparingToJoin(!1),Promise.reject()}if(u.url&&!this._callObjectMode&&u.url&&u.url!==this.properties.url)return console.error("url in join() is different than the one used in load() (".concat(this.properties.url," -> ").concat(u.url,")")),this.updateIsPreparingToJoin(!1),Promise.reject();this.validateProperties(u),this.properties=R(R({},this.properties),u)}return u.showLocalVideo!==void 0&&(this._callObjectMode?console.error("showLocalVideo is not available in callObject mode"):this._showLocalVideo=!!u.showLocalVideo),u.showParticipantsBar!==void 0&&(this._callObjectMode?console.error("showParticipantsBar is not available in callObject mode"):this._showParticipantsBar=!!u.showParticipantsBar),this._callState===ct||this._callState===Cn?(console.warn("already joined meeting, call leave() before joining again"),void this.updateIsPreparingToJoin(!1)):(this._updateCallState(Cn,!1),this.emitDailyJSEvent({action:Kc}),this._preloadCache.inputSettings||(this._preloadCache.inputSettings={}),u.inputSettings&&u.inputSettings.audio&&(this._preloadCache.inputSettings.audio=u.inputSettings.audio),u.inputSettings&&u.inputSettings.video&&(this._preloadCache.inputSettings.video=u.inputSettings.video),this.sendMessageToCallMachine({action:"join-meeting",properties:wt(this.properties,this.callClientId),preloadCache:wt(this._preloadCache,this.callClientId)}),new Promise(function(m,p){a._joinedCallback=function(_,T){if(a._callState!==Fe){if(a._updateCallState(ct),_)for(var P in _){if(a._callObjectMode){var U=a._callMachine().store;Is(_[P],U),js(_[P],U),Rs(_[P],a._participants[P],U)}a._participants[P]=R({},_[P]),a.toggleParticipantAudioBasedOnNativeAudioFocus()}d&&a.loadCss(a.properties),m(_)}else p(T)}}))}),function(){return w.apply(this,arguments)})},{key:"leave",value:(C=j(function*(){var a=this;return this._testCallInProgress&&this.stopTestCallQuality(),new Promise(function(u){a._callState===it||a._callState===Fe?u():a._callObjectLoader&&!a._callObjectLoader.loaded?(a._callObjectLoader.cancel(),a._updateCallState(it),a.resetMeetingDependentVars(),a.emitDailyJSEvent({action:it}),u()):(a._resolveLeave=u,a.sendMessageToCallMachine({action:"leave-meeting"}))})}),function(){return C.apply(this,arguments)})},{key:"startScreenShare",value:(D=j(function*(){var a=this,u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(pr(this._callMachineInitialized,"startScreenShare()"),u.screenVideoSendSettings&&this._validateVideoSendSettings("screenVideo",u.screenVideoSendSettings),u.mediaStream&&(this._sharedTracks.screenMediaStream=u.mediaStream,u.mediaStream=qt),typeof DailyNativeUtils<"u"&&DailyNativeUtils.isIOS!==void 0&&DailyNativeUtils.isIOS){var d=this.nativeUtils();if(yield d.isScreenBeingCaptured())return void this.emitDailyJSEvent({action:_s,type:"screen-share-error",errorMsg:"Could not start the screen sharing. The screen is already been captured!"});d.setSystemScreenCaptureStartCallback(function(){d.setSystemScreenCaptureStartCallback(null),a.sendMessageToCallMachine({action:ks,captureOptions:u})}),d.presentSystemScreenCapturePrompt()}else this.sendMessageToCallMachine({action:ks,captureOptions:u})}),function(){return D.apply(this,arguments)})},{key:"stopScreenShare",value:function(){pr(this._callMachineInitialized,"stopScreenShare()"),this.sendMessageToCallMachine({action:"local-screen-stop"})}},{key:"startRecording",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.sendMessageToCallMachine(R({action:"local-recording-start"},a))}},{key:"updateRecording",value:function(a){var u=a.layout,d=u===void 0?{preset:"default"}:u,m=a.instanceId;this.sendMessageToCallMachine({action:"daily-method-update-recording",layout:d,instanceId:m})}},{key:"stopRecording",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.sendMessageToCallMachine(R({action:"local-recording-stop"},a))}},{key:"startLiveStreaming",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.sendMessageToCallMachine(R({action:"daily-method-start-live-streaming"},a))}},{key:"updateLiveStreaming",value:function(a){var u=a.layout,d=u===void 0?{preset:"default"}:u,m=a.instanceId;this.sendMessageToCallMachine({action:"daily-method-update-live-streaming",layout:d,instanceId:m})}},{key:"addLiveStreamingEndpoints",value:function(a){var u=a.endpoints,d=a.instanceId;this.sendMessageToCallMachine({action:Cs,endpointsOp:Fl,endpoints:u,instanceId:d})}},{key:"removeLiveStreamingEndpoints",value:function(a){var u=a.endpoints,d=a.instanceId;this.sendMessageToCallMachine({action:Cs,endpointsOp:Ul,endpoints:u,instanceId:d})}},{key:"stopLiveStreaming",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.sendMessageToCallMachine(R({action:"daily-method-stop-live-streaming"},a))}},{key:"validateDailyConfig",value:function(a){a.camSimulcastEncodings&&(console.warn("camSimulcastEncodings is deprecated. Use sendSettings, found in DailyCallOptions, to provide camera simulcast settings."),this.validateSimulcastEncodings(a.camSimulcastEncodings)),a.screenSimulcastEncodings&&console.warn("screenSimulcastEncodings is deprecated. Use sendSettings, found in DailyCallOptions, to provide screen simulcast settings."),xa()&&a.noAutoDefaultDeviceChange&&console.warn("noAutoDefaultDeviceChange is not supported on Android, and will be ignored.")}},{key:"validateSimulcastEncodings",value:function(a){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,d=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(a){if(!(a instanceof Array||Array.isArray(a)))throw new Error("encodings must be an Array");if(!Qs(a.length,1,3))throw new Error("encodings must be an Array with between 1 to ".concat(3," layers"));for(var m=0;m<a.length;m++){var p=a[m];for(var _ in this._validateEncodingLayerHasValidProperties(p),p)if(rn.includes(_)){if(typeof p[_]!="number")throw new Error("".concat(_," must be a number"));if(u){var T=u[_],P=T.min,U=T.max;if(!Qs(p[_],P,U))throw new Error("".concat(_," value not in range. valid range: ").concat(P," to ").concat(U))}}else if(!["active","scalabilityMode"].includes(_))throw new Error("Invalid key ".concat(_,", valid keys are:")+Object.values(rn));if(d&&!p.hasOwnProperty("maxBitrate"))throw new Error("maxBitrate is not specified")}}}},{key:"startRemoteMediaPlayer",value:(x=j(function*(a){var u=this,d=a.url,m=a.settings,p=m===void 0?{state:En.PLAY}:m;try{(function(_){if(typeof _!="string")throw new Error('url parameter must be "string" type')})(d),Hs(p),function(_){for(var T in _)if(!zs.includes(T))throw new Error("Invalid key ".concat(T,", valid keys are: ").concat(zs));_.simulcastEncodings&&this.validateSimulcastEncodings(_.simulcastEncodings,Na,!0)}(p)}catch(_){throw console.error("invalid argument Error: ".concat(_)),console.error(`startRemoteMediaPlayer arguments must be of the form:
  { url: "playback url",
  settings?:
  {state: "play"|"pause", simulcastEncodings?: [{}] } }`),_}return new Promise(function(_,T){u.sendMessageToCallMachine({action:"daily-method-start-remote-media-player",url:d,settings:p},function(P){P.error?T({error:P.error,errorMsg:P.errorMsg}):_({session_id:P.session_id,remoteMediaPlayerState:{state:P.state,settings:P.settings}})})})}),function(a){return x.apply(this,arguments)})},{key:"stopRemoteMediaPlayer",value:(O=j(function*(a){var u=this;if(typeof a!="string")throw new Error(" remotePlayerID must be of type string");return new Promise(function(d,m){u.sendMessageToCallMachine({action:"daily-method-stop-remote-media-player",session_id:a},function(p){p.error?m({error:p.error,errorMsg:p.errorMsg}):d()})})}),function(a){return O.apply(this,arguments)})},{key:"updateRemoteMediaPlayer",value:(M=j(function*(a){var u=this,d=a.session_id,m=a.settings;try{Hs(m)}catch(p){throw console.error("invalid argument Error: ".concat(p)),console.error(`updateRemoteMediaPlayer arguments must be of the form:
  session_id: "participant session",
  { settings?: {state: "play"|"pause"} }`),p}return new Promise(function(p,_){u.sendMessageToCallMachine({action:"daily-method-update-remote-media-player",session_id:d,settings:m},function(T){T.error?_({error:T.error,errorMsg:T.errorMsg}):p({session_id:T.session_id,remoteMediaPlayerState:{state:T.state,settings:T.settings}})})})}),function(a){return M.apply(this,arguments)})},{key:"startTranscription",value:function(a){Q(this._callState,"startTranscription()"),this.sendMessageToCallMachine(R({action:"daily-method-start-transcription"},a))}},{key:"updateTranscription",value:function(a){if(Q(this._callState,"updateTranscription()"),!a)throw new Error("updateTranscription Error: options is mandatory");if(G(a)!=="object")throw new Error("updateTranscription Error: options must be object type");if(a.participants&&!Array.isArray(a.participants))throw new Error("updateTranscription Error: participants must be an array");this.sendMessageToCallMachine(R({action:"daily-method-update-transcription"},a))}},{key:"stopTranscription",value:function(a){if(Q(this._callState,"stopTranscription()"),a&&G(a)!=="object")throw new Error("stopTranscription Error: options must be object type");if(a&&!a.instanceId)throw new Error('"instanceId" not provided');this.sendMessageToCallMachine(R({action:"daily-method-stop-transcription"},a))}},{key:"startDialOut",value:(b=j(function*(a){var u=this;Q(this._callState,"startDialOut()");var d=function(m){if(m){if(!Array.isArray(m))throw new Error("Error starting dial out: audio codec must be an array");if(m.length<=0)throw new Error("Error starting dial out: audio codec array specified but empty");m.forEach(function(p){if(typeof p!="string")throw new Error("Error starting dial out: audio codec must be a string");if(p!=="OPUS"&&p!=="PCMU"&&p!=="PCMA"&&p!=="G722")throw new Error("Error starting dial out: audio codec must be one of OPUS, PCMU, PCMA, G722")})}};if(!a.sipUri&&!a.phoneNumber)throw new Error("Error starting dial out: either a sip uri or phone number must be provided");if(a.sipUri&&a.phoneNumber)throw new Error("Error starting dial out: only one of sip uri or phone number must be provided");if(a.sipUri){if(typeof a.sipUri!="string")throw new Error("Error starting dial out: sipUri must be a string");if(!a.sipUri.startsWith("sip:"))throw new Error("Error starting dial out: Invalid SIP URI, must start with 'sip:'");if(a.video&&typeof a.video!="boolean")throw new Error("Error starting dial out: video must be a boolean value");(function(m){if(m&&(d(m.audio),m.video)){if(!Array.isArray(m.video))throw new Error("Error starting dial out: video codec must be an array");if(m.video.length<=0)throw new Error("Error starting dial out: video codec array specified but empty");m.video.forEach(function(p){if(typeof p!="string")throw new Error("Error starting dial out: video codec must be a string");if(p!=="H264"&&p!=="VP8")throw new Error("Error starting dial out: video codec must be H264 or VP8")})}})(a.codecs)}if(a.phoneNumber){if(typeof a.phoneNumber!="string")throw new Error("Error starting dial out: phoneNumber must be a string");if(!/^\+\d{1,}$/.test(a.phoneNumber))throw new Error("Error starting dial out: Invalid phone number, must be valid phone number as per E.164");a.codecs&&d(a.codecs.audio)}if(a.callerId){if(typeof a.callerId!="string")throw new Error("Error starting dial out: callerId must be a string");if(a.sipUri)throw new Error("Error starting dial out: callerId not allowed with sipUri")}if(a.displayName){if(typeof a.displayName!="string")throw new Error("Error starting dial out: displayName must be a string");if(a.displayName.length>=200)throw new Error("Error starting dial out: displayName length must be less than 200")}if(a.userId){if(typeof a.userId!="string")throw new Error("Error starting dial out: userId must be a string");if(a.userId.length>36)throw new Error("Error starting dial out: userId length must be less than or equal to 36")}return new Promise(function(m,p){u.sendMessageToCallMachine(R({action:"dialout-start"},a),function(_){_.error?p(_.error):m(_)})})}),function(a){return b.apply(this,arguments)})},{key:"stopDialOut",value:function(a){var u=this;return Q(this._callState,"stopDialOut()"),new Promise(function(d,m){u.sendMessageToCallMachine(R({action:"dialout-stop"},a),function(p){p.error?m(p.error):d(p)})})}},{key:"sipCallTransfer",value:(v=j(function*(a){var u=this;if(Q(this._callState,"sipCallTransfer()"),!a)throw new Error("sipCallTransfer() requires a sessionId and toEndPoint");return a.useSipRefer=!1,Gs(a,"sipCallTransfer"),new Promise(function(d,m){u.sendMessageToCallMachine(R({action:Es},a),function(p){p.error?m(p.error):d(p)})})}),function(a){return v.apply(this,arguments)})},{key:"sipRefer",value:(k=j(function*(a){var u=this;if(Q(this._callState,"sipRefer()"),!a)throw new Error("sessionId and toEndPoint are mandatory parameter");return a.useSipRefer=!0,Gs(a,"sipRefer"),new Promise(function(d,m){u.sendMessageToCallMachine(R({action:Es},a),function(p){p.error?m(p.error):d(p)})})}),function(a){return k.apply(this,arguments)})},{key:"sendDTMF",value:(y=j(function*(a){var u=this;return Q(this._callState,"sendDTMF()"),function(d){var m=d.sessionId,p=d.tones;if(!m||!p)throw new Error("sessionId and tones are mandatory parameter");if(typeof m!="string"||typeof p!="string")throw new Error("sessionId and tones should be of string type");if(p.length>20)throw new Error("tones string must be upto 20 characters");var _=/[^0-9A-D*#]/g,T=p.match(_);if(T&&T[0])throw new Error("".concat(T[0]," is not valid DTMF tone"))}(a),new Promise(function(d,m){u.sendMessageToCallMachine(R({action:"send-dtmf"},a),function(p){p.error?m(p.error):d(p)})})}),function(a){return y.apply(this,arguments)})},{key:"getNetworkStats",value:function(){var a=this;return this._callState!==ct?{stats:{latest:{}}}:new Promise(function(u){a.sendMessageToCallMachine({action:"get-calc-stats"},function(d){u(R({stats:d.stats},a._network))})})}},{key:"testWebsocketConnectivity",value:(g=j(function*(){var a=this;if(sn(this._testCallInProgress,"testWebsocketConnectivity()"),this.needsLoad())try{yield this.load()}catch(u){return Promise.reject(u)}return new Promise(function(u,d){a.sendMessageToCallMachine({action:"test-websocket-connectivity"},function(m){m.error?d(m.error):u(m.results)})})}),function(){return g.apply(this,arguments)})},{key:"abortTestWebsocketConnectivity",value:function(){this.sendMessageToCallMachine({action:"abort-test-websocket-connectivity"})}},{key:"_validateVideoTrackForNetworkTests",value:function(a){return a?a instanceof MediaStreamTrack?!!lu(a)||(console.error("Video track is not playable. This test needs a live video track."),!1):(console.error("Video track needs to be of type `MediaStreamTrack`."),!1):(console.error("Missing video track. You must provide a video track in order to run this test."),!1)}},{key:"testCallQuality",value:(f=j(function*(){var a=this;J(),ve(this._callObjectMode,"testCallQuality()"),pr(this._callMachineInitialized,"testCallQuality()",null,!0),nn(this._callState,this._isPreparingToJoin,"testCallQuality()");var u=this._testCallAlreadyInProgress,d=function(p){u||(a._testCallInProgress=p)};if(d(!0),this.needsLoad())try{var m=this._callState;yield this.load(),this._callState=m}catch(p){return d(!1),Promise.reject(p)}return new Promise(function(p){a.sendMessageToCallMachine({action:"test-call-quality",dailyJsVersion:a.properties.dailyJsVersion},function(_){var T=_.results,P=T.result,U=ii(T,uu);if(P==="failed"){var K,X=R({},U);(K=U.error)!==null&&K!==void 0&&K.details?(U.error.details=JSON.parse(U.error.details),X.error=R(R({},X.error),{},{details:R({},X.error.details)}),X.error.details.duringTest="testCallQuality"):(X.error=X.error?R({},X.error):{},X.error.details={duringTest:"testCallQuality"}),a._maybeSendToSentry(X)}d(!1),p(R({result:P},U))})})}),function(){return f.apply(this,arguments)})},{key:"stopTestCallQuality",value:function(){this.sendMessageToCallMachine({action:"stop-test-call-quality"})}},{key:"testConnectionQuality",value:(h=j(function*(a){var u;V()?(console.warn("testConnectionQuality() is deprecated: use testPeerToPeerCallQuality() instead"),u=yield this.testPeerToPeerCallQuality(a)):(console.warn("testConnectionQuality() is deprecated: use testCallQuality() instead"),u=yield this.testCallQuality());var d={result:u.result,secondsElapsed:u.secondsElapsed};return u.data&&(d.data={maxRTT:u.data.maxRoundTripTime,packetLoss:u.data.avgRecvPacketLoss}),d}),function(a){return h.apply(this,arguments)})},{key:"testPeerToPeerCallQuality",value:(c=j(function*(a){var u=this;if(sn(this._testCallInProgress,"testPeerToPeerCallQuality()"),this.needsLoad())try{yield this.load()}catch(p){return Promise.reject(p)}var d=a.videoTrack,m=a.duration;if(!this._validateVideoTrackForNetworkTests(d))throw new Error("Video track error");return this._sharedTracks.videoTrackForConnectionQualityTest=d,new Promise(function(p,_){u.sendMessageToCallMachine({action:"test-p2p-call-quality",duration:m},function(T){T.error?_(T.error):p(T.results)})})}),function(a){return c.apply(this,arguments)})},{key:"stopTestConnectionQuality",value:function(){V()?(console.warn("stopTestConnectionQuality() is deprecated: use testPeerToPeerCallQuality() and stopTestPeerToPeerCallQuality() instead"),this.stopTestPeerToPeerCallQuality()):(console.warn("stopTestConnectionQuality() is deprecated: use testCallQuality() and stopTestCallQuality() instead"),this.stopTestCallQuality())}},{key:"stopTestPeerToPeerCallQuality",value:function(){this.sendMessageToCallMachine({action:"stop-test-p2p-call-quality"})}},{key:"testNetworkConnectivity",value:(l=j(function*(a){var u=this;if(sn(this._testCallInProgress,"testNetworkConnectivity()"),this.needsLoad())try{yield this.load()}catch(d){return Promise.reject(d)}if(!this._validateVideoTrackForNetworkTests(a))throw new Error("Video track error");return this._sharedTracks.videoTrackForNetworkConnectivityTest=a,new Promise(function(d,m){u.sendMessageToCallMachine({action:"test-network-connectivity"},function(p){p.error?m(p.error):d(p.results)})})}),function(a){return l.apply(this,arguments)})},{key:"abortTestNetworkConnectivity",value:function(){this.sendMessageToCallMachine({action:"abort-test-network-connectivity"})}},{key:"getCpuLoadStats",value:function(){var a=this;return new Promise(function(u){a._callState===ct?a.sendMessageToCallMachine({action:"get-cpu-load-stats"},function(d){u(d.cpuStats)}):u({cpuLoadState:void 0,cpuLoadStateReason:void 0,stats:{}})})}},{key:"_validateEncodingLayerHasValidProperties",value:function(a){var u;if(!(((u=Object.keys(a))===null||u===void 0?void 0:u.length)>0))throw new Error("Empty encoding is not allowed. At least one of these valid keys should be specified:"+Object.values(rn))}},{key:"_validateVideoSendSettings",value:function(a,u){var d=a==="screenVideo"?["default-screen-video","detail-optimized","motion-optimized","motion-and-detail-balanced"]:["default-video","bandwidth-optimized","bandwidth-and-quality-balanced","quality-optimized","adaptive-2-layers","adaptive-3-layers"],m="Video send settings should be either an object or one of the supported presets: ".concat(d.join());if(typeof u=="string"){if(!d.includes(u))throw new Error(m)}else{if(G(u)!=="object")throw new Error(m);if(!u.maxQuality&&!u.encodings&&u.allowAdaptiveLayers===void 0)throw new Error("Video send settings must contain at least maxQuality, allowAdaptiveLayers or encodings attribute");if(u.maxQuality&&["low","medium","high"].indexOf(u.maxQuality)===-1)throw new Error("maxQuality must be either low, medium or high");if(u.encodings){var p=!1;switch(Object.keys(u.encodings).length){case 1:p=!u.encodings.low;break;case 2:p=!u.encodings.low||!u.encodings.medium;break;case 3:p=!u.encodings.low||!u.encodings.medium||!u.encodings.high;break;default:p=!0}if(p)throw new Error("Encodings must be defined as: low, low and medium, or low, medium and high.");u.encodings.low&&this._validateEncodingLayerHasValidProperties(u.encodings.low),u.encodings.medium&&this._validateEncodingLayerHasValidProperties(u.encodings.medium),u.encodings.high&&this._validateEncodingLayerHasValidProperties(u.encodings.high)}}}},{key:"validateUpdateSendSettings",value:function(a){var u=this;if(!a||Object.keys(a).length===0)throw new Error("Send settings must contain at least information for one track!");Object.entries(a).forEach(function(d){var m=pt(d,2),p=m[0],_=m[1];u._validateVideoSendSettings(p,_)})}},{key:"updateSendSettings",value:function(a){var u=this;return this.validateUpdateSendSettings(a),this.needsLoad()?(this._preloadCache.sendSettings=a,{sendSettings:this._preloadCache.sendSettings}):new Promise(function(d,m){u.sendMessageToCallMachine({action:"update-send-settings",sendSettings:a},function(p){p.error?m(p.error):d(p.sendSettings)})})}},{key:"getSendSettings",value:function(){return this._sendSettings||this._preloadCache.sendSettings}},{key:"getLocalAudioLevel",value:function(){return this._localAudioLevel}},{key:"getRemoteParticipantsAudioLevel",value:function(){return this._remoteParticipantsAudioLevel}},{key:"getActiveSpeaker",value:function(){return J(),this._activeSpeaker}},{key:"setActiveSpeakerMode",value:function(a){return J(),this.sendMessageToCallMachine({action:"set-active-speaker-mode",enabled:a}),this}},{key:"activeSpeakerMode",value:function(){return J(),this._activeSpeakerMode}},{key:"subscribeToTracksAutomatically",value:function(){return this._preloadCache.subscribeToTracksAutomatically}},{key:"setSubscribeToTracksAutomatically",value:function(a){return Q(this._callState,"setSubscribeToTracksAutomatically()","Use the subscribeToTracksAutomatically configuration property."),this._preloadCache.subscribeToTracksAutomatically=a,this.sendMessageToCallMachine({action:"daily-method-subscribe-to-tracks-automatically",enabled:a}),this}},{key:"enumerateDevices",value:(o=j(function*(){var a=this;if(this._callObjectMode){var u=yield navigator.mediaDevices.enumerateDevices();return yt()==="Firefox"&&Gt().major>115&&Gt().major<123&&(u=u.filter(function(d){return d.kind!=="audiooutput"})),{devices:u.map(function(d){var m=JSON.parse(JSON.stringify(d));if(!V()&&d.kind==="videoinput"&&d.getCapabilities){var p,_=d.getCapabilities();m.facing=(_==null||(p=_.facingMode)===null||p===void 0?void 0:p.length)>=1?_.facingMode[0]:void 0}return m})}}return new Promise(function(d){a.sendMessageToCallMachine({action:"enumerate-devices"},function(m){d({devices:m.devices})})})}),function(){return o.apply(this,arguments)})},{key:"sendAppMessage",value:function(a){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"*";if(Q(this._callState,"sendAppMessage()"),JSON.stringify(a).length>this._maxAppMessageSize)throw new Error("Message data too large. Max size is "+this._maxAppMessageSize);return this.sendMessageToCallMachine({action:"app-msg",data:a,to:u}),this}},{key:"addFakeParticipant",value:function(a){return J(),Q(this._callState,"addFakeParticipant()"),this.sendMessageToCallMachine(R({action:"add-fake-participant"},a)),this}},{key:"setShowNamesMode",value:function(a){return de(this._callObjectMode,"setShowNamesMode()"),J(),a&&a!=="always"&&a!=="never"?(console.error('setShowNamesMode argument should be "always", "never", or false'),this):(this.sendMessageToCallMachine({action:"set-show-names",mode:a}),this)}},{key:"setShowLocalVideo",value:function(){var a=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];return de(this._callObjectMode,"setShowLocalVideo()"),J(),Q(this._callState,"setShowLocalVideo()"),typeof a!="boolean"?(console.error("setShowLocalVideo only accepts a boolean value"),this):(this.sendMessageToCallMachine({action:"set-show-local-video",show:a}),this._showLocalVideo=a,this)}},{key:"showLocalVideo",value:function(){return de(this._callObjectMode,"showLocalVideo()"),J(),this._showLocalVideo}},{key:"setShowParticipantsBar",value:function(){var a=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];return de(this._callObjectMode,"setShowParticipantsBar()"),J(),Q(this._callState,"setShowParticipantsBar()"),typeof a!="boolean"?(console.error("setShowParticipantsBar only accepts a boolean value"),this):(this.sendMessageToCallMachine({action:"set-show-participants-bar",show:a}),this._showParticipantsBar=a,this)}},{key:"showParticipantsBar",value:function(){return de(this._callObjectMode,"showParticipantsBar()"),J(),this._showParticipantsBar}},{key:"customIntegrations",value:function(){return J(),de(this._callObjectMode,"customIntegrations()"),this._customIntegrations}},{key:"setCustomIntegrations",value:function(a){return J(),de(this._callObjectMode,"setCustomIntegrations()"),Q(this._callState,"setCustomIntegrations()"),za(a)?(this.sendMessageToCallMachine({action:"set-custom-integrations",integrations:a}),this._customIntegrations=a,this):this}},{key:"startCustomIntegrations",value:function(a){var u=this;if(J(),de(this._callObjectMode,"startCustomIntegrations()"),Q(this._callState,"startCustomIntegrations()"),Array.isArray(a)&&a.some(function(p){return typeof p!="string"})||!Array.isArray(a)&&typeof a!="string")return console.error("startCustomIntegrations() only accepts string | string[]"),this;var d=typeof a=="string"?[a]:a,m=d.filter(function(p){return!(p in u._customIntegrations)});return m.length?(console.error(`Can't find custom integration(s): "`.concat(m.join(", "),'"')),this):(this.sendMessageToCallMachine({action:"start-custom-integrations",ids:d}),this)}},{key:"stopCustomIntegrations",value:function(a){var u=this;if(J(),de(this._callObjectMode,"stopCustomIntegrations()"),Q(this._callState,"stopCustomIntegrations()"),Array.isArray(a)&&a.some(function(p){return typeof p!="string"})||!Array.isArray(a)&&typeof a!="string")return console.error("stopCustomIntegrations() only accepts string | string[]"),this;var d=typeof a=="string"?[a]:a,m=d.filter(function(p){return!(p in u._customIntegrations)});return m.length?(console.error(`Can't find custom integration(s): "`.concat(m.join(", "),'"')),this):(this.sendMessageToCallMachine({action:"stop-custom-integrations",ids:d}),this)}},{key:"customTrayButtons",value:function(){return de(this._callObjectMode,"customTrayButtons()"),J(),this._customTrayButtons}},{key:"updateCustomTrayButtons",value:function(a){return de(this._callObjectMode,"updateCustomTrayButtons()"),J(),Q(this._callState,"updateCustomTrayButtons()"),Va(a)?(this.sendMessageToCallMachine({action:"update-custom-tray-buttons",btns:a}),this._customTrayButtons=a,this):(console.error("updateCustomTrayButtons only accepts a dictionary of the type ".concat(JSON.stringify(Ar))),this)}},{key:"theme",value:function(){return de(this._callObjectMode,"theme()"),this.properties.theme}},{key:"setTheme",value:function(a){var u=this;return de(this._callObjectMode,"setTheme()"),new Promise(function(d,m){try{u.validateProperties({theme:a}),u.properties.theme=R({},a),u.sendMessageToCallMachine({action:"set-theme",theme:u.properties.theme});try{u.emitDailyJSEvent({action:zc,theme:u.properties.theme})}catch(p){console.log("could not emit 'theme-updated'",p)}d(u.properties.theme)}catch(p){m(p)}})}},{key:"requestFullscreen",value:(s=j(function*(){if(J(),this._iframe&&!document.fullscreenElement&&Ms())try{(yield this._iframe.requestFullscreen)?this._iframe.requestFullscreen():this._iframe.webkitRequestFullscreen()}catch(a){console.log("could not make video call fullscreen",a)}}),function(){return s.apply(this,arguments)})},{key:"exitFullscreen",value:function(){J(),document.fullscreenElement?document.exitFullscreen():document.webkitFullscreenElement&&document.webkitExitFullscreen()}},{key:"getSidebarView",value:(i=j(function*(){var a=this;return this._callObjectMode?(console.error("getSidebarView is not available in callObject mode"),Promise.resolve(null)):new Promise(function(u){a.sendMessageToCallMachine({action:"get-sidebar-view"},function(d){u(d.view)})})}),function(){return i.apply(this,arguments)})},{key:"setSidebarView",value:function(a){return this._callObjectMode?(console.error("setSidebarView is not available in callObject mode"),this):(this.sendMessageToCallMachine({action:"set-sidebar-view",view:a}),this)}},{key:"room",value:(n=j(function*(){var a=this,u=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{}).includeRoomConfigDefaults,d=u===void 0||u;return this._accessState.access===Kr||this.needsLoad()?this.properties.url?{roomUrlPendingJoin:this.properties.url}:null:new Promise(function(m){a.sendMessageToCallMachine({action:"lib-room-info",includeRoomConfigDefaults:d},function(p){delete p.action,delete p.callbackStamp,m(p)})})}),function(){return n.apply(this,arguments)})},{key:"geo",value:(r=j(function*(){try{var a=yield fetch("https://gs.daily.co/_ks_/x-swsl/:");return{current:(yield a.json()).geo}}catch(u){return console.error("geo lookup failed",u),{current:""}}}),function(){return r.apply(this,arguments)})},{key:"setNetworkTopology",value:(e=j(function*(a){var u=this;return J(),Q(this._callState,"setNetworkTopology()"),new Promise(function(d,m){u.sendMessageToCallMachine({action:"set-network-topology",opts:a},function(p){p.error?m({error:p.error}):d({workerId:p.workerId})})})}),function(a){return e.apply(this,arguments)})},{key:"getNetworkTopology",value:(t=j(function*(){var a=this;return new Promise(function(u,d){a.needsLoad()&&u({topology:"none"}),a.sendMessageToCallMachine({action:"get-network-topology"},function(m){m.error?d({error:m.error}):u({topology:m.topology})})})}),function(){return t.apply(this,arguments)})},{key:"setPlayNewParticipantSound",value:function(a){if(J(),typeof a!="number"&&a!==!0&&a!==!1)throw new Error("argument to setShouldPlayNewParticipantSound should be true, false, or a number, but is ".concat(a));this.sendMessageToCallMachine({action:"daily-method-set-play-ding",arg:a})}},{key:"on",value:function(a,u){return je.prototype.on.call(this,a,u)}},{key:"once",value:function(a,u){return je.prototype.once.call(this,a,u)}},{key:"off",value:function(a,u){return je.prototype.off.call(this,a,u)}},{key:"validateProperties",value:function(a){for(var u in a){if(!at[u])throw new Error("unrecognized property '".concat(u,"'"));if(at[u].validate&&!at[u].validate(a[u],this))throw new Error("property '".concat(u,"': ").concat(at[u].help))}}},{key:"assembleMeetingUrl",value:function(){var a,u,d=R(R({},this.properties),{},{emb:this.callClientId,embHref:encodeURIComponent(window.location.href),proxy:(a=this.properties.dailyConfig)!==null&&a!==void 0&&a.proxyUrl?encodeURIComponent((u=this.properties.dailyConfig)===null||u===void 0?void 0:u.proxyUrl):void 0}),m=d.url.match(/\?/)?"&":"?";return d.url+m+Object.keys(at).filter(function(p){return at[p].queryString&&d[p]!==void 0}).map(function(p){return"".concat(at[p].queryString,"=").concat(d[p])}).join("&")}},{key:"needsLoad",value:function(){return[fs,ps,it,Fe].includes(this._callState)}},{key:"sendMessageToCallMachine",value:function(a,u){if(this._destroyed&&(this._logUseAfterDestroy(),this.strictMode))throw new Error("Use after destroy");this._messageChannel.sendMessageToCallMachine(a,u,this.callClientId,this._iframe)}},{key:"forwardPackagedMessageToCallMachine",value:function(a){this._messageChannel.forwardPackagedMessageToCallMachine(a,this._iframe,this.callClientId)}},{key:"addListenerForPackagedMessagesFromCallMachine",value:function(a){return this._messageChannel.addListenerForPackagedMessagesFromCallMachine(a,this.callClientId)}},{key:"removeListenerForPackagedMessagesFromCallMachine",value:function(a){this._messageChannel.removeListenerForPackagedMessagesFromCallMachine(a)}},{key:"handleMessageFromCallMachine",value:function(a){switch(a.action){case Jc:this.sendMessageToCallMachine(R({action:Vc},this.properties));break;case"call-machine-initialized":this._callMachineInitialized=!0;var u={action:dr,level:"log",code:1011,stats:{event:"bundle load",time:this._bundleLoadTime==="no-op"?0:this._bundleLoadTime,preLoaded:this._bundleLoadTime==="no-op",url:_r(this.properties.dailyConfig)}};this.sendMessageToCallMachine(u),this._delayDuplicateInstanceLog&&this._logDuplicateInstanceAttempt();break;case vs:this._loadedCallback&&(this._loadedCallback(),this._loadedCallback=null),this.emitDailyJSEvent(a);break;case Yc:var d,m=R({},a);delete m.internal,this._maxAppMessageSize=((d=a.internal)===null||d===void 0?void 0:d._maxAppMessageSize)||Yr,this._joinedCallback&&(this._joinedCallback(a.participants),this._joinedCallback=null),this.emitDailyJSEvent(m);break;case Zc:case el:if(this._callState===it)return;if(a.participant&&a.participant.session_id){var p=a.participant.local?"local":a.participant.session_id;if(this._callObjectMode){var _=this._callMachine().store;Is(a.participant,_),js(a.participant,_),Rs(a.participant,this._participants[p],_)}try{this.maybeParticipantTracksStopped(this._participants[p],a.participant),this.maybeParticipantTracksStarted(this._participants[p],a.participant),this.maybeEventRecordingStopped(this._participants[p],a.participant),this.maybeEventRecordingStarted(this._participants[p],a.participant)}catch(Nr){console.error("track events error",Nr)}this.compareEqualForParticipantUpdateEvent(a.participant,this._participants[p])||(this._participants[p]=R({},a.participant),this.toggleParticipantAudioBasedOnNativeAudioFocus(),this.emitDailyJSEvent(a))}break;case tl:if(a.participant&&a.participant.session_id){var T=this._participants[a.participant.session_id];T&&this.maybeParticipantTracksStopped(T,null),delete this._participants[a.participant.session_id],this.emitDailyJSEvent(a)}break;case rl:le(this._participantCounts,a.participantCounts)||(this._participantCounts=a.participantCounts,this.emitDailyJSEvent(a));break;case nl:var P={access:a.access};a.awaitingAccess&&(P.awaitingAccess=a.awaitingAccess),le(this._accessState,P)||(this._accessState=P,this.emitDailyJSEvent(a));break;case il:if(a.meetingSession){this._meetingSessionSummary=a.meetingSession,this.emitDailyJSEvent(a);var U=R(R({},a),{},{action:"meeting-session-updated"});this.emitDailyJSEvent(U)}break;case ws:var K;this._iframe&&!a.preserveIframe&&(this._iframe.src=""),this._updateCallState(Fe),this.resetMeetingDependentVars(),this._loadedCallback&&(this._loadedCallback(a.errorMsg),this._loadedCallback=null),a.preserveIframe;var X=ii(a,du);X!=null&&(K=X.error)!==null&&K!==void 0&&K.details&&(X.error.details=JSON.parse(X.error.details)),this._maybeSendToSentry(a),this._joinedCallback&&(this._joinedCallback(null,X),this._joinedCallback=null),this.emitDailyJSEvent(X);break;case Xc:this._callState!==Fe&&this._updateCallState(it),this.resetMeetingDependentVars(),this._resolveLeave&&(this._resolveLeave(),this._resolveLeave=null),this.emitDailyJSEvent(a);break;case"selected-devices-updated":a.devices&&this.emitDailyJSEvent(a);break;case Al:var Oe=a.threshold,Be=a.quality;Oe===this._network.threshold&&Be===this._network.quality||(this._network.quality=Be,this._network.threshold=Oe,this.emitDailyJSEvent(a));break;case Pl:a&&a.cpuLoadState&&this.emitDailyJSEvent(a);break;case Ll:a&&a.faceCounts!==void 0&&this.emitDailyJSEvent(a);break;case Ml:var Pe=a.activeSpeaker;this._activeSpeaker.peerId!==Pe.peerId&&(this._activeSpeaker.peerId=Pe.peerId,this.emitDailyJSEvent({action:a.action,activeSpeaker:this._activeSpeaker}));break;case"show-local-video-changed":if(this._callObjectMode)return;var Zt=a.show;this._showLocalVideo=Zt,this.emitDailyJSEvent({action:a.action,show:Zt});break;case Tl:var Rt=a.enabled;this._activeSpeakerMode!==Rt&&(this._activeSpeakerMode=Rt,this.emitDailyJSEvent({action:a.action,enabled:this._activeSpeakerMode}));break;case al:case ol:case cl:this._waitingParticipants=a.allWaitingParticipants,this.emitDailyJSEvent({action:a.action,participant:a.participant});break;case Nl:le(this._receiveSettings,a.receiveSettings)||(this._receiveSettings=a.receiveSettings,this.emitDailyJSEvent({action:a.action,receiveSettings:a.receiveSettings}));break;case Bl:if(!le(this._inputSettings,a.inputSettings)){var ae=this._getInputSettings();this._inputSettings=a.inputSettings,this._preloadCache.inputSettings={},le(ae,this._getInputSettings())||this.emitDailyJSEvent({action:a.action,inputSettings:this._getInputSettings()})}break;case"send-settings-updated":le(this._sendSettings,a.sendSettings)||(this._sendSettings=a.sendSettings,this._preloadCache.sendSettings=null,this.emitDailyJSEvent({action:a.action,sendSettings:a.sendSettings}));break;case"local-audio-level":this._localAudioLevel=a.audioLevel,this._preloadCache.localAudioLevelObserver=null,this.emitDailyJSEvent(a);break;case"remote-participants-audio-level":this._remoteParticipantsAudioLevel=a.participantsAudioLevel,this._preloadCache.remoteParticipantsAudioLevelObserver=null,this.emitDailyJSEvent(a);break;case _l:var Le=a.session_id;this._rmpPlayerState[Le]=a.playerState,this.emitDailyJSEvent(a);break;case Sl:delete this._rmpPlayerState[a.session_id],this.emitDailyJSEvent(a);break;case wl:var rt=a.session_id,Nt=this._rmpPlayerState[rt];Nt&&this.compareEqualForRMPUpdateEvent(Nt,a.remoteMediaPlayerState)||(this._rmpPlayerState[rt]=a.remoteMediaPlayerState,this.emitDailyJSEvent(a));break;case"custom-button-click":case"sidebar-view-changed":this.emitDailyJSEvent(a);break;case sl:var Rr=this._meetingSessionState.topology!==(a.meetingSessionState&&a.meetingSessionState.topology);this._meetingSessionState=an(a.meetingSessionState,this._callObjectMode),(this._callObjectMode||Rr)&&this.emitDailyJSEvent(a);break;case kl:this._isScreenSharing=!0,this.emitDailyJSEvent(a);break;case Cl:case El:this._isScreenSharing=!1,this.emitDailyJSEvent(a);break;case ys:case bs:case pl:case ml:case gl:case dl:case hl:case fl:case Hc:case Qc:case yl:case bl:case"test-completed":case Ol:case vl:case xl:case Dl:case Il:case jl:case _s:case Rl:case"dialin-ready":case"dialin-connected":case"dialin-error":case"dialin-stopped":case"dialin-warning":case"dialout-connected":case"dialout-answered":case"dialout-error":case"dialout-stopped":case"dialout-warning":this.emitDailyJSEvent(a);break;case"request-fullscreen":this.requestFullscreen();break;case"request-exit-fullscreen":this.exitFullscreen()}}},{key:"maybeEventRecordingStopped",value:function(a,u){var d="record";a&&(u.local||u[d]!==!1||a[d]===u[d]||this.emitDailyJSEvent({action:bs}))}},{key:"maybeEventRecordingStarted",value:function(a,u){var d="record";a&&(u.local||u[d]!==!0||a[d]===u[d]||this.emitDailyJSEvent({action:ys}))}},{key:"maybeEventTrackStopped",value:function(a,u,d,m){a&&(a.readyState!=="ended"&&u&&a.id===u.id||this.emitDailyJSEvent({action:ul,track:a,participant:d,type:m}))}},{key:"maybeEventTrackStarted",value:function(a,u,d,m){u&&(a&&a.readyState!=="ended"&&u.id===a.id||this.emitDailyJSEvent({action:ll,track:u,participant:d,type:m}))}},{key:"maybeParticipantTracksStopped",value:function(a,u){if(a)for(var d in a.tracks)this.maybeEventTrackStopped(a.tracks[d].track,u&&u.tracks[d]?u.tracks[d].track:null,u,d)}},{key:"maybeParticipantTracksStarted",value:function(a,u){if(u)for(var d in u.tracks)this.maybeEventTrackStarted(a&&a.tracks[d]?a.tracks[d].track:null,u.tracks[d].track,u,d)}},{key:"compareEqualForRMPUpdateEvent",value:function(a,u){var d,m;return a.state===u.state&&((d=a.settings)===null||d===void 0?void 0:d.volume)===((m=u.settings)===null||m===void 0?void 0:m.volume)}},{key:"emitDailyJSEvent",value:function(a){try{a.callClientId=this.callClientId,this.emit(a.action,a)}catch(u){console.log("could not emit",a,u)}}},{key:"compareEqualForParticipantUpdateEvent",value:function(a,u){return!!le(a,u)&&(!a.videoTrack||!u.videoTrack||a.videoTrack.id===u.videoTrack.id&&a.videoTrack.muted===u.videoTrack.muted&&a.videoTrack.enabled===u.videoTrack.enabled)&&(!a.audioTrack||!u.audioTrack||a.audioTrack.id===u.audioTrack.id&&a.audioTrack.muted===u.audioTrack.muted&&a.audioTrack.enabled===u.audioTrack.enabled)}},{key:"nativeUtils",value:function(){return V()?typeof DailyNativeUtils>"u"?(console.warn("in React Native, DailyNativeUtils is expected to be available"),null):DailyNativeUtils:null}},{key:"updateIsPreparingToJoin",value:function(a){this._updateCallState(this._callState,a)}},{key:"_updateCallState",value:function(a){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this._isPreparingToJoin;if(a!==this._callState||u!==this._isPreparingToJoin){var d=this._callState,m=this._isPreparingToJoin;this._callState=a,this._isPreparingToJoin=u;var p=this._callState===ct;this.updateShowAndroidOngoingMeetingNotification(p);var _=br(d,m),T=br(this._callState,this._isPreparingToJoin);_!==T&&(this.updateKeepDeviceAwake(T),this.updateDeviceAudioMode(T),this.updateNoOpRecordingEnsuringBackgroundContinuity(T))}}},{key:"resetMeetingDependentVars",value:function(){this._participants={},this._participantCounts=Vs,this._waitingParticipants={},this._activeSpeaker={},this._activeSpeakerMode=!1,this._didPreAuth=!1,this._accessState={access:Kr},this._finalSummaryOfPrevSession=this._meetingSessionSummary,this._meetingSessionSummary={},this._meetingSessionState=an(Js,this._callObjectMode),this._isScreenSharing=!1,this._receiveSettings={},this._inputSettings=void 0,this._sendSettings={},this._localAudioLevel=0,this._isLocalAudioLevelObserverRunning=!1,this._remoteParticipantsAudioLevel={},this._isRemoteParticipantsAudioLevelObserverRunning=!1,this._maxAppMessageSize=Yr,this._callMachineInitialized=!1,this._bundleLoadTime=void 0,this._preloadCache}},{key:"updateKeepDeviceAwake",value:function(a){V()&&this.nativeUtils().setKeepDeviceAwake(a,this.callClientId)}},{key:"updateDeviceAudioMode",value:function(a){if(V()&&!this.disableReactNativeAutoDeviceManagement("audio")){var u=a?this._nativeInCallAudioMode:"idle";this.nativeUtils().setAudioMode(u)}}},{key:"updateShowAndroidOngoingMeetingNotification",value:function(a){if(V()&&this.nativeUtils().setShowOngoingMeetingNotification){var u,d,m,p;if(this.properties.reactNativeConfig&&this.properties.reactNativeConfig.androidInCallNotification){var _=this.properties.reactNativeConfig.androidInCallNotification;u=_.title,d=_.subtitle,m=_.iconName,p=_.disableForCustomOverride}p&&(a=!1),this.nativeUtils().setShowOngoingMeetingNotification(a,u,d,m,this.callClientId)}}},{key:"updateNoOpRecordingEnsuringBackgroundContinuity",value:function(a){V()&&this.nativeUtils().enableNoOpRecordingEnsuringBackgroundContinuity&&this.nativeUtils().enableNoOpRecordingEnsuringBackgroundContinuity(a)}},{key:"toggleParticipantAudioBasedOnNativeAudioFocus",value:function(){var a,u;if(V()){var d=(a=this._callMachine())===null||a===void 0||(u=a.store)===null||u===void 0?void 0:u.getState();for(var m in d==null?void 0:d.streams){var p=d.streams[m];p&&p.pendingTrack&&p.pendingTrack.kind==="audio"&&(p.pendingTrack.enabled=this._hasNativeAudioFocus)}}}},{key:"disableReactNativeAutoDeviceManagement",value:function(a){return this.properties.reactNativeConfig&&this.properties.reactNativeConfig.disableAutoDeviceManagement&&this.properties.reactNativeConfig.disableAutoDeviceManagement[a]}},{key:"absoluteUrl",value:function(a){if(a!==void 0){var u=document.createElement("a");return u.href=a,u.href}}},{key:"sayHello",value:function(){var a="hello, world.";return console.log(a),a}},{key:"_logUseAfterDestroy",value:function(){var a=Object.values(st)[0];if(this.needsLoad())if(a&&!a.needsLoad()){var u={action:dr,level:"error",code:this.strictMode?9995:9997};a.sendMessageToCallMachine(u)}else this.strictMode||console.error("You are are attempting to use a call instance that was previously destroyed, which is unsupported. Please remove `strictMode: false` from your constructor properties to enable strict mode to track down and fix this unsupported usage.");else{var d={action:dr,level:"error",code:this.strictMode?9995:9997};this._messageChannel.sendMessageToCallMachine(d,null,this.callClientId,this._iframe)}}},{key:"_logDuplicateInstanceAttempt",value:function(){for(var a=0,u=Object.values(st);a<u.length;a++){var d=u[a];d._callMachineInitialized?(d.sendMessageToCallMachine({action:dr,level:"warn",code:this.allowMultipleCallInstances?9993:9992}),d._delayDuplicateInstanceLog=!1):d._delayDuplicateInstanceLog=!0}}},{key:"_maybeSendToSentry",value:function(a){var u,d,m,p,_,T;if(!((u=a.error)!==null&&u!==void 0&&u.type&&(![qc,$c,gs].includes(a.error.type)||a.error.type===gs&&a.error.msg.includes("deleted")))){var P=(d=this.properties)!==null&&d!==void 0&&d.url?new URL(this.properties.url):void 0,U="production";P&&P.host.includes(".staging.daily")&&(U="staging");var K,X,Oe,Be,Pe,Zt=[hc(),uc(),xc(),Pc(),Rc(),Bc(),fc(),Nc()].filter(function(Nr){return!["BrowserApiErrors","Breadcrumbs","GlobalHandlers"].includes(Nr.name)}),Rt=new yc({dsn:"https://f10f1c81e5d44a4098416c0867a8b740@o77906.ingest.sentry.io/168844",transport:kc,stackParser:Oc,integrations:Zt,environment:U}),ae=new Ke;if(ae.setClient(Rt),Rt.init(),this.session_id&&ae.setExtra("sessionId",this.session_id),this.properties){var Le=R({},this.properties);Le.userName=Le.userName?"[Filtered]":void 0,Le.userData=Le.userData?"[Filtered]":void 0,Le.token=Le.token?"[Filtered]":void 0,ae.setExtra("properties",Le)}if(P){var rt=P.searchParams.get("domain");if(!rt){var Nt=P.host.match(/(.*?)\./);rt=Nt&&Nt[1]||""}rt&&ae.setTag("domain",rt)}a.error&&(ae.setTag("fatalErrorType",a.error.type),ae.setExtra("errorDetails",a.error.details),!((K=a.error.details)===null||K===void 0)&&K.uri&&ae.setTag("serverAddress",a.error.details.uri),!((X=a.error.details)===null||X===void 0)&&X.workerGroup&&ae.setTag("workerGroup",a.error.details.workerGroup),!((Oe=a.error.details)===null||Oe===void 0)&&Oe.geoGroup&&ae.setTag("geoGroup",a.error.details.geoGroup),!((Be=a.error.details)===null||Be===void 0)&&Be.on&&ae.setTag("connectionAttempt",a.error.details.on),(Pe=a.error.details)!==null&&Pe!==void 0&&Pe.bundleUrl&&(ae.setTag("bundleUrl",a.error.details.bundleUrl),ae.setTag("bundleError",a.error.details.sourceError.type))),ae.setTags({callMode:this._callObjectMode?V()?"reactNative":(m=this.properties)!==null&&m!==void 0&&(p=m.dailyConfig)!==null&&p!==void 0&&(_=p.callMode)!==null&&_!==void 0&&_.includes("prebuilt")?this.properties.dailyConfig.callMode:"custom":"prebuilt-frame",version:se.version()});var Rr=((T=a.error)===null||T===void 0?void 0:T.msg)||a.errorMsg;ae.captureException(new Error(Rr))}}},{key:"_callMachine",value:function(){var a,u,d;return(a=window._daily)===null||a===void 0||(u=a.instances)===null||u===void 0||(d=u[this.callClientId])===null||d===void 0?void 0:d.callMachine}}],[{key:"supportedBrowser",value:function(){if(V())return{supported:!0,mobile:!0,name:"React Native",version:null,supportsScreenShare:!0,supportsSfu:!0,supportsVideoProcessing:!1,supportsAudioProcessing:!1};var a=Oo.getParser(me());return{supported:!!Ts(),mobile:a.getPlatformType()==="mobile",name:a.getBrowserName(),version:a.getBrowserVersion(),supportsFullscreen:!!Ms(),supportsScreenShare:!!$l(),supportsSfu:!!Ts(),supportsVideoProcessing:Pa(),supportsAudioProcessing:La()}}},{key:"version",value:function(){return"0.73.0"}},{key:"createCallObject",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return a.layout="none",new se(null,a)}},{key:"wrap",value:function(a){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(J(),!a||!a.contentWindow||typeof a.src!="string")throw new Error("DailyIframe::Wrap needs an iframe-like first argument");return u.layout||(u.customLayout?u.layout="custom-v1":u.layout="browser"),new se(a,u)}},{key:"createFrame",value:function(a,u){var d,m;J(),a&&u?(d=a,m=u):a&&a.append?(d=a,m={}):(d=document.body,m=a||{});var p=m.iframeStyle;p||(p=d===document.body?{position:"fixed",border:"1px solid black",backgroundColor:"white",width:"375px",height:"450px",right:"1em",bottom:"1em"}:{border:0,width:"100%",height:"100%"});var _=document.createElement("iframe");window.navigator&&window.navigator.userAgent.match(/Chrome\/61\./)?_.allow="microphone, camera":_.allow="microphone; camera; autoplay; display-capture; screen-wake-lock",_.style.visibility="hidden",d.appendChild(_),_.style.visibility=null,Object.keys(p).forEach(function(T){return _.style[T]=p[T]}),m.layout||(m.customLayout?m.layout="custom-v1":m.layout="browser");try{return new se(_,m)}catch(T){throw d.removeChild(_),T}}},{key:"createTransparentFrame",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};J();var u=document.createElement("iframe");return u.allow="microphone; camera; autoplay",u.style.cssText=`
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border: 0;
      pointer-events: none;
    `,document.body.appendChild(u),a.layout||(a.layout="custom-v1"),se.wrap(u,a)}},{key:"getCallInstance",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:void 0;return a?st[a]:Object.values(st)[0]}}]),se}();function wt(t,e){var r={};for(var n in t)if(t[n]instanceof MediaStreamTrack)r[n]=qt;else if(n==="dailyConfig"){if(t[n].modifyLocalSdpHook){var i=window._daily.instances[e].customCallbacks||{};i.modifyLocalSdpHook=t[n].modifyLocalSdpHook,window._daily.instances[e].customCallbacks=i,delete t[n].modifyLocalSdpHook}if(t[n].modifyRemoteSdpHook){var s=window._daily.instances[e].customCallbacks||{};s.modifyRemoteSdpHook=t[n].modifyRemoteSdpHook,window._daily.instances[e].customCallbacks=s,delete t[n].modifyRemoteSdpHook}r[n]=t[n]}else r[n]=t[n];return r}function Q(t){var e=arguments.length>2?arguments[2]:void 0;if(t!==ct){var r="".concat(arguments.length>1&&arguments[1]!==void 0?arguments[1]:"This daily-js method"," only supported after join.");throw e&&(r+=" ".concat(e)),console.error(r),new Error(r)}}function br(t,e){return[Cn,ct].includes(t)||e}function nn(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"This daily-js method",n=arguments.length>3?arguments[3]:void 0;if(br(t,e)){var i="".concat(r," not supported after joining a meeting.");throw n&&(i+=" ".concat(n)),console.error(i),new Error(i)}}function pr(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"This daily-js method",r=arguments.length>2?arguments[2]:void 0;if(!t){var n="".concat(e,arguments.length>3&&arguments[3]!==void 0&&arguments[3]?" requires preAuth() or startCamera() to initialize call state.":" requires preAuth(), startCamera(), or join() to initialize call state.");throw r&&(n+=" ".concat(r)),console.error(n),new Error(n)}}function sn(t){if(t){var e="A pre-call quality test is in progress. Please try ".concat(arguments.length>1&&arguments[1]!==void 0?arguments[1]:"This daily-js method"," again once testing has completed. Use stopTestCallQuality() to end it early.");throw console.error(e),new Error(e)}}function ve(t){if(!t){var e="".concat(arguments.length>1&&arguments[1]!==void 0?arguments[1]:"This daily-js method"," is only supported on custom callObject instances");throw console.error(e),new Error(e)}}function de(t){if(t){var e="".concat(arguments.length>1&&arguments[1]!==void 0?arguments[1]:"This daily-js method"," is only supported as part of Daily's Prebuilt");throw console.error(e),new Error(e)}}function J(){if(V())throw new Error("This daily-js method is not currently supported in React Native")}function Ut(){if(!V())throw new Error("This daily-js method is only supported in React Native")}function Ba(t){if(t===void 0)return!0;var e;if(typeof t=="string")e=t;else try{e=JSON.stringify(t),le(JSON.parse(e),t)||console.warn("The userData provided will be modified when serialized.")}catch(r){throw Error("userData must be serializable to JSON: ".concat(r))}if(e.length>4096)throw Error("userData is too large (".concat(e.length," characters). Maximum size suppported is ").concat(4096,"."));return!0}function Fa(t,e){for(var r=e.allowAllParticipantsKey,n=function(g){var y=["local"];return r||y.push("*"),g&&!y.includes(g)},i=function(g){return!!(g.layer===void 0||Number.isInteger(g.layer)&&g.layer>=0||g.layer==="inherit")},s=function(g){return!!g&&!(g.video&&!i(g.video))&&!(g.screenVideo&&!i(g.screenVideo))},o=0,l=Object.entries(t);o<l.length;o++){var c=pt(l[o],2),h=c[0],f=c[1];if(!n(h)||!s(f))return!1}return!0}function Ua(t){return G(t)==="object"&&!(t.video&&(G(t.video)!=="object"||!function(i){var s=["type","config"];return!i||G(i)!=="object"||!function(o){return typeof o!="string"?!1:Object.values(yr).includes(o)?!0:(console.error("inputSettings video processor type invalid"),!1)}(i.type)||i.config&&(G(i.config)!=="object"||!function(o,l){var c=Object.keys(l);if(c.length===0)return!0;var h="invalid object in inputSettings -> video -> processor -> config";switch(o){case yr.BGBLUR:return c.length>1||c[0]!=="strength"?(console.error(h),!1):!(typeof l.strength!="number"||l.strength<=0||l.strength>1||isNaN(l.strength))||(console.error("".concat(h,"; expected: {0 < strength <= 1}, got: ").concat(l.strength)),!1);case yr.BGIMAGE:return!(l.source!==void 0&&!function(f){if(f.source==="default")return f.type="default",!0;if(f.source instanceof ArrayBuffer)return!0;if(wr(f.source))return f.type="url",!!function(k){var v=new URL(k),b=v.pathname;if(v.protocol==="data:")try{var M=b.substring(b.indexOf(":")+1,b.indexOf(";")).split("/")[1];return Zr.includes(M)}catch(x){return console.error("failed to deduce blob content type",x),!1}var O=b.split(".").at(-1).toLowerCase().trim();return Zr.includes(O)}(f.source)||(console.error("invalid image type; supported types: [".concat(Zr.join(", "),"]")),!1);return g=f.source,y=Number(g),isNaN(y)||!Number.isInteger(y)||y<=0||y>10?(console.error("invalid image selection; must be an int, > 0, <= ".concat(10)),!1):(f.type="daily-preselect",!0);var g,y}(l));default:return!0}}(i.type,i.config))?!1:(Object.keys(i).filter(function(o){return!s.includes(o)}).forEach(function(o){console.warn("invalid key inputSettings -> video -> processor : ".concat(o)),delete i[o]}),!0)}(t.video.processor)))&&!(t.audio&&(G(t.audio)!=="object"||(r=t.audio.processor,n=["type"],!r||G(r)!=="object"||(Object.keys(r).filter(function(i){return!n.includes(i)}).forEach(function(i){console.warn("invalid key inputSettings -> audio -> processor : ".concat(i)),delete r[i]}),e=r.type,typeof e!="string"||!Object.values(Aa).includes(e)&&(console.error("inputSettings audio processor type invalid"),1)))));var e,r,n}function $a(t,e){var r,n=[];t.video&&!Pa((r=e==null?void 0:e.useLegacyVideoProcessor)!==null&&r!==void 0&&r)&&(delete t.video,n.push("video")),t.audio&&!La()&&(delete t.audio,n.push("audio")),n.length>0&&console.error("Ignoring settings for browser- or platform-unsupported input processor(s): ".concat(n.join(", ")))}function Ln(){var t=Object.values(yr).join(" | "),e=Object.values(Aa).join(" | ");return"inputSettings must be of the form: { video?: { processor: { type: [ ".concat(t," ], config?: {} } }, audio?: { processor: {type: [ ").concat(e," ] } } }")}function qa(t){var e=t.allowAllParticipantsKey;return"receiveSettings must be of the form { [<remote participant id> | ".concat(Uc).concat(e?' | "'.concat("*",'"'):"","]: ")+'{ [video: [{ layer: [<non-negative integer> | "inherit"] } | "inherit"]], [screenVideo: [{ layer: [<non-negative integer> | "inherit"] } | "inherit"]] }}}'}function Ja(){return"customIntegrations should be an object of type ".concat(JSON.stringify(Pn),".")}function Va(t){if(t&&G(t)!=="object"||Array.isArray(t))return console.error("customTrayButtons should be an Object of the type ".concat(JSON.stringify(Ar),".")),!1;if(t)for(var e=0,r=Object.entries(t);e<r.length;e++)for(var n=pt(r[e],1)[0],i=0,s=Object.entries(t[n]);i<s.length;i++){var o=pt(s[i],2),l=o[0],c=o[1],h=Ar.id[l];if(!h)return console.error("customTrayButton does not support key ".concat(l)),!1;switch(l){case"iconPath":case"iconPathDarkMode":if(!wr(c))return console.error("customTrayButton ".concat(l," should be a url.")),!1;break;case"visualState":if(!["default","sidebar-open","active"].includes(c))return console.error("customTrayButton ".concat(l," should be ").concat(h,". Got: ").concat(c)),!1;break;default:if(G(c)!==h)return console.error("customTrayButton ".concat(l," should be a ").concat(h,".")),!1}}return!0}function za(t){if(!t||t&&G(t)!=="object"||Array.isArray(t))return console.error(Ja()),!1;for(var e=function(g){return"".concat(g," should be ").concat(Pn.id[g])},r=function(g,y){return console.error("customIntegration ".concat(g,": ").concat(y))},n=0,i=Object.entries(t);n<i.length;n++){var s=pt(i[n],1)[0];if(!("label"in t[s]))return r(s,"label is required"),!1;if(!("location"in t[s]))return r(s,"location is required"),!1;if(!("src"in t[s])&&!("srcdoc"in t[s]))return r(s,"src or srcdoc is required"),!1;for(var o=0,l=Object.entries(t[s]);o<l.length;o++){var c=pt(l[o],2),h=c[0],f=c[1];switch(h){case"allow":case"csp":case"name":case"referrerPolicy":case"sandbox":if(typeof f!="string")return r(s,e(h)),!1;break;case"iconURL":if(!wr(f))return r(s,"".concat(h," should be a url")),!1;break;case"src":if("srcdoc"in t[s])return r(s,"cannot have both src and srcdoc"),!1;if(!wr(f))return r(s,'src "'.concat(f,'" is not a valid URL')),!1;break;case"srcdoc":if("src"in t[s])return r(s,"cannot have both src and srcdoc"),!1;if(typeof f!="string")return r(s,e(h)),!1;break;case"location":if(!["main","sidebar"].includes(f))return r(s,e(h)),!1;break;case"controlledBy":if(f!=="*"&&f!=="owners"&&(!Array.isArray(f)||f.some(function(g){return typeof g!="string"})))return r(s,e(h)),!1;break;case"shared":if((!Array.isArray(f)||f.some(function(g){return typeof g!="string"}))&&f!=="owners"&&typeof f!="boolean")return r(s,e(h)),!1;break;default:if(!Pn.id[h])return console.error("customIntegration does not support key ".concat(h)),!1}}}return!0}function Wa(t,e){if(e===void 0)return!1;switch(G(e)){case"string":return G(t)===e;case"object":if(G(t)!=="object")return!1;for(var r in t)if(!Wa(t[r],e[r]))return!1;return!0;default:return!1}}function Gs(t,e){var r=t.sessionId,n=t.toEndPoint,i=t.useSipRefer;if(!r||!n)throw new Error("".concat(e,"() requires a sessionId and toEndPoint"));if(typeof r!="string"||typeof n!="string")throw new Error("Invalid paramater: sessionId and toEndPoint must be of type string");if(i&&!n.startsWith("sip:"))throw new Error('"toEndPoint" must be a "sip" address');if(!n.startsWith("sip:")&&!n.startsWith("+"))throw new Error("toEndPoint: ".concat(n,' must starts with either "sip:" or "+"'))}function Hs(t){if(G(t)!=="object")throw new Error('RemoteMediaPlayerSettings: must be "object" type');if(t.state&&!Object.values(En).includes(t.state))throw new Error("Invalid value for RemoteMediaPlayerSettings.state, valid values are: "+JSON.stringify(En));if(t.volume){if(typeof t.volume!="number")throw new Error('RemoteMediaPlayerSettings.volume: must be "number" type');if(t.volume<0||t.volume>2)throw new Error("RemoteMediaPlayerSettings.volume: must be between 0.0 - 2.0")}}function Qs(t,e,r){return!(typeof t!="number"||t<e||t>r)}function an(t,e){return t&&!e&&delete t.data,t}function Ga(t,e,r,n){Object.defineProperty(t,e,{get:r,set:n,enumerable:!0,configurable:!0})}var Ha={};Ga(Ha,"DailyRTVIMessageType",()=>Ht);Ga(Ha,"DailyTransport",()=>He);class ye{static floatTo16BitPCM(e){const r=new ArrayBuffer(e.length*2),n=new DataView(r);let i=0;for(let s=0;s<e.length;s++,i+=2){let o=Math.max(-1,Math.min(1,e[s]));n.setInt16(i,o<0?o*32768:o*32767,!0)}return r}static mergeBuffers(e,r){const n=new Uint8Array(e.byteLength+r.byteLength);return n.set(new Uint8Array(e),0),n.set(new Uint8Array(r),e.byteLength),n.buffer}_packData(e,r){return[new Uint8Array([r,r>>8]),new Uint8Array([r,r>>8,r>>16,r>>24])][e]}pack(e,r){if(r!=null&&r.bitsPerSample)if(r!=null&&r.channels){if(!(r!=null&&r.data))throw new Error('Missing "data"')}else throw new Error('Missing "channels"');else throw new Error('Missing "bitsPerSample"');const{bitsPerSample:n,channels:i,data:s}=r,o=["RIFF",this._packData(1,52),"WAVE","fmt ",this._packData(1,16),this._packData(0,1),this._packData(0,i.length),this._packData(1,e),this._packData(1,e*i.length*n/8),this._packData(0,i.length*n/8),this._packData(0,n),"data",this._packData(1,i[0].length*i.length*n/8),s],l=new Blob(o,{type:"audio/mpeg"}),c=URL.createObjectURL(l);return{blob:l,url:c,channelCount:i.length,sampleRate:e,duration:s.byteLength/(i.length*e*2)}}}globalThis.WavPacker=ye;const Ks=[4186.01,4434.92,4698.63,4978.03,5274.04,5587.65,5919.91,6271.93,6644.88,7040,7458.62,7902.13],mu=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],Ge=[],Qn=[];for(let t=1;t<=8;t++)for(let e=0;e<Ks.length;e++){const r=Ks[e];Ge.push(r/Math.pow(2,8-t)),Qn.push(mu[e]+t)}const Or=[32,2e3],Ys=Ge.filter((t,e)=>Ge[e]>Or[0]&&Ge[e]<Or[1]),gu=Qn.filter((t,e)=>Ge[e]>Or[0]&&Ge[e]<Or[1]);class xt{static getFrequencies(e,r,n,i="frequency",s=-100,o=-30){n||(n=new Float32Array(e.frequencyBinCount),e.getFloatFrequencyData(n));const l=r/2,c=1/n.length*l;let h,f,g;if(i==="music"||i==="voice"){const v=i==="voice"?Ys:Ge,b=Array(v.length).fill(s);for(let M=0;M<n.length;M++){const O=M*c,x=n[M];for(let D=v.length-1;D>=0;D--)if(O>v[D]){b[D]=Math.max(b[D],x);break}}h=b,f=i==="voice"?Ys:Ge,g=i==="voice"?gu:Qn}else h=Array.from(n),f=h.map((v,b)=>c*b),g=f.map(v=>`${v.toFixed(2)} Hz`);const y=h.map(v=>Math.max(0,Math.min((v-s)/(o-s),1)));return{values:new Float32Array(y),frequencies:f,labels:g}}constructor(e,r=null){if(this.fftResults=[],r){const{length:n,sampleRate:i}=r,s=new OfflineAudioContext({length:n,sampleRate:i}),o=s.createBufferSource();o.buffer=r;const l=s.createAnalyser();l.fftSize=8192,l.smoothingTimeConstant=.1,o.connect(l);const c=1/60,h=n/i,f=g=>{const y=c*g;y<h&&s.suspend(y).then(()=>{const k=new Float32Array(l.frequencyBinCount);l.getFloatFrequencyData(k),this.fftResults.push(k),f(g+1)}),g===1?s.startRendering():s.resume()};o.start(0),f(1),this.audio=e,this.context=s,this.analyser=l,this.sampleRate=i,this.audioBuffer=r}else{const n=new AudioContext,i=n.createMediaElementSource(e),s=n.createAnalyser();s.fftSize=8192,s.smoothingTimeConstant=.1,i.connect(s),s.connect(n.destination),this.audio=e,this.context=n,this.analyser=s,this.sampleRate=this.context.sampleRate,this.audioBuffer=null}}getFrequencies(e="frequency",r=-100,n=-30){let i=null;if(this.audioBuffer&&this.fftResults.length){const s=this.audio.currentTime/this.audio.duration,o=Math.min(s*this.fftResults.length|0,this.fftResults.length-1);i=this.fftResults[o]}return xt.getFrequencies(this.analyser,this.sampleRate,i,e,r,n)}async resumeIfSuspended(){return this.context.state==="suspended"&&await this.context.resume(),!0}}globalThis.AudioAnalysis=xt;const vu=`
class StreamProcessor extends AudioWorkletProcessor {
  constructor() {
    super();
    this.hasStarted = false;
    this.hasInterrupted = false;
    this.outputBuffers = [];
    this.bufferLength = 128;
    this.write = { buffer: new Float32Array(this.bufferLength), trackId: null };
    this.writeOffset = 0;
    this.trackSampleOffsets = {};
    this.port.onmessage = (event) => {
      if (event.data) {
        const payload = event.data;
        if (payload.event === 'write') {
          const int16Array = payload.buffer;
          const float32Array = new Float32Array(int16Array.length);
          for (let i = 0; i < int16Array.length; i++) {
            float32Array[i] = int16Array[i] / 0x8000; // Convert Int16 to Float32
          }
          this.writeData(float32Array, payload.trackId);
        } else if (
          payload.event === 'offset' ||
          payload.event === 'interrupt'
        ) {
          const requestId = payload.requestId;
          const trackId = this.write.trackId;
          const offset = this.trackSampleOffsets[trackId] || 0;
          this.port.postMessage({
            event: 'offset',
            requestId,
            trackId,
            offset,
          });
          if (payload.event === 'interrupt') {
            this.hasInterrupted = true;
          }
        } else {
          throw new Error(\`Unhandled event "\${payload.event}"\`);
        }
      }
    };
  }

  writeData(float32Array, trackId = null) {
    let { buffer } = this.write;
    let offset = this.writeOffset;
    for (let i = 0; i < float32Array.length; i++) {
      buffer[offset++] = float32Array[i];
      if (offset >= buffer.length) {
        this.outputBuffers.push(this.write);
        this.write = { buffer: new Float32Array(this.bufferLength), trackId };
        buffer = this.write.buffer;
        offset = 0;
      }
    }
    this.writeOffset = offset;
    return true;
  }

  process(inputs, outputs, parameters) {
    const output = outputs[0];
    const outputChannelData = output[0];
    const outputBuffers = this.outputBuffers;
    if (this.hasInterrupted) {
      this.port.postMessage({ event: 'stop' });
      return false;
    } else if (outputBuffers.length) {
      this.hasStarted = true;
      const { buffer, trackId } = outputBuffers.shift();
      for (let i = 0; i < outputChannelData.length; i++) {
        outputChannelData[i] = buffer[i] || 0;
      }
      if (trackId) {
        this.trackSampleOffsets[trackId] =
          this.trackSampleOffsets[trackId] || 0;
        this.trackSampleOffsets[trackId] += buffer.length;
      }
      return true;
    } else if (this.hasStarted) {
      this.port.postMessage({ event: 'stop' });
      return false;
    } else {
      return true;
    }
  }
}

registerProcessor('stream_processor', StreamProcessor);
`,yu=new Blob([vu],{type:"application/javascript"}),bu=URL.createObjectURL(yu),_u=bu;class wu{constructor({sampleRate:e=44100}={}){this.scriptSrc=_u,this.sampleRate=e,this.context=null,this.stream=null,this.analyser=null,this.trackSampleOffsets={},this.interruptedTrackIds={}}async connect(){this.context=new AudioContext({sampleRate:this.sampleRate}),this._speakerID&&this.context.setSinkId(this._speakerID),this.context.state==="suspended"&&await this.context.resume();try{await this.context.audioWorklet.addModule(this.scriptSrc)}catch(r){throw console.error(r),new Error(`Could not add audioWorklet module: ${this.scriptSrc}`)}const e=this.context.createAnalyser();return e.fftSize=8192,e.smoothingTimeConstant=.1,this.analyser=e,!0}getFrequencies(e="frequency",r=-100,n=-30){if(!this.analyser)throw new Error("Not connected, please call .connect() first");return xt.getFrequencies(this.analyser,this.sampleRate,null,e,r,n)}async updateSpeaker(e){const r=this._speakerID;if(this._speakerID=e,this.context)try{e==="default"?await this.context.setSinkId():await this.context.setSinkId(e)}catch(n){console.error(`Could not set sinkId to ${e}: ${n}`),this._speakerID=r}}_start(){const e=new AudioWorkletNode(this.context,"stream_processor");return e.connect(this.context.destination),e.port.onmessage=r=>{const{event:n}=r.data;if(n==="stop")e.disconnect(),this.stream=null;else if(n==="offset"){const{requestId:i,trackId:s,offset:o}=r.data,l=o/this.sampleRate;this.trackSampleOffsets[i]={trackId:s,offset:o,currentTime:l}}},this.analyser.disconnect(),e.connect(this.analyser),this.stream=e,!0}add16BitPCM(e,r="default"){if(typeof r!="string")throw new Error("trackId must be a string");if(this.interruptedTrackIds[r])return;this.stream||this._start();let n;if(e instanceof Int16Array)n=e;else if(e instanceof ArrayBuffer)n=new Int16Array(e);else throw new Error("argument must be Int16Array or ArrayBuffer");return this.stream.port.postMessage({event:"write",buffer:n,trackId:r}),n}async getTrackSampleOffset(e=!1){if(!this.stream)return null;const r=crypto.randomUUID();this.stream.port.postMessage({event:e?"interrupt":"offset",requestId:r});let n;for(;!n;)n=this.trackSampleOffsets[r],await new Promise(s=>setTimeout(()=>s(),1));const{trackId:i}=n;return e&&i&&(this.interruptedTrackIds[i]=!0),n}async interrupt(){return this.getTrackSampleOffset(!0)}}globalThis.WavStreamPlayer=wu;const Su=`
class AudioProcessor extends AudioWorkletProcessor {

  constructor() {
    super();
    this.port.onmessage = this.receive.bind(this);
    this.initialize();
  }

  initialize() {
    this.foundAudio = false;
    this.recording = false;
    this.chunks = [];
  }

  /**
   * Concatenates sampled chunks into channels
   * Format is chunk[Left[], Right[]]
   */
  readChannelData(chunks, channel = -1, maxChannels = 9) {
    let channelLimit;
    if (channel !== -1) {
      if (chunks[0] && chunks[0].length - 1 < channel) {
        throw new Error(
          \`Channel \${channel} out of range: max \${chunks[0].length}\`
        );
      }
      channelLimit = channel + 1;
    } else {
      channel = 0;
      channelLimit = Math.min(chunks[0] ? chunks[0].length : 1, maxChannels);
    }
    const channels = [];
    for (let n = channel; n < channelLimit; n++) {
      const length = chunks.reduce((sum, chunk) => {
        return sum + chunk[n].length;
      }, 0);
      const buffers = chunks.map((chunk) => chunk[n]);
      const result = new Float32Array(length);
      let offset = 0;
      for (let i = 0; i < buffers.length; i++) {
        result.set(buffers[i], offset);
        offset += buffers[i].length;
      }
      channels[n] = result;
    }
    return channels;
  }

  /**
   * Combines parallel audio data into correct format,
   * channels[Left[], Right[]] to float32Array[LRLRLRLR...]
   */
  formatAudioData(channels) {
    if (channels.length === 1) {
      // Simple case is only one channel
      const float32Array = channels[0].slice();
      const meanValues = channels[0].slice();
      return { float32Array, meanValues };
    } else {
      const float32Array = new Float32Array(
        channels[0].length * channels.length
      );
      const meanValues = new Float32Array(channels[0].length);
      for (let i = 0; i < channels[0].length; i++) {
        const offset = i * channels.length;
        let meanValue = 0;
        for (let n = 0; n < channels.length; n++) {
          float32Array[offset + n] = channels[n][i];
          meanValue += channels[n][i];
        }
        meanValues[i] = meanValue / channels.length;
      }
      return { float32Array, meanValues };
    }
  }

  /**
   * Converts 32-bit float data to 16-bit integers
   */
  floatTo16BitPCM(float32Array) {
    const buffer = new ArrayBuffer(float32Array.length * 2);
    const view = new DataView(buffer);
    let offset = 0;
    for (let i = 0; i < float32Array.length; i++, offset += 2) {
      let s = Math.max(-1, Math.min(1, float32Array[i]));
      view.setInt16(offset, s < 0 ? s * 0x8000 : s * 0x7fff, true);
    }
    return buffer;
  }

  /**
   * Retrieves the most recent amplitude values from the audio stream
   * @param {number} channel
   */
  getValues(channel = -1) {
    const channels = this.readChannelData(this.chunks, channel);
    const { meanValues } = this.formatAudioData(channels);
    return { meanValues, channels };
  }

  /**
   * Exports chunks as an audio/wav file
   */
  export() {
    const channels = this.readChannelData(this.chunks);
    const { float32Array, meanValues } = this.formatAudioData(channels);
    const audioData = this.floatTo16BitPCM(float32Array);
    return {
      meanValues: meanValues,
      audio: {
        bitsPerSample: 16,
        channels: channels,
        data: audioData,
      },
    };
  }

  receive(e) {
    const { event, id } = e.data;
    let receiptData = {};
    switch (event) {
      case 'start':
        this.recording = true;
        break;
      case 'stop':
        this.recording = false;
        break;
      case 'clear':
        this.initialize();
        break;
      case 'export':
        receiptData = this.export();
        break;
      case 'read':
        receiptData = this.getValues();
        break;
      default:
        break;
    }
    // Always send back receipt
    this.port.postMessage({ event: 'receipt', id, data: receiptData });
  }

  sendChunk(chunk) {
    const channels = this.readChannelData([chunk]);
    const { float32Array, meanValues } = this.formatAudioData(channels);
    const rawAudioData = this.floatTo16BitPCM(float32Array);
    const monoAudioData = this.floatTo16BitPCM(meanValues);
    this.port.postMessage({
      event: 'chunk',
      data: {
        mono: monoAudioData,
        raw: rawAudioData,
      },
    });
  }

  process(inputList, outputList, parameters) {
    // Copy input to output (e.g. speakers)
    // Note that this creates choppy sounds with Mac products
    const sourceLimit = Math.min(inputList.length, outputList.length);
    for (let inputNum = 0; inputNum < sourceLimit; inputNum++) {
      const input = inputList[inputNum];
      const output = outputList[inputNum];
      const channelCount = Math.min(input.length, output.length);
      for (let channelNum = 0; channelNum < channelCount; channelNum++) {
        input[channelNum].forEach((sample, i) => {
          output[channelNum][i] = sample;
        });
      }
    }
    const inputs = inputList[0];
    // There's latency at the beginning of a stream before recording starts
    // Make sure we actually receive audio data before we start storing chunks
    let sliceIndex = 0;
    if (!this.foundAudio) {
      for (const channel of inputs) {
        sliceIndex = 0; // reset for each channel
        if (this.foundAudio) {
          break;
        }
        if (channel) {
          for (const value of channel) {
            if (value !== 0) {
              // find only one non-zero entry in any channel
              this.foundAudio = true;
              break;
            } else {
              sliceIndex++;
            }
          }
        }
      }
    }
    if (inputs && inputs[0] && this.foundAudio && this.recording) {
      // We need to copy the TypedArray, because the \`process\`
      // internals will reuse the same buffer to hold each input
      const chunk = inputs.map((input) => input.slice(sliceIndex));
      this.chunks.push(chunk);
      this.sendChunk(chunk);
    }
    return true;
  }
}

registerProcessor('audio_processor', AudioProcessor);
`,ku=new Blob([Su],{type:"application/javascript"}),Cu=URL.createObjectURL(ku),Qa=Cu;class Eu{constructor({sampleRate:e=44100,outputToSpeakers:r=!1,debug:n=!1}={}){this.scriptSrc=Qa,this.sampleRate=e,this.outputToSpeakers=r,this.debug=!!n,this._deviceChangeCallback=null,this._devices=[],this.deviceSelection=null,this.stream=null,this.processor=null,this.source=null,this.node=null,this.recording=!1,this._lastEventId=0,this.eventReceipts={},this.eventTimeout=5e3,this._chunkProcessor=()=>{},this._chunkProcessorSize=void 0,this._chunkProcessorBuffer={raw:new ArrayBuffer(0),mono:new ArrayBuffer(0)}}static async decode(e,r=44100,n=-1){const i=new AudioContext({sampleRate:r});let s,o;if(e instanceof Blob){if(n!==-1)throw new Error('Can not specify "fromSampleRate" when reading from Blob');o=e,s=await o.arrayBuffer()}else if(e instanceof ArrayBuffer){if(n!==-1)throw new Error('Can not specify "fromSampleRate" when reading from ArrayBuffer');s=e,o=new Blob([s],{type:"audio/wav"})}else{let f,g;if(e instanceof Int16Array){g=e,f=new Float32Array(e.length);for(let b=0;b<e.length;b++)f[b]=e[b]/32768}else if(e instanceof Float32Array)f=e;else if(e instanceof Array)f=new Float32Array(e);else throw new Error('"audioData" must be one of: Blob, Float32Arrray, Int16Array, ArrayBuffer, Array<number>');if(n===-1)throw new Error('Must specify "fromSampleRate" when reading from Float32Array, In16Array or Array');if(n<3e3)throw new Error('Minimum "fromSampleRate" is 3000 (3kHz)');g||(g=ye.floatTo16BitPCM(f));const y={bitsPerSample:16,channels:[f],data:g};o=new ye().pack(n,y).blob,s=await o.arrayBuffer()}const l=await i.decodeAudioData(s),c=l.getChannelData(0),h=URL.createObjectURL(o);return{blob:o,url:h,values:c,audioBuffer:l}}log(){return this.debug&&this.log(...arguments),!0}getSampleRate(){return this.sampleRate}getStatus(){return this.processor?this.recording?"recording":"paused":"ended"}async _event(e,r={},n=null){if(n=n||this.processor,!n)throw new Error("Can not send events without recording first");const i={event:e,id:this._lastEventId++,data:r};n.port.postMessage(i);const s=new Date().valueOf();for(;!this.eventReceipts[i.id];){if(new Date().valueOf()-s>this.eventTimeout)throw new Error(`Timeout waiting for "${e}" event`);await new Promise(l=>setTimeout(()=>l(!0),1))}const o=this.eventReceipts[i.id];return delete this.eventReceipts[i.id],o}listenForDeviceChange(e){if(e===null&&this._deviceChangeCallback)navigator.mediaDevices.removeEventListener("devicechange",this._deviceChangeCallback),this._deviceChangeCallback=null;else if(e!==null){let r=0,n=[];const i=o=>o.map(l=>l.deviceId).sort().join(","),s=async()=>{let o=++r;const l=await this.listDevices();o===r&&i(n)!==i(l)&&(n=l,e(l.slice()))};navigator.mediaDevices.addEventListener("devicechange",s),s(),this._deviceChangeCallback=s}return!0}async requestPermission(){const e=await navigator.permissions.query({name:"microphone"});if(e.state==="denied")window.alert("You must grant microphone access to use this feature.");else if(e.state==="prompt")try{(await navigator.mediaDevices.getUserMedia({audio:!0})).getTracks().forEach(i=>i.stop())}catch{window.alert("You must grant microphone access to use this feature.")}return!0}async listDevices(){if(!navigator.mediaDevices||!("enumerateDevices"in navigator.mediaDevices))throw new Error("Could not request user devices");return await this.requestPermission(),(await navigator.mediaDevices.enumerateDevices()).filter(n=>n.kind==="audioinput")}async begin(e){var l;if(this.processor)throw new Error("Already connected: please call .end() to start a new session");if(!navigator.mediaDevices||!("getUserMedia"in navigator.mediaDevices))throw new Error("Could not request user media");e=e??((l=this.deviceSelection)==null?void 0:l.deviceId);try{const c={audio:!0};e&&(c.audio={deviceId:{exact:e}}),this.stream=await navigator.mediaDevices.getUserMedia(c)}catch{throw new Error("Could not start media stream")}this.listDevices().then(c=>{e=this.stream.getAudioTracks()[0].getSettings().deviceId,console.log("find current device",c,e,this.stream.getAudioTracks()[0].getSettings()),this.deviceSelection=c.find(h=>h.deviceId===e),console.log("current device",this.deviceSelection)});const r=new AudioContext({sampleRate:this.sampleRate}),n=r.createMediaStreamSource(this.stream);try{await r.audioWorklet.addModule(this.scriptSrc)}catch(c){throw console.error(c),new Error(`Could not add audioWorklet module: ${this.scriptSrc}`)}const i=new AudioWorkletNode(r,"audio_processor");i.port.onmessage=c=>{const{event:h,id:f,data:g}=c.data;if(h==="receipt")this.eventReceipts[f]=g;else if(h==="chunk")if(this._chunkProcessorSize){const y=this._chunkProcessorBuffer;this._chunkProcessorBuffer={raw:ye.mergeBuffers(y.raw,g.raw),mono:ye.mergeBuffers(y.mono,g.mono)},this._chunkProcessorBuffer.mono.byteLength>=this._chunkProcessorSize&&(this._chunkProcessor(this._chunkProcessorBuffer),this._chunkProcessorBuffer={raw:new ArrayBuffer(0),mono:new ArrayBuffer(0)})}else this._chunkProcessor(g)};const s=n.connect(i),o=r.createAnalyser();return o.fftSize=8192,o.smoothingTimeConstant=.1,s.connect(o),this.outputToSpeakers&&(console.warn(`Warning: Output to speakers may affect sound quality,
especially due to system audio feedback preventative measures.
use only for debugging`),o.connect(r.destination)),this.source=n,this.node=s,this.analyser=o,this.processor=i,console.log("begin completed"),!0}getFrequencies(e="frequency",r=-100,n=-30){if(!this.processor)throw new Error("Session ended: please call .begin() first");return xt.getFrequencies(this.analyser,this.sampleRate,null,e,r,n)}async pause(){if(this.processor){if(!this.recording)throw new Error("Already paused: please call .record() first")}else throw new Error("Session ended: please call .begin() first");return this._chunkProcessorBuffer.raw.byteLength&&this._chunkProcessor(this._chunkProcessorBuffer),this.log("Pausing ..."),await this._event("stop"),this.recording=!1,!0}async record(e=()=>{},r=8192){if(this.processor){if(this.recording)throw new Error("Already recording: please call .pause() first");if(typeof e!="function")throw new Error("chunkProcessor must be a function")}else throw new Error("Session ended: please call .begin() first");return this._chunkProcessor=e,this._chunkProcessorSize=r,this._chunkProcessorBuffer={raw:new ArrayBuffer(0),mono:new ArrayBuffer(0)},this.log("Recording ..."),await this._event("start"),this.recording=!0,!0}async clear(){if(!this.processor)throw new Error("Session ended: please call .begin() first");return await this._event("clear"),!0}async read(){if(!this.processor)throw new Error("Session ended: please call .begin() first");return this.log("Reading ..."),await this._event("read")}async save(e=!1){if(!this.processor)throw new Error("Session ended: please call .begin() first");if(!e&&this.recording)throw new Error("Currently recording: please call .pause() first, or call .save(true) to force");this.log("Exporting ...");const r=await this._event("export");return new ye().pack(this.sampleRate,r.audio)}async end(){if(!this.processor)throw new Error("Session ended: please call .begin() first");const e=this.processor;this.log("Stopping ..."),await this._event("stop"),this.recording=!1,this.stream.getTracks().forEach(o=>o.stop()),this.log("Exporting ...");const n=await this._event("export",{},e);return this.processor.disconnect(),this.source.disconnect(),this.node.disconnect(),this.analyser.disconnect(),this.stream=null,this.processor=null,this.source=null,this.node=null,new ye().pack(this.sampleRate,n.audio)}async quit(){return this.listenForDeviceChange(null),this.deviceSelection=null,this.processor&&await this.end(),!0}}globalThis.WavRecorder=Eu;class Mu{constructor({sampleRate:e=44100,outputToSpeakers:r=!1,debug:n=!1}={}){this.scriptSrc=Qa,this.sampleRate=e,this.outputToSpeakers=r,this.debug=!!n,this.stream=null,this.processor=null,this.source=null,this.node=null,this.recording=!1,this._lastEventId=0,this.eventReceipts={},this.eventTimeout=5e3,this._chunkProcessor=()=>{},this._chunkProcessorSize=void 0,this._chunkProcessorBuffer={raw:new ArrayBuffer(0),mono:new ArrayBuffer(0)}}log(){return this.debug&&this.log(...arguments),!0}getSampleRate(){return this.sampleRate}getStatus(){return this.processor?this.recording?"recording":"paused":"ended"}async _event(e,r={},n=null){if(n=n||this.processor,!n)throw new Error("Can not send events without recording first");const i={event:e,id:this._lastEventId++,data:r};n.port.postMessage(i);const s=new Date().valueOf();for(;!this.eventReceipts[i.id];){if(new Date().valueOf()-s>this.eventTimeout)throw new Error(`Timeout waiting for "${e}" event`);await new Promise(l=>setTimeout(()=>l(!0),1))}const o=this.eventReceipts[i.id];return delete this.eventReceipts[i.id],o}async begin(e){if(this.processor)throw new Error("Already connected: please call .end() to start a new session");if(!e||e.kind!=="audio")throw new Error("No audio track provided");this.stream=new MediaStream([e]);const r=new AudioContext({sampleRate:this.sampleRate}),n=r.createMediaStreamSource(this.stream);try{await r.audioWorklet.addModule(this.scriptSrc)}catch(l){throw console.error(l),new Error(`Could not add audioWorklet module: ${this.scriptSrc}`)}const i=new AudioWorkletNode(r,"audio_processor");i.port.onmessage=l=>{const{event:c,id:h,data:f}=l.data;if(c==="receipt")this.eventReceipts[h]=f;else if(c==="chunk")if(this._chunkProcessorSize){const g=this._chunkProcessorBuffer;this._chunkProcessorBuffer={raw:ye.mergeBuffers(g.raw,f.raw),mono:ye.mergeBuffers(g.mono,f.mono)},this._chunkProcessorBuffer.mono.byteLength>=this._chunkProcessorSize&&(this._chunkProcessor(this._chunkProcessorBuffer),this._chunkProcessorBuffer={raw:new ArrayBuffer(0),mono:new ArrayBuffer(0)})}else this._chunkProcessor(f)};const s=n.connect(i),o=r.createAnalyser();return o.fftSize=8192,o.smoothingTimeConstant=.1,s.connect(o),this.outputToSpeakers&&(console.warn(`Warning: Output to speakers may affect sound quality,
especially due to system audio feedback preventative measures.
use only for debugging`),o.connect(r.destination)),this.source=n,this.node=s,this.analyser=o,this.processor=i,!0}getFrequencies(e="frequency",r=-100,n=-30){if(!this.processor)throw new Error("Session ended: please call .begin() first");return xt.getFrequencies(this.analyser,this.sampleRate,null,e,r,n)}async pause(){if(this.processor){if(!this.recording)throw new Error("Already paused: please call .record() first")}else throw new Error("Session ended: please call .begin() first");return this._chunkProcessorBuffer.raw.byteLength&&this._chunkProcessor(this._chunkProcessorBuffer),this.log("Pausing ..."),await this._event("stop"),this.recording=!1,!0}async record(e=()=>{},r=8192){if(this.processor){if(this.recording)throw new Error("Already recording: HELLO please call .pause() first");if(typeof e!="function")throw new Error("chunkProcessor must be a function")}else throw new Error("Session ended: please call .begin() first");return this._chunkProcessor=e,this._chunkProcessorSize=r,this._chunkProcessorBuffer={raw:new ArrayBuffer(0),mono:new ArrayBuffer(0)},this.log("Recording ..."),await this._event("start"),this.recording=!0,!0}async clear(){if(!this.processor)throw new Error("Session ended: please call .begin() first");return await this._event("clear"),!0}async read(){if(!this.processor)throw new Error("Session ended: please call .begin() first");return this.log("Reading ..."),await this._event("read")}async save(e=!1){if(!this.processor)throw new Error("Session ended: please call .begin() first");if(!e&&this.recording)throw new Error("Currently recording: please call .pause() first, or call .save(true) to force");this.log("Exporting ...");const r=await this._event("export");return new ye().pack(this.sampleRate,r.audio)}async end(){if(!this.processor)throw new Error("Session ended: please call .begin() first");const e=this.processor;this.log("Stopping ..."),await this._event("stop"),this.recording=!1,this.log("Exporting ...");const r=await this._event("export",{},e);return this.processor.disconnect(),this.source.disconnect(),this.node.disconnect(),this.analyser.disconnect(),this.stream=null,this.processor=null,this.source=null,this.node=null,new ye().pack(this.sampleRate,r.audio)}async quit(){return this.listenForDeviceChange(null),this.processor&&await this.end(),!0}}globalThis.WavRecorder=WavRecorder;var Ht;(function(t){t.AUDIO_BUFFERING_STARTED="audio-buffering-started",t.AUDIO_BUFFERING_STOPPED="audio-buffering-stopped"})(Ht||(Ht={}));class Tu{constructor(e){this._daily=e,this._proxy=new Proxy(this._daily,{get:(r,n,i)=>{if(typeof r[n]=="function"){let s;switch(String(n)){case"preAuth":s="Calls to preAuth() are disabled. Please use Transport.preAuth()";break;case"startCamera":s="Calls to startCamera() are disabled. Please use RTVIClient.initDevices() or Transport.initDevices()";break;case"join":s="Calls to join() are disabled. Please use RTVIClient.connect()";break;case"leave":s="Calls to leave() are disabled. Please use RTVIClient.disconnect()";break;case"destroy":s="Calls to destroy() are disabled.";break}return s?()=>{throw new Error(s)}:(...o)=>r[n](...o)}return Reflect.get(r,n,i)}})}get proxy(){return this._proxy}}class He extends ca{constructor({dailyFactoryOptions:e={},bufferLocalAudioUntilBotReady:r=!1}={}){super(),this._botId="",this._selectedCam={},this._selectedMic={},this._selectedSpeaker={},this._currentAudioTrack=null,this._audioQueue=[],this._callbacks={},this._dailyFactoryOptions=e,this._bufferLocalAudioUntilBotReady=r,this._daily=pu.createCallObject({...this._dailyFactoryOptions,allowMultipleCallInstances:!0}),this._dailyWrapper=new Tu(this._daily)}setupRecorder(){this._mediaStreamRecorder=new Mu({sampleRate:He.RECORDER_SAMPLE_RATE})}handleUserAudioStream(e){this._audioQueue.push(e)}flushAudioQueue(){if(this._audioQueue.length!==0)for(q.debug(`Will flush audio queue: ${this._audioQueue.length}`);this._audioQueue.length>0;){const r=[];for(;r.length<10&&this._audioQueue.length>0;){const n=this._audioQueue.shift();n&&r.push(n)}r.length>0&&this._sendAudioBatch(r)}}_sendAudioBatch(e){const n={id:"raw-audio-batch",label:"rtvi-ai",type:"raw-audio-batch",data:{base64AudioBatch:e.map(i=>{const s=new Uint8Array(i);return btoa(String.fromCharCode(...s))}),sampleRate:He.RECORDER_SAMPLE_RATE,numChannels:1}};this.sendMessage(n)}initialize(e,r){this._bufferLocalAudioUntilBotReady&&this.setupRecorder(),this._callbacks=e.callbacks??{},this._onMessage=r,(this._dailyFactoryOptions.startVideoOff==null||e.enableCam!=null)&&(this._dailyFactoryOptions.startVideoOff=!(e.enableCam??!1)),(this._dailyFactoryOptions.startAudioOff==null||e.enableMic!=null)&&(this._dailyFactoryOptions.startAudioOff=!(e.enableMic??!0)),this.attachEventListeners(),this.state="disconnected",q.debug("[RTVI Transport] Initialized")}get dailyCallClient(){return this._dailyWrapper.proxy}get state(){return this._state}set state(e){var r,n;this._state!==e&&(this._state=e,(n=(r=this._callbacks).onTransportStateChanged)==null||n.call(r,e))}async getAllCams(){const{devices:e}=await this._daily.enumerateDevices();return e.filter(r=>r.kind==="videoinput")}updateCam(e){this._daily.setInputDevicesAsync({videoDeviceId:e}).then(r=>{this._selectedCam=r.camera})}get selectedCam(){return this._selectedCam}async getAllMics(){const{devices:e}=await this._daily.enumerateDevices();return e.filter(r=>r.kind==="audioinput")}updateMic(e){this._daily.setInputDevicesAsync({audioDeviceId:e}).then(r=>{this._selectedMic=r.mic})}get selectedMic(){return this._selectedMic}async getAllSpeakers(){const{devices:e}=await this._daily.enumerateDevices();return e.filter(r=>r.kind==="audiooutput")}updateSpeaker(e){this._daily.setOutputDeviceAsync({outputDeviceId:e}).then(r=>{this._selectedSpeaker=r.speaker})}get selectedSpeaker(){return this._selectedSpeaker}enableMic(e){this._daily.setLocalAudio(e)}get isMicEnabled(){return this._daily.localAudio()}enableCam(e){this._daily.setLocalVideo(e)}get isCamEnabled(){return this._daily.localVideo()}enableScreenShare(e){e?this._daily.startScreenShare():this._daily.stopScreenShare()}get isSharingScreen(){return this._daily.localScreenAudio()||this._daily.localScreenVideo()}tracks(){var i,s,o,l,c,h,f,g,y,k,v,b,M,O,x,D;const e=this._daily.participants()??{},r=e==null?void 0:e[this._botId],n={local:{audio:(o=(s=(i=e==null?void 0:e.local)==null?void 0:i.tracks)==null?void 0:s.audio)==null?void 0:o.persistentTrack,screenAudio:(h=(c=(l=e==null?void 0:e.local)==null?void 0:l.tracks)==null?void 0:c.screenAudio)==null?void 0:h.persistentTrack,screenVideo:(y=(g=(f=e==null?void 0:e.local)==null?void 0:f.tracks)==null?void 0:g.screenVideo)==null?void 0:y.persistentTrack,video:(b=(v=(k=e==null?void 0:e.local)==null?void 0:k.tracks)==null?void 0:v.video)==null?void 0:b.persistentTrack}};return r&&(n.bot={audio:(O=(M=r==null?void 0:r.tracks)==null?void 0:M.audio)==null?void 0:O.persistentTrack,video:(D=(x=r==null?void 0:r.tracks)==null?void 0:x.video)==null?void 0:D.persistentTrack}),n}async startRecording(){try{q.info("[RTVI Transport] Initializing recording"),await this._mediaStreamRecorder.record(e=>{this.handleUserAudioStream(e.mono)},He.RECORDER_CHUNK_SIZE),this._onMessage({type:Ht.AUDIO_BUFFERING_STARTED,data:{}}),q.info("[RTVI Transport] Recording Initialized")}catch(e){e.message.includes("Already recording")||q.error("Error starting recording",e)}}async preAuth(e){this._dailyFactoryOptions=e,await this._daily.preAuth(e)}async initDevices(){var o,l,c,h,f,g,y,k,v,b,M,O;if(!this._daily)throw new pe("Transport instance not initialized");this.state="initializing";const e=await this._daily.startCamera(),{devices:r}=await this._daily.enumerateDevices(),n=r.filter(x=>x.kind==="videoinput"),i=r.filter(x=>x.kind==="audioinput"),s=r.filter(x=>x.kind==="audiooutput");this._selectedCam=e.camera,this._selectedMic=e.mic,this._selectedSpeaker=e.speaker,(l=(o=this._callbacks).onAvailableCamsUpdated)==null||l.call(o,n),(h=(c=this._callbacks).onAvailableMicsUpdated)==null||h.call(c,i),(g=(f=this._callbacks).onAvailableSpeakersUpdated)==null||g.call(f,s),(k=(y=this._callbacks).onCamUpdated)==null||k.call(y,e.camera),(b=(v=this._callbacks).onMicUpdated)==null||b.call(v,e.mic),(O=(M=this._callbacks).onSpeakerUpdated)==null||O.call(M,e.speaker),this._daily.isLocalAudioLevelObserverRunning()||await this._daily.startLocalAudioLevelObserver(100),this._daily.isRemoteParticipantsAudioLevelObserverRunning()||await this._daily.startRemoteParticipantsAudioLevelObserver(100),this.state="initialized"}async connect(e,r){var i,s,o;if(!this._daily)throw new pe("Transport instance not initialized");if(r.signal.aborted)return;this.state="connecting";const n=this._dailyFactoryOptions;n.url=e.room_url??n.url,e.token!=null&&(n.token=e.token);try{await this._daily.join(n);const l=await this._daily.room();l&&"id"in l&&(this._expiry=(i=l.config)==null?void 0:i.exp)}catch(l){throw q.error("Failed to join room",l),this.state="error",new na}r.signal.aborted||(this.state="connected",(o=(s=this._callbacks).onConnected)==null||o.call(s))}async sendReadyMessage(){return new Promise(e=>{(async()=>{const r=n=>{var i;(i=n.participant)!=null&&i.local||(this.state="ready",this.flushAudioQueue(),this.sendMessage(re.clientReady()),this.stopRecording(),this._daily.off("track-started",r),e())};this._daily.on("track-started",r)})()})}stopRecording(){this._mediaStreamRecorder&&this._mediaStreamRecorder.getStatus()!=="ended"&&(this._mediaStreamRecorder.end(),this._onMessage({type:Ht.AUDIO_BUFFERING_STOPPED,data:{}}))}attachEventListeners(){this._daily.on("available-devices-updated",this.handleAvailableDevicesUpdated.bind(this)),this._daily.on("selected-devices-updated",this.handleSelectedDevicesUpdated.bind(this)),this._daily.on("track-started",this.handleTrackStarted.bind(this)),this._daily.on("track-stopped",this.handleTrackStopped.bind(this)),this._daily.on("participant-joined",this.handleParticipantJoined.bind(this)),this._daily.on("participant-left",this.handleParticipantLeft.bind(this)),this._daily.on("local-audio-level",this.handleLocalAudioLevel.bind(this)),this._daily.on("remote-participants-audio-level",this.handleRemoteAudioLevel.bind(this)),this._daily.on("app-message",this.handleAppMessage.bind(this)),this._daily.on("left-meeting",this.handleLeftMeeting.bind(this)),this._daily.on("error",this.handleFatalError.bind(this)),this._daily.on("nonfatal-error",this.handleNonFatalError.bind(this))}async disconnect(){this.state="disconnecting",this._daily.stopLocalAudioLevelObserver(),this._daily.stopRemoteParticipantsAudioLevelObserver(),this._audioQueue=[],this._currentAudioTrack=null,this.stopRecording(),await this._daily.leave()}sendMessage(e){this._daily.sendAppMessage(e,"*")}handleAppMessage(e){e.data.label==="rtvi-ai"&&this._onMessage({id:e.data.id,type:e.data.type,data:e.data.data})}handleAvailableDevicesUpdated(e){var r,n,i,s,o,l;(n=(r=this._callbacks).onAvailableCamsUpdated)==null||n.call(r,e.availableDevices.filter(c=>c.kind==="videoinput")),(s=(i=this._callbacks).onAvailableMicsUpdated)==null||s.call(i,e.availableDevices.filter(c=>c.kind==="audioinput")),(l=(o=this._callbacks).onAvailableSpeakersUpdated)==null||l.call(o,e.availableDevices.filter(c=>c.kind==="audiooutput"))}handleSelectedDevicesUpdated(e){var r,n,i,s,o,l,c,h,f;((r=this._selectedCam)==null?void 0:r.deviceId)!==e.devices.camera&&(this._selectedCam=e.devices.camera,(i=(n=this._callbacks).onCamUpdated)==null||i.call(n,e.devices.camera)),((s=this._selectedMic)==null?void 0:s.deviceId)!==e.devices.mic&&(this._selectedMic=e.devices.mic,(l=(o=this._callbacks).onMicUpdated)==null||l.call(o,e.devices.mic)),((c=this._selectedSpeaker)==null?void 0:c.deviceId)!==e.devices.speaker&&(this._selectedSpeaker=e.devices.speaker,(f=(h=this._callbacks).onSpeakerUpdated)==null||f.call(h,e.devices.speaker))}async handleLocalAudioTrack(e){if(this.state=="ready"||!this._bufferLocalAudioUntilBotReady)return;switch(this._mediaStreamRecorder.getStatus()){case"ended":await this._mediaStreamRecorder.begin(e),await this.startRecording();break;case"paused":await this.startRecording();break;case"recording":default:this._currentAudioTrack!==e?(await this._mediaStreamRecorder.end(),await this._mediaStreamRecorder.begin(e),await this.startRecording()):q.warn("track-started event received for current track and already recording");break}this._currentAudioTrack=e}handleTrackStarted(e){var r,n,i,s,o;e.type==="screenAudio"||e.type==="screenVideo"?(n=(r=this._callbacks).onScreenTrackStarted)==null||n.call(r,e.track,e.participant?ot(e.participant):void 0):((i=e.participant)!=null&&i.local&&e.track.kind==="audio"&&this.handleLocalAudioTrack(e.track),(o=(s=this._callbacks).onTrackStarted)==null||o.call(s,e.track,e.participant?ot(e.participant):void 0))}handleTrackStopped(e){var r,n,i,s;e.type==="screenAudio"||e.type==="screenVideo"?(n=(r=this._callbacks).onScreenTrackStopped)==null||n.call(r,e.track,e.participant?ot(e.participant):void 0):(s=(i=this._callbacks).onTrackStopped)==null||s.call(i,e.track,e.participant?ot(e.participant):void 0)}handleParticipantJoined(e){var n,i,s,o;const r=ot(e.participant);(i=(n=this._callbacks).onParticipantJoined)==null||i.call(n,r),!r.local&&(this._botId=e.participant.session_id,(o=(s=this._callbacks).onBotConnected)==null||o.call(s,r))}handleParticipantLeft(e){var n,i,s,o;const r=ot(e.participant);(i=(n=this._callbacks).onParticipantLeft)==null||i.call(n,r),!r.local&&(this._botId="",(o=(s=this._callbacks).onBotDisconnected)==null||o.call(s,r))}handleLocalAudioLevel(e){var r,n;(n=(r=this._callbacks).onLocalAudioLevel)==null||n.call(r,e.audioLevel)}handleRemoteAudioLevel(e){var i,s;const r=this._daily.participants(),n=Object.keys(e.participantsAudioLevel);for(let o=0;o<n.length;o++){const l=n[o],c=e.participantsAudioLevel[l];(s=(i=this._callbacks).onRemoteAudioLevel)==null||s.call(i,c,ot(r[l]))}}handleLeftMeeting(){var e,r;this.state="disconnected",this._botId="",(r=(e=this._callbacks).onDisconnected)==null||r.call(e)}handleFatalError(e){var r,n;q.error("Daily fatal error",e.errorMsg),this.state="error",this._botId="",(n=(r=this._callbacks).onError)==null||n.call(r,re.error(e.errorMsg,!0))}handleNonFatalError(e){var r,n;switch(e.type){case"screen-share-error":(n=(r=this._callbacks).onScreenShareError)==null||n.call(r,e.errorMsg);break}}}He.RECORDER_SAMPLE_RATE=16e3;He.RECORDER_CHUNK_SIZE=512;const ot=t=>({id:t.user_id,local:t.local,name:t.user_name});class Au{constructor(){this.rtviClient=null,this.setupDOMElements(),this.setupEventListeners()}setupDOMElements(){this.connectBtn=document.getElementById("connect-btn"),this.disconnectBtn=document.getElementById("disconnect-btn"),this.statusSpan=document.getElementById("connection-status"),this.debugLog=document.getElementById("debug-log"),this.botVideoContainer=document.getElementById("bot-video-container"),this.botAudio=document.createElement("audio"),this.botAudio.autoplay=!0,this.botAudio.playsInline=!0,document.body.appendChild(this.botAudio)}setupEventListeners(){this.connectBtn.addEventListener("click",()=>this.connect()),this.disconnectBtn.addEventListener("click",()=>this.disconnect())}log(e){const r=document.createElement("div");r.textContent=`${new Date().toISOString()} - ${e}`,e.startsWith("User: ")?r.style.color="#2196F3":e.startsWith("Bot: ")&&(r.style.color="#4CAF50"),this.debugLog.appendChild(r),this.debugLog.scrollTop=this.debugLog.scrollHeight,console.log(e)}updateStatus(e){this.statusSpan.textContent=e,this.log(`Status: ${e}`)}setupMediaTracks(){var r,n;if(!this.rtviClient)return;const e=this.rtviClient.tracks();(r=e.bot)!=null&&r.audio&&this.setupAudioTrack(e.bot.audio),(n=e.bot)!=null&&n.video&&this.setupVideoTrack(e.bot.video)}setupTrackListeners(){this.rtviClient&&(this.rtviClient.on(I.TrackStarted,(e,r)=>{r!=null&&r.local||(e.kind==="audio"?this.setupAudioTrack(e):e.kind==="video"&&this.setupVideoTrack(e))}),this.rtviClient.on(I.TrackStopped,(e,r)=>{this.log(`Track stopped event: ${e.kind} from ${(r==null?void 0:r.name)||"unknown"}`)}))}setupAudioTrack(e){if(this.log("Setting up audio track"),this.botAudio.srcObject){const r=this.botAudio.srcObject.getAudioTracks()[0];if((r==null?void 0:r.id)===e.id)return}this.botAudio.srcObject=new MediaStream([e])}setupVideoTrack(e){var n;this.log("Setting up video track");const r=document.createElement("video");if(r.autoplay=!0,r.playsInline=!0,r.muted=!0,r.style.width="100%",r.style.height="100%",r.style.objectFit="cover",(n=this.botVideoContainer.querySelector("video"))!=null&&n.srcObject){const i=this.botVideoContainer.querySelector("video").srcObject.getVideoTracks()[0];if((i==null?void 0:i.id)===e.id)return}r.srcObject=new MediaStream([e]),this.botVideoContainer.innerHTML="",this.botVideoContainer.appendChild(r)}async connect(){try{const e=new He;this.rtviClient=new Ne({transport:e,params:{baseUrl:"https://vaani-webrtc.fly.dev",endpoints:{connect:"/"}},enableMic:!0,enableCam:!1,callbacks:{onConnected:()=>{this.updateStatus("Connected"),this.connectBtn.disabled=!0,this.disconnectBtn.disabled=!1,this.log("Client connected")},onDisconnected:()=>{this.updateStatus("Disconnected"),this.connectBtn.disabled=!1,this.disconnectBtn.disabled=!0,this.log("Client disconnected")},onTransportStateChanged:r=>{this.updateStatus(`Transport: ${r}`),this.log(`Transport state changed: ${r}`),r==="ready"&&this.setupMediaTracks()},onBotConnected:r=>{this.log(`Bot connected: ${JSON.stringify(r)}`)},onBotDisconnected:r=>{this.log(`Bot disconnected: ${JSON.stringify(r)}`)},onBotReady:r=>{this.log(`Bot ready: ${JSON.stringify(r)}`),this.setupMediaTracks()},onUserTranscript:r=>{r.final&&this.log(`User: ${r.text}`)},onBotTranscript:r=>{this.log(`Bot: ${r.text}`)},onMessageError:r=>{console.log("Message error:",r)},onError:r=>{console.log("Error:",r)}}}),this.setupTrackListeners(),this.log("Initializing devices..."),await this.rtviClient.initDevices(),this.log("Connecting to bot..."),await this.rtviClient.connect(),this.log("Connection complete")}catch(e){if(this.log(`Error connecting: ${e.message}`),this.log(`Error stack: ${e.stack}`),this.updateStatus("Error"),this.rtviClient)try{await this.rtviClient.disconnect()}catch(r){this.log(`Error during disconnect: ${r.message}`)}}}async disconnect(){var e;if(this.rtviClient)try{if(await this.rtviClient.disconnect(),this.rtviClient=null,this.botAudio.srcObject&&(this.botAudio.srcObject.getTracks().forEach(r=>r.stop()),this.botAudio.srcObject=null),(e=this.botVideoContainer.querySelector("video"))!=null&&e.srcObject){const r=this.botVideoContainer.querySelector("video");r.srcObject.getTracks().forEach(n=>n.stop()),r.srcObject=null}this.botVideoContainer.innerHTML=""}catch(r){this.log(`Error disconnecting: ${r.message}`)}}}window.addEventListener("DOMContentLoaded",()=>{new Au});
